<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html"><meta property="og:site_name" content="æ–‡æ¡£æ¼”ç¤º"><meta property="og:title" content="kubeadmå®‰è£…kubernetes"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-11T05:08:11.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-01-22T12:11:00.000Z"><meta property="article:modified_time" content="2022-10-11T05:08:11.000Z"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>kubeadmå®‰è£…kubernetes | æ–‡æ¡£æ¼”ç¤º</title><meta name="description" content="vuepress-theme-hope çš„æ–‡æ¡£æ¼”ç¤º">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7cb9ac72.css">
    <link rel="modulepreload" href="/assets/app.85823306.js"><link rel="modulepreload" href="/assets/02.Kuberneteséƒ¨ç½².html.fda7203b.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/02.Kuberneteséƒ¨ç½².html.196d9b25.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/zh" class="brand"><img class="logo" src="/logo.svg" alt="æ–‡æ¡£æ¼”ç¤º"><!----><span class="site-name hide-in-pad">æ–‡æ¡£æ¼”ç¤º</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/zh" class="nav-link" aria-label="isKcount"><span class="icon iconfont icon-home"></span>isKcount<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†ç±»"><span class="title"><span class="icon iconfont icon-interact"></span>åˆ†ç±»</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/isKcount/1/" class="nav-link" aria-label="å­¦ä¹ è·¯çº¿è§„åˆ’"><span class="icon iconfont icon-ability"></span>å­¦ä¹ è·¯çº¿è§„åˆ’<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/2/" class="nav-link active" aria-label="è€ƒè¯"><span class="icon iconfont icon-relation"></span>è€ƒè¯<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/3/" class="nav-link" aria-label="è¿ç»´ç¬”è®°"><span class="icon iconfont icon-linux"></span>è¿ç»´ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/4/" class="nav-link" aria-label="åç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-note"></span>åç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/5/" class="nav-link" aria-label="å‰ç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-like"></span>å‰ç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/6/" class="nav-link" aria-label="ä¸­é—´ä»¶æœåŠ¡ç¬”è®°"><span class="icon iconfont icon-api"></span>ä¸­é—´ä»¶æœåŠ¡ç¬”è®°<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Devops"><span class="title"><span class="icon iconfont icon-select"></span>Devops</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/cicd/git/" class="nav-link" aria-label="Gitå¼€å‘æ‰‹å†Œ"><span class="icon iconfont icon-git"></span>Gitå¼€å‘æ‰‹å†Œ<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/ci/" class="nav-link" aria-label="CICD"><span class="icon iconfont icon-ci"></span>CICD<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/istio/" class="nav-link" aria-label="Istio"><span class="icon iconfont icon-material"></span>Istio<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/operator/" class="nav-link" aria-label="Operator"><span class="icon iconfont icon-proxy"></span>Operator<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://wallhaven.cc/" rel="noopener noreferrer" target="_blank" aria-label="Wallhaven" class="nav-link"><span class="icon iconfont icon-autumn"></span>Wallhaven<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zh/isKcount/" class="nav-link sidebar-link sidebar-page" aria-label="æŒ‡å—"><span class="icon iconfont icon-creative"></span>æŒ‡å—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">å­¦ä¹ è·¯çº¿è§„åˆ’</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-relation"></span><span class="title">è€ƒè¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux"></span><span class="title">è¿ç»´ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">åç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-like"></span><span class="title">å‰ç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-api"></span><span class="title">ä¸­é—´ä»¶æœåŠ¡ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->kubeadmå®‰è£…kubernetes</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://iskcount.github.io" target="_blank" rel="noopener noreferrer">isKcount</a></span><span property="author" content="isKcount"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´1æœˆ22æ—¥</span><meta property="datePublished" content="2022-01-22T12:11:00.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 11 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT11M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#ä½¿ç”¨kubeadmå®‰è£…kubernetes" class="router-link-active router-link-exact-active toc-link level2">ä½¿ç”¨kubeadmå®‰è£…kubernetes</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#æ­å»ºkubernetes-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active toc-link level3">æ­å»ºKubernetesï¼ˆå‡†å¤‡ç¯å¢ƒï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#æ›´æ”¹ä¸»æœºåç§°" class="router-link-active router-link-exact-active toc-link level3">æ›´æ”¹ä¸»æœºåç§°ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#æ·»åŠ æ˜ å°„" class="router-link-active router-link-exact-active toc-link level3">æ·»åŠ æ˜ å°„ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#å…³é—­é˜²ç«å¢™å’Œselinux" class="router-link-active router-link-exact-active toc-link level3">å…³é—­é˜²ç«å¢™å’Œselinuxï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#å…³é—­swap" class="router-link-active router-link-exact-active toc-link level3">å…³é—­swapï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#é…ç½®è·¯ç”±è½¬å‘" class="router-link-active router-link-exact-active toc-link level3">é…ç½®è·¯ç”±è½¬å‘ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#é…ç½®æ—¶é—´åŒæ­¥" class="router-link-active router-link-exact-active toc-link level3">é…ç½®æ—¶é—´åŒæ­¥ï¼š</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#å®‰è£…docker-kubeadm-kubelet-æ‰€æœ‰èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">å®‰è£…Docker/kubeadm/kubelet ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">å®‰è£…Dockerï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#é…ç½®é•œåƒåŠ é€Ÿ" class="router-link-active router-link-exact-active toc-link level3">é…ç½®é•œåƒåŠ é€Ÿï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#é…ç½®é˜¿é‡Œyumæº" class="router-link-active router-link-exact-active toc-link level3">é…ç½®é˜¿é‡ŒYUMæºï¼š</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#kubeadméƒ¨ç½²masteré›†ç¾¤" class="router-link-active router-link-exact-active toc-link level2">kubeadméƒ¨ç½²Masteré›†ç¾¤</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#ä½¿ç”¨kubeadméƒ¨ç½²é›†ç¾¤" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨kubeadméƒ¨ç½²é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#éƒ¨ç½²å®¹å™¨ç½‘ç»œcni" class="router-link-active router-link-exact-active toc-link level3">éƒ¨ç½²å®¹å™¨ç½‘ç»œCNIï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#éƒ¨ç½²dashboard" class="router-link-active router-link-exact-active toc-link level3">éƒ¨ç½²Dashboardï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#é…ç½®nodeport" class="router-link-active router-link-exact-active toc-link level3">é…ç½®NodePortï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#ç»‘å®šé»˜è®¤ç®¡ç†å‘˜é›†ç¾¤è§’è‰²" class="router-link-active router-link-exact-active toc-link level3">ç»‘å®šé»˜è®¤ç®¡ç†å‘˜é›†ç¾¤è§’è‰²ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#kubeadméƒ¨ç½²nodeåŠ å…¥é›†ç¾¤" class="router-link-active router-link-exact-active toc-link level3">kubeadméƒ¨ç½²NodeåŠ å…¥é›†ç¾¤ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#æ›´æ¢containerd" class="router-link-active router-link-exact-active toc-link level3">æ›´æ¢Containerd:</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#ä½¿ç”¨nfsä½œä¸ºé»˜è®¤sc" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨NFSä½œä¸ºé»˜è®¤SCï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#è®¾ç½®åŠ¨æ€ä¾›åº”" class="router-link-active router-link-exact-active toc-link level3">è®¾ç½®åŠ¨æ€ä¾›åº”:</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/02.Kubernetes%E9%83%A8%E7%BD%B2.html#å®‰è£…metrics-server" class="router-link-active router-link-exact-active toc-link level3">å®‰è£…metrics-server:</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="kubernetes" tabindex="-1"><a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a> <strong>Kubernetes</strong></h1><h2 id="ä½¿ç”¨kubeadmå®‰è£…kubernetes" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨kubeadmå®‰è£…kubernetes" aria-hidden="true">#</a> ä½¿ç”¨kubeadmå®‰è£…kubernetes</h2><p><strong>å®‰è£…è¦æ±‚ï¼š</strong></p><ul><li>ä¸€å°æˆ–è€…å¤šå°æœåŠ¡å™¨ï¼Œæ“ä½œç³»ç»ŸCentos7.6</li><li>é›†ç¾¤ä¹‹é—´æ‰€æœ‰æœºå™¨è¦äº’é€š éœ€è¦å…³é—­é˜²ç«å¢™</li><li>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ</li><li>ç¦æ­¢swapåˆ†åŒº</li><li>ä½¿ç”¨kubeadmæ­å»ºé›†ç¾¤ï¼š apiserverã€etcdã€controller-managerã€schedulerã€<strong>kubeletï¼ˆsystemdå®ˆæŠ¤è¿›ç¨‹ç®¡ç†ï¼Œå…¶ä»–ç»„ä»¶éƒ½æ˜¯é‡‡ç”¨å®¹å™¨éƒ¨ç½²ï¼‰</strong>ã€kube-proxy</li></ul><img src="https://pic.imgdb.cn/item/61ebed4b2ab3f51d911457fd.png" style="zoom:50%;"><table><thead><tr><th>è§’è‰²</th><th>IP</th></tr></thead><tbody><tr><td>k8s-master</td><td>10.10.10.128</td></tr><tr><td>k8s-node1</td><td>10.10.10.129</td></tr><tr><td>k8s-node2</td><td>10.10.10.130</td></tr></tbody></table><blockquote><h3 id="æ­å»ºkubernetes-å‡†å¤‡ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#æ­å»ºkubernetes-å‡†å¤‡ç¯å¢ƒ" aria-hidden="true">#</a> æ­å»ºKubernetesï¼ˆå‡†å¤‡ç¯å¢ƒï¼‰</h3></blockquote><p><strong>æ‰€æœ‰çš„èŠ‚ç‚¹éœ€è¦åšä»¥ä¸‹çš„å‰æœŸå·¥ä½œï¼Œä¿è¯æ­å»ºçš„æ—¶å€™ä¸ä¼šå‡ºç°æ„å¤–æƒ…å†µã€‚</strong></p><h3 id="æ›´æ”¹ä¸»æœºåç§°" tabindex="-1"><a class="header-anchor" href="#æ›´æ”¹ä¸»æœºåç§°" aria-hidden="true">#</a> <strong>æ›´æ”¹ä¸»æœºåç§°ï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-master </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-node1 </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-node2 </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ·»åŠ æ˜ å°„" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ æ˜ å°„" aria-hidden="true">#</a> <strong>æ·»åŠ æ˜ å°„ï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">vi</span>  /etc/hosts
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token number">10.10</span>.10.128 k8s-master 
<span class="token number">10.10</span>.10.129 k8s-node1 
<span class="token number">10.10</span>.10.130 k8s-node2 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…³é—­é˜²ç«å¢™å’Œselinux" tabindex="-1"><a class="header-anchor" href="#å…³é—­é˜²ç«å¢™å’Œselinux" aria-hidden="true">#</a> <strong>å…³é—­é˜²ç«å¢™å’Œselinuxï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ systemctl stop firewalld       
$ systemctl disable firewalld     
$ <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/enforcing/disabled/&#39;</span> /etc/selinux/config 
$ setenforce <span class="token number">0</span> <span class="token punctuation">(</span>ä¸´æ—¶å…³é—­<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…³é—­swap" tabindex="-1"><a class="header-anchor" href="#å…³é—­swap" aria-hidden="true">#</a> <strong>å…³é—­swapï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ swapoff <span class="token parameter variable">-a</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="é…ç½®è·¯ç”±è½¬å‘" tabindex="-1"><a class="header-anchor" href="#é…ç½®è·¯ç”±è½¬å‘" aria-hidden="true">#</a> <strong>é…ç½®è·¯ç”±è½¬å‘ï¼š</strong></h3><p>å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF</span>
$ <span class="token function">sysctl</span> <span class="token parameter variable">--system</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®æ—¶é—´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ—¶é—´åŒæ­¥" aria-hidden="true">#</a> <strong>é…ç½®æ—¶é—´åŒæ­¥ï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> ntpdate 
$ ntpdate time.windows.com 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®‰è£…docker-kubeadm-kubelet-æ‰€æœ‰èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#å®‰è£…docker-kubeadm-kubelet-æ‰€æœ‰èŠ‚ç‚¹" aria-hidden="true">#</a> <strong>å®‰è£…Docker/kubeadm/kubelet ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</strong></h2><p><strong>Kubernetesé»˜è®¤CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰ä¸ºDockerï¼Œå› æ­¤å…ˆå®‰è£…Dockerã€‚</strong></p><h3 id="å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#å®‰è£…docker" aria-hidden="true">#</a> <strong>å®‰è£…Dockerï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
$ yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
$ yum makecache fast
$ yum <span class="token parameter variable">-y</span> <span class="token function">install</span> docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®é•œåƒåŠ é€Ÿ" tabindex="-1"><a class="header-anchor" href="#é…ç½®é•œåƒåŠ é€Ÿ" aria-hidden="true">#</a> <strong>é…ç½®é•œåƒåŠ é€Ÿï¼š</strong></h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>$ cat &gt; /etc/docker/daemon.json &lt;&lt; EOF
<span class="token punctuation">{</span>
     <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://ably8t50.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	  <span class="token property">&quot;exec-opts&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
$ systemctl daemon-reload 
$ systemctl restart docker 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®é˜¿é‡Œyumæº" tabindex="-1"><a class="header-anchor" href="#é…ç½®é˜¿é‡Œyumæº" aria-hidden="true">#</a> <strong>é…ç½®é˜¿é‡ŒYUMæºï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>

$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kubelet-1.20.0 kubeadm-1.20.0 kubectl-1.20.0
$ systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="kubeadméƒ¨ç½²masteré›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#kubeadméƒ¨ç½²masteré›†ç¾¤" aria-hidden="true">#</a> <strong>kubeadméƒ¨ç½²Masteré›†ç¾¤</strong></h2><h3 id="ä½¿ç”¨kubeadméƒ¨ç½²é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨kubeadméƒ¨ç½²é›†ç¾¤" aria-hidden="true">#</a> ä½¿ç”¨kubeadméƒ¨ç½²é›†ç¾¤</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubeadm init <span class="token punctuation">\</span>
--apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.10</span>.10.128 <span class="token punctuation">\</span>
--image-repository registry.aliyuncs.com/google_containers <span class="token punctuation">\</span>
--kubernetes-version v1.20.0 <span class="token punctuation">\</span>
--service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/12 <span class="token punctuation">\</span>
--pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 <span class="token punctuation">\</span>
--ignore-preflight-errors<span class="token operator">=</span>all  

$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
$ <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
$ <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>--apiserver-advertise-address é›†ç¾¤é€šå‘Šåœ°å€</li><li>--image-repository ç”±äºé»˜è®¤çš„æ‹‰å–é•œåƒåœ°å€k8s.gcr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</li><li>--kubernetes-version k8sçš„ç‰ˆæœ¬</li><li>--service-cidr é›†ç¾¤å†…éƒ¨è™šæ‹Ÿç½‘ç»œï¼ŒPodçš„ç»Ÿä¸€è®¿é—®å…¥å£</li><li>--pod-network-cidr Podçš„ç½‘ç»œï¼Œä¸ä¸‹é¢éƒ¨ç½²çš„CNIç½‘ç»œç»„ä»¶yamlä¸­ä¿æŒä¸€è‡´</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl get nodes
NAME            STATUS     ROLES            AGE   VERSION
master   		NotReady   control-plane,master   20s   v1.20.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éƒ¨ç½²å®¹å™¨ç½‘ç»œcni" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²å®¹å™¨ç½‘ç»œcni" aria-hidden="true">#</a> <strong>éƒ¨ç½²å®¹å™¨ç½‘ç»œCNIï¼š</strong></h3><p>Calicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoæ”¯æŒå¹¿æ³›çš„å¹³å°ï¼ŒåŒ…æ‹¬Kubernetesã€OpenStackç­‰ã€‚</p><p>Calico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆ vRouterï¼‰ æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­ã€‚</p><p>æ­¤å¤–ï¼ŒCalico é¡¹ç›®è¿˜å®ç°äº† Kubernetes ç½‘ç»œç­–ç•¥ï¼Œæä¾›ACLåŠŸèƒ½ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>æ‹‰å–Podç½‘ç»œæ’ä»¶
åŸå› ï¼šcorednsä¸€ç›´åœæ»åœ¨Pendingï¼Œéœ€è¦æ‰‹åŠ¨æ‹‰å–, æœ€åé€‰æ‹©çš„ç½‘ç»œæ’ä»¶æ˜¯ï¼šcalicoã€‚

<span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system </span>
NAME                                READY   STATUS    RESTARTS   AGE
coredns-7f89b7bc75-b7nml            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16m
coredns-7f89b7bc75-mrn6x            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16m
etcd-k8s-node2                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m
kube-apiserver-k8s-node2            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m
kube-controller-manager-k8s-node2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m
kube-proxy-78zrr                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m
kube-scheduler-k8s-node2            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m

$ kubectl apply <span class="token parameter variable">-f</span> https://docs.projectcalico.org/manifests/calico.yaml
$ kubectl apply <span class="token parameter variable">-f</span> calico.yaml
<span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system </span>
NAME                                       READY   STATUS     RESTARTS   AGE
calico-kube-controllers-5f6cfd688c-g9mlv   <span class="token number">0</span>/1     Pending    <span class="token number">0</span>          7s
calico-node-4vbtr                          <span class="token number">0</span>/1     Init:0/3   <span class="token number">0</span>          7s
coredns-7f89b7bc75-b7nml                   <span class="token number">0</span>/1     Pending    <span class="token number">0</span>          12h
coredns-7f89b7bc75-mrn6x                   <span class="token number">0</span>/1     Pending    <span class="token number">0</span>          12h
etcd-k8s-node2                             <span class="token number">1</span>/1     Running    <span class="token number">0</span>          12h
kube-apiserver-k8s-node2                   <span class="token number">1</span>/1     Running    <span class="token number">0</span>          12h
kube-controller-manager-k8s-node2          <span class="token number">1</span>/1     Running    <span class="token number">0</span>          12h
kube-proxy-78zrr                           <span class="token number">1</span>/1     Running    <span class="token number">0</span>          12h
kube-scheduler-k8s-node2                   <span class="token number">1</span>/1     Running    <span class="token number">0</span>          12h
<span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system </span>
NAME                                       READY   STATUS    RESTARTS   AGE
calico-kube-controllers-5f6cfd688c-g9mlv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m7s
calico-node-4vbtr                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m7s
coredns-7f89b7bc75-b7nml                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
coredns-7f89b7bc75-mrn6x                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
etcd-k8s-node2                             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
kube-apiserver-k8s-node2                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
kube-controller-manager-k8s-node2          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
kube-proxy-78zrr                           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
kube-scheduler-k8s-node2                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éƒ¨ç½²dashboard" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²dashboard" aria-hidden="true">#</a> <strong>éƒ¨ç½²Dashboardï¼š</strong></h3><p>æ‹‰å–é•œåƒ</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">wget</span> https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="é…ç½®nodeport" tabindex="-1"><a class="header-anchor" href="#é…ç½®nodeport" aria-hidden="true">#</a> <strong>é…ç½®NodePortï¼š</strong></h3><p>é…ç½®recommendedçš„yamlæ–‡ä»¶ä¿®æ”¹é›†ç¾¤å¤–éƒ¨è®¿é—®çš„æ–¹å¼ï¼Œtypeä¸ºNodePortï¼Œnodeportå¤–éƒ¨è®¿é—®ç«¯å£æ˜¯30001</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30001</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f recommended.yaml                                             </span>
namespace/kubernetes-dashboard unchanged
serviceaccount/kubernetes-dashboard unchanged
service/kubernetes-dashboard unchanged
secret/kubernetes-dashboard-certs unchanged
secret/kubernetes-dashboard-csrf unchanged
secret/kubernetes-dashboard-key-holder unchanged
configmap/kubernetes-dashboard-settings unchanged
role.rbac.authorization.k8s.io/kubernetes-dashboard unchanged
clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard unchanged
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard unchanged
clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard unchanged
deployment.apps/kubernetes-dashboard unchanged
service/dashboard-metrics-scraper unchanged
deployment.apps/dashboard-metrics-scraper unchanged
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»‘å®šé»˜è®¤ç®¡ç†å‘˜é›†ç¾¤è§’è‰²" tabindex="-1"><a class="header-anchor" href="#ç»‘å®šé»˜è®¤ç®¡ç†å‘˜é›†ç¾¤è§’è‰²" aria-hidden="true">#</a> <strong>ç»‘å®šé»˜è®¤ç®¡ç†å‘˜é›†ç¾¤è§’è‰²ï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºç”¨æˆ·</span>
$ kubectl create serviceaccount dashboard-admin <span class="token parameter variable">-n</span> kube-system 
serviceaccount/dashboard-admin created
<span class="token comment"># ç”¨æˆ·æˆæƒ</span>
$ kubectl create clusterrolebinding dashboard-admin  <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>cluster-admin <span class="token parameter variable">--serviceaccount</span><span class="token operator">=</span>kube-system:dashboard-admin 
clusterrolebinding.rbac.authorization.k8s.io/dashboard-admin created
<span class="token comment"># è·å–ç”¨æˆ·Token</span>
$ kubectl describe secrets <span class="token parameter variable">-n</span> kube-system <span class="token variable"><span class="token variable">$(</span>kubectl <span class="token parameter variable">-n</span> kube-system get secret <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/dashboard-admin/{print $1}&#39;</span><span class="token variable">)</span></span>
Name:         dashboard-admin-token-52gsz
Namespace:    kube-system
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  kubernetes.io/service-account.name: dashboard-admin
              kubernetes.io/service-account.uid: 18c45018-7eaa-4381-a0c8-5266cc46b8c9

Type:  kubernetes.io/service-account-token

Data
<span class="token operator">==</span><span class="token operator">==</span>
namespace:  <span class="token number">11</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IkREZGU2aExFYU83aDdxVm8zM09rdGNVVTVydkVIUmxIdDhMejZBY2F0NkUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNTJnc3oiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMThjNDUwMTgtN2VhYS00MzgxLWEwYzgtNTI2NmNjNDZiOGM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.JAb0BvGP268aBDAPx3LaipuK5s9e4-RgYW3y35t29xY-4DUaUKrkbOM2h4unU1QPrXPMS3M4uODvQi3jv5ckg-KAzCebCGCzHrPCKOuZT_HwZidvdBf5QD3oWYAzaF8CoV5Yvwu2D2e0bl4S5cC6TOmW5BwO0CgPZor_iMXzkI0UUR8AADFbHa0V4xMHMF2MWihclkGV5UsfK8mt9uHpRxcQD4RSy_uFY1SYkGklNeMHrysoFBNAv8lTGq-8LuZnsiRrjjwE9YucMgVe2bSGqlg6gtnz_arCwW7fQwx1UkvAl_qdp452GAD3EGkPVqzvuH10R-Fpk84hgJJpk_AMrg
ca.crt:     <span class="token number">1066</span> bytes

<span class="token comment"># ä½¿ç”¨https://10.10.10.128:30001ç™»å½•è®¿é—®é›†ç¾¤</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="kubeadméƒ¨ç½²nodeåŠ å…¥é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#kubeadméƒ¨ç½²nodeåŠ å…¥é›†ç¾¤" aria-hidden="true">#</a> <strong>kubeadméƒ¨ç½²NodeåŠ å…¥é›†ç¾¤ï¼š</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubeadm <span class="token function">join</span> <span class="token number">10.10</span>.10.130:6443 <span class="token parameter variable">--token</span> 9rkpbe.648h6r6rkp24f4xg <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:add1c33a33d53a261fb58516d207a9f13bc41ec5085960e36e4431bd70479e65 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ›´æ¢containerd" tabindex="-1"><a class="header-anchor" href="#æ›´æ¢containerd" aria-hidden="true">#</a> æ›´æ¢Containerd:</h3><p>å¦‚æœè¿™é‡Œæ˜¯Dockerçš„ç¯å¢ƒï¼Œéœ€è¦åˆ‡æ¢åˆ°Containerdå®¹å™¨å¼•æ“ã€‚</p><p>ä»ç„¶éœ€è¦å°†runsc ã€containerd-shim-runsc-v1å·¥å…·ç§»åˆ°/usr/local/binä¸‹é¢</p><p><strong>1.å‡†å¤‡é…ç½®</strong></p><p>å¼€å¯ipv4è·¯ç”±è½¬å‘é…ç½®ï¼Œé‡æ–°ç”Ÿæ•ˆç³»ç»Ÿé…ç½®</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt; EOF</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
EOF

<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># sysctl -system</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2ã€å®‰è£…Containerd</strong></p><p>å¦‚æœé»˜è®¤å®‰è£…äº†docker-ceä¼šè‡ªåŠ¨å®‰è£…containerdçš„ä¾èµ–ï¼Œæ²¡æœ‰åˆ™éœ€è¦å®‰è£…containerdã€‚</p><p>ubuntuæ·»åŠ docker-ceçš„repoæºä¹‹åapt-get installçš„æ–¹å¼å®‰è£…</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d</span>
<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># wget http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># yum install -y containerd.io</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><ol><li>pauseé•œåƒåœ°å€</li><li>Cgroupé©±åŠ¨æ”¹ä¸ºsystemd</li><li>å¢åŠ runscå®¹å™¨è¿è¡Œæ—¶</li><li>é…ç½®dockeré•œåƒåŠ é€Ÿå™¨</li></ol><p>ä¿®æ”¹é…ç½®æ–‡ä»¶é»˜è®¤çš„containerdçš„é…ç½®æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚</p><p>containerdçš„ç›®å½•æ˜¯åœ¨ <code>/etc/containerd</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/containerd/</span>
<span class="token punctuation">[</span>root@master01 containerd<span class="token punctuation">]</span><span class="token comment"># containerd config  default &gt; config.toml</span>
<span class="token punctuation">[</span>root@master01 containerd<span class="token punctuation">]</span><span class="token comment"># vim config.toml</span>
 <span class="token number">43</span>   <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token punctuation">]</span>
 		Â·Â·Â·Â·
 		<span class="token comment"># ä¿®æ”¹é•œåƒä¸ºå›½å†…çš„é•œåƒ</span>
 <span class="token number">56</span>     sandbox_image <span class="token operator">=</span> <span class="token string">&quot;registry.aliyuncs.com/google_containers/pause:3.2&quot;</span>   
 		Â·Â·Â·Â· 
 			<span class="token comment"># æ·»åŠ ä¸€ä¸ªrunsc,æŒ‡å®šç±»å‹ä¸ºrunscï¼Œè¿™é‡Œæ˜¯è·ŸruncåŒçº§</span>
 <span class="token number">90</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runsc<span class="token punctuation">]</span>  
 <span class="token number">91</span>           runtime_type <span class="token operator">=</span> <span class="token string">&quot;io.containerd.runsc.v1&quot;</span>   				  

			<span class="token comment"># ä¿®æ”¹systemdé©±åŠ¨ä¸ºtrue</span>
 <span class="token number">94</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc<span class="token punctuation">]</span>
 <span class="token number">103</span>          <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options<span class="token punctuation">]</span>
				Â·Â·Â·
 <span class="token number">114</span>            SystemdCgroup <span class="token operator">=</span> <span class="token boolean">true</span>	
 		
 			<span class="token comment"># æ·»åŠ dockerä»“åº“çš„é•œåƒæºï¼Œé…ç½®é˜¿é‡Œé•œåƒåŠ é€Ÿ</span>
 <span class="token number">139</span>       <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors<span class="token punctuation">]</span>
 <span class="token number">140</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;docker.io&quot;</span><span class="token punctuation">]</span>  
 <span class="token number">141</span>          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®kubeletä½¿ç”¨containerd</strong></p><p>é…ç½®å®Œä¹‹åå…ˆé‡å¯containerdï¼Œå†é‡å¯kubeletï¼Œæœ€åå¦‚æœpodå‡ºç°æŠ¥é”™ï¼Œé‡å¯dockerã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/sysconfig/kubelet </span>
<span class="token assign-left variable">KUBELET_EXTRA_ARGS</span><span class="token operator">=</span>--container-runtime<span class="token operator">=</span>remote --container-runtime-endpoint<span class="token operator">=</span>unix:///run/containerd/containerd.sock --cgroup-driver<span class="token operator">=</span>systemd

<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart containerd</span>
<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart kubelet</span>
<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>éªŒè¯å½“å‰çš„Kuberneteså®¹å™¨åŸºå±‚</strong></p><ol><li><code>ä»¥ä¸Šçš„æ­¥éª¤éœ€è¦åœ¨æ‰€æœ‰é›†ç¾¤é…ç½®</code></li><li><code>åŒ…æ‹¬crictlè¿æ¥containerdçš„é…ç½®ä¹Ÿè¦åœ¨æ‰€æœ‰é›†ç¾¤è¿è¡Œ</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  node -o wide | awk  &#39;{print $1,$2,$5,$NF}&#39; | column -t</span>
NAME      STATUS  VERSION  CONTAINER-RUNTIME
master01  Ready   v1.22.1  containerd://1.5.11
master02  Ready   v1.22.1  containerd://1.5.11
master03  Ready   v1.22.1  containerd://1.5.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>crictlè¿æ¥containerd</strong></p><p>containerdä¹Ÿæœ‰ ctr ç®¡ç†å·¥å…·ï¼Œä½†åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬ä½¿ç”¨crictlå·¥å…·æ£€æŸ¥å’Œè°ƒè¯•å®¹å™¨ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/kubernetes-sigs/cri-tools/" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/cri-tools/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å‡†å¤‡crictlè¿æ¥containerdé…ç½®æ–‡ä»¶ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; /etc/crictl.yaml &lt;&lt; EOF</span>
runtime-endpoint: unix:///run/containerd/containerd.sock
EOF
<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart  containerd </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨nfsä½œä¸ºé»˜è®¤sc" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨nfsä½œä¸ºé»˜è®¤sc" aria-hidden="true">#</a> ä½¿ç”¨NFSä½œä¸ºé»˜è®¤SCï¼š</h3><ul><li><p>å®‰è£…NFSæœåŠ¡</p></li><li><p>é…ç½®å…±äº«å­˜å‚¨è·¯å¾„å¼€æ”¾æƒé™</p></li><li><p>æ­å»ºNFSæœåŠ¡å™¨å’ŒNFS-Client</p></li><li><p>åœ¨MasterèŠ‚ç‚¹ä¸Šé¢æ‰§è¡Œå‘½ä»¤ vi /etc/exportsï¼Œåˆ›å»º exports æ–‡ä»¶ï¼Œå¯åŠ¨ nfs æœåŠ¡ï¼Œåˆ›å»ºå…±äº«ç›®å½•ã€‚åœ¨å…¶ä»–çš„nodeèŠ‚ç‚¹ä¸Šå®‰è£…nfsæœåŠ¡å¹¶ä¸”å¼€å¯æœåŠ¡ã€‚</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nfs-utils
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot;</span> <span class="token operator">&gt;</span> /etc/exports
$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /nfs/data
$ systemctl <span class="token builtin class-name">enable</span> rpcbind <span class="token operator">&amp;&amp;</span> systemctl start rpcbind
$ systemctl <span class="token builtin class-name">enable</span> nfs-server <span class="token operator">&amp;&amp;</span> systemctl start nfs-server
<span class="token comment">#æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</span>
exportfs
<span class="token comment"># è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤º</span>
/nfs/data  <span class="token operator">&lt;</span>work<span class="token operator">&gt;</span>
$ showmount <span class="token parameter variable">-e</span> <span class="token number">10.10</span>.10.128
  Export list <span class="token keyword">for</span> <span class="token number">10.10</span>.10.128
  /nfs/data *
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨NodeèŠ‚ç‚¹ä¸Šé…ç½®NFS-Client(node1å’Œnode2æ“ä½œ)</li><li>å®‰è£…å®¢æˆ·ç«¯å·¥å…·,æŒ‚è½½ nfs æœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•åˆ°æœ¬æœºè·¯å¾„ /root/nfsmountã€‚</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nfs-utils
$ <span class="token function">mkdir</span> /root/nfsmount
$ systemctl <span class="token builtin class-name">enable</span> rpcbind <span class="token operator">&amp;&amp;</span> systemctl start rpcbind
$ systemctl <span class="token builtin class-name">enable</span> nfs-server <span class="token operator">&amp;&amp;</span> systemctl start nfs-server
$ <span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">10.10</span>.10.128:/nfs/data /root/nfsmount
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="æµ‹è¯•podç›´æ¥æŒ‚è½½nfsäº†" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•podç›´æ¥æŒ‚è½½nfsäº†" aria-hidden="true">#</a> æµ‹è¯•Podç›´æ¥æŒ‚è½½NFSäº†</h4></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vim pod.yaml 
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> vol<span class="token punctuation">-</span>nfs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> html
    <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/data   <span class="token comment">#1000G</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span> è‡ªå·±çš„nfsæœåŠ¡å™¨åœ°å€
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> html
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html/
$ kubectl apply <span class="token punctuation">-</span>f pod.yaml 
$ echo  ABCD <span class="token punctuation">&gt;</span> /nfs/data/index.html 
$ curl 
ABCD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¾ç½®åŠ¨æ€ä¾›åº”" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®åŠ¨æ€ä¾›åº”" aria-hidden="true">#</a> è®¾ç½®åŠ¨æ€ä¾›åº”:</h3><img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1dd.png" style="zoom:50%;"><blockquote><h4 id="åˆ›å»ºprovisioner-nfsç¯å¢ƒå‰é¢å·²ç»æ­å¥½" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºprovisioner-nfsç¯å¢ƒå‰é¢å·²ç»æ­å¥½" aria-hidden="true">#</a> åˆ›å»ºprovisionerï¼ˆNFSç¯å¢ƒå‰é¢å·²ç»æ­å¥½ï¼‰</h4></blockquote><table><thead><tr><th>å­—æ®µåç§°</th><th>å¡«å…¥å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>åç§°</td><td>nfs-storage</td><td>è‡ªå®šä¹‰å­˜å‚¨ç±»åç§°</td></tr><tr><td>NFS Server</td><td>172.26.165.243</td><td>NFSæœåŠ¡çš„IPåœ°å€</td></tr><tr><td>NFS Path</td><td>/nfs/data</td><td>NFSæœåŠ¡æ‰€å…±äº«çš„è·¯å¾„</td></tr></tbody></table><ul><li><p>åœ¨MasterèŠ‚ç‚¹ä¸Šé¢æ“ä½œ</p></li><li><p>å…ˆåˆ›å»ºæˆæƒ</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumes&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumeclaims&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storage.k8s.io&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storageclasses&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> run<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;endpoints&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Recreate
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
          <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/external_storage/nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">:</span>latest
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /persistentvolumes
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PROVISIONER_NAME	<span class="token comment"># provisionerçš„åå­—ï¼Œéœ€è¦å’ŒStorageClasså¯¹è±¡ä¸­çš„provisionerå­—æ®µä¸€è‡´</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> shisuyun/nfs
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_SERVER
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 10.10.10.128		<span class="token comment"># NFSæœåŠ¡å™¨åœ°å€</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_PATH       
              <span class="token key atrule">value</span><span class="token punctuation">:</span> /nfs/data			<span class="token comment"># NFSæœåŠ¡å™¨ç›®å½•</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
          <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
            <span class="token key atrule">server</span><span class="token punctuation">:</span> 10.10.10.128		<span class="token comment"># NFSæœåŠ¡å™¨åœ°å€</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/data				<span class="token comment"># NFSæœåŠ¡å™¨ç›®å½•</span>

<span class="token comment">##è¿™ä¸ªé•œåƒä¸­volumeçš„mountPathé»˜è®¤ä¸º/persistentvolumesï¼Œä¸èƒ½ä¿®æ”¹ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¼šæŠ¥é”™</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>åœ¨Masterä¸Šåˆ›å»ºprovisioner</code></li><li><code>åˆ›å»ºå­˜å‚¨ç±»</code></li><li><code>æ”¹å˜é»˜è®¤sc</code></li></ul><blockquote><h4 id="reclaim-policy-æœ‰ä¸‰ç§æ–¹å¼-retainã€recycleã€deletedã€‚" tabindex="-1"><a class="header-anchor" href="#reclaim-policy-æœ‰ä¸‰ç§æ–¹å¼-retainã€recycleã€deletedã€‚" aria-hidden="true">#</a> &quot;reclaim policy&quot;æœ‰ä¸‰ç§æ–¹å¼ï¼šRetainã€Recycleã€Deletedã€‚</h4></blockquote><p><code>Retain</code></p><ul><li><p>ä¿æŠ¤è¢«PVCé‡Šæ”¾çš„PVåŠå…¶ä¸Šæ•°æ®ï¼Œå¹¶å°†PVçŠ¶æ€æ”¹æˆ&quot;released&quot;ï¼Œä¸å°†è¢«å…¶å®ƒPVCç»‘å®šã€‚é›†ç¾¤ç®¡ç†å‘˜æ‰‹åŠ¨é€šè¿‡å¦‚ä¸‹æ­¥éª¤é‡Šæ”¾å­˜å‚¨èµ„æº</p></li><li><p>æ‰‹åŠ¨åˆ é™¤PVï¼Œä½†ä¸å…¶ç›¸å…³çš„åç«¯å­˜å‚¨èµ„æºå¦‚(AWS EBS, GCE PD, Azure Disk, or Cinder volume)ä»ç„¶å­˜åœ¨ã€‚</p></li><li><p>æ‰‹åŠ¨æ¸…ç©ºåç«¯å­˜å‚¨volumeä¸Šçš„æ•°æ®ã€‚</p></li><li><p>æ‰‹åŠ¨åˆ é™¤åç«¯å­˜å‚¨volumeï¼Œæˆ–è€…é‡å¤ä½¿ç”¨åç«¯volumeï¼Œä¸ºå…¶åˆ›å»ºæ–°çš„PVã€‚</p></li></ul><p><code>Delete</code></p><ul><li><p>åˆ é™¤è¢«PVCé‡Šæ”¾çš„PVåŠå…¶åç«¯å­˜å‚¨volumeã€‚å¯¹äºåŠ¨æ€PVå…¶&quot;reclaim policy&quot;ç»§æ‰¿è‡ªå…¶&quot;storage class&quot;ï¼Œ</p></li><li><p>é»˜è®¤æ˜¯Deleteã€‚é›†ç¾¤ç®¡ç†å‘˜è´Ÿè´£å°†&quot;storage class&quot;çš„&quot;reclaim policy&quot;è®¾ç½®æˆç”¨æˆ·æœŸæœ›çš„å½¢å¼ï¼Œå¦åˆ™éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ä¸ºåˆ›å»ºåçš„åŠ¨æ€PVç¼–è¾‘&quot;reclaim policy&quot;</p></li></ul><p><code>Recycle</code></p><ul><li>ä¿ç•™PVï¼Œä½†æ¸…ç©ºå…¶ä¸Šæ•°æ®ï¼Œå·²åºŸå¼ƒ</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$  vi storageclass<span class="token punctuation">-</span>nfs.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> storage<span class="token punctuation">-</span>nfs
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> storage.pri/nfs
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete

$ kubectl apply <span class="token punctuation">-</span>f storageclass<span class="token punctuation">-</span>nfs.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#æ”¹å˜ç³»ç»Ÿé»˜è®¤sc</span>
https://kubernetes.io/zh/docs/tasks/administer-cluster/change-default-storage-class/<span class="token comment">#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%94%b9%e5%8f%98%e9%bb%98%e8%ae%a4-storage-class</span>

$ kubectl patch storageclass storage-nfs <span class="token parameter variable">-p</span> <span class="token string">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="éªŒè¯nfsåŠ¨æ€ä¾›åº”" tabindex="-1"><a class="header-anchor" href="#éªŒè¯nfsåŠ¨æ€ä¾›åº”" aria-hidden="true">#</a> éªŒè¯nfsåŠ¨æ€ä¾›åº”</h4></blockquote><ul><li><h4 id="åˆ›å»ºpvc" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºpvc" aria-hidden="true">#</a> åˆ›å»ºpvc</h4></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vi  pvc.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>claim<span class="token punctuation">-</span><span class="token number">01</span>
 <span class="token comment"># annotations:</span>
 <span class="token comment">#   volume.beta.kubernetes.io/storage-class: &quot;storage-nfs&quot;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> storage<span class="token punctuation">-</span>nfs  <span class="token comment">#è¿™ä¸ªclassä¸€å®šæ³¨æ„è¦å’Œscçš„åå­—ä¸€æ ·</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h4 id="ä½¿ç”¨pvc" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨pvc" aria-hidden="true">#</a> ä½¿ç”¨pvc</h4></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vi testpod.yaml
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/bin/sh&quot;</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1&quot;</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mnt&quot;</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> <span class="token string">&quot;Never&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>claim<span class="token punctuation">-</span><span class="token number">01</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…metrics-server" tabindex="-1"><a class="header-anchor" href="#å®‰è£…metrics-server" aria-hidden="true">#</a> å®‰è£…metrics-server:</h3><p>å…ˆå®‰è£…metrics-server(yamlå¦‚ä¸‹ï¼Œå·²ç»æ”¹å¥½äº†é•œåƒå’Œé…ç½®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨)ï¼Œè¿™æ ·å°±èƒ½ç›‘æ§åˆ°podã€‚nodeçš„èµ„æºæƒ…å†µï¼ˆé»˜è®¤åªæœ‰cpuã€memoryçš„èµ„æºå®¡è®¡ä¿¡æ¯å“Ÿï¼Œæ›´ä¸“ä¸šçš„æˆ‘ä»¬åé¢å¯¹æ¥ Prometheusï¼‰</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vim  metrics.yaml 
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">:</span>aggregated<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>reader
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-view</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-edit</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-admin</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;metrics.k8s.io&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodes&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server<span class="token punctuation">:</span>system<span class="token punctuation">:</span>auth<span class="token punctuation">-</span>delegator
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">:</span>auth<span class="token punctuation">-</span>delegator
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>reader
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> extension<span class="token punctuation">-</span>apiserver<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>reader
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiregistration.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> APIService
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> v1beta1.metrics.k8s.io
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">group</span><span class="token punctuation">:</span> metrics.k8s.io
  <span class="token key atrule">version</span><span class="token punctuation">:</span> v1beta1
  <span class="token key atrule">insecureSkipTLSVerify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">groupPriorityMinimum</span><span class="token punctuation">:</span> <span class="token number">100</span>
  <span class="token key atrule">versionPriority</span><span class="token punctuation">:</span> <span class="token number">100</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token comment"># mount in tmp so we can safely use from-scratch images and/or read-only containers</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>dir
        <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
        <span class="token key atrule">image</span><span class="token punctuation">:</span> mirrorgooglecontainers/metrics<span class="token punctuation">-</span>server<span class="token punctuation">-</span>amd64<span class="token punctuation">:</span>v0.3.6
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>cert<span class="token punctuation">-</span>dir=/tmp
          <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secure<span class="token punctuation">-</span>port=4443
          <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>insecure<span class="token punctuation">-</span>tls
          <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>preferred<span class="token punctuation">-</span>address<span class="token punctuation">-</span>types=InternalIP<span class="token punctuation">,</span>ExternalIP<span class="token punctuation">,</span>Hostname
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> main<span class="token punctuation">-</span>port
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">4443</span>
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>dir
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
        <span class="token key atrule">kubernetes.io/arch</span><span class="token punctuation">:</span> <span class="token string">&quot;amd64&quot;</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/name</span><span class="token punctuation">:</span> <span class="token string">&quot;Metrics-server&quot;</span>
    <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> main<span class="token punctuation">-</span>port
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">:</span>metrics<span class="token punctuation">-</span>server
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token punctuation">-</span> nodes
  <span class="token punctuation">-</span> nodes/stats
  <span class="token punctuation">-</span> namespaces
  <span class="token punctuation">-</span> configmaps
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">:</span>metrics<span class="token punctuation">-</span>server
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">:</span>metrics<span class="token punctuation">-</span>server
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  
$ kubectl apply <span class="token punctuation">-</span>f  metrics.yaml 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/theme-docs/src/zh/isKcount/2/CKA/02.Kuberneteséƒ¨ç½².md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: admin@example.com">Administrator</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2022 isKcount</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.85823306.js" defer></script>
  </body>
</html>
