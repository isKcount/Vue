<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html"><meta property="og:site_name" content="文档演示"><meta property="og:title" content="Kubernetes安全"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-11T05:08:11.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-01-22T12:12:08.000Z"><meta property="article:modified_time" content="2022-10-11T05:08:11.000Z"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Kubernetes安全 | 文档演示</title><meta name="description" content="vuepress-theme-hope 的文档演示">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7cb9ac72.css">
    <link rel="modulepreload" href="/assets/app.85823306.js"><link rel="modulepreload" href="/assets/10.Kubernetes安全.html.edc1c86a.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/10.Kubernetes安全.html.4c657990.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/zh" class="brand"><img class="logo" src="/logo.svg" alt="文档演示"><!----><span class="site-name hide-in-pad">文档演示</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/zh" class="nav-link" aria-label="isKcount"><span class="icon iconfont icon-home"></span>isKcount<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="分类"><span class="title"><span class="icon iconfont icon-interact"></span>分类</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/isKcount/1/" class="nav-link" aria-label="学习路线规划"><span class="icon iconfont icon-ability"></span>学习路线规划<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/2/" class="nav-link active" aria-label="考证"><span class="icon iconfont icon-relation"></span>考证<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/3/" class="nav-link" aria-label="运维笔记"><span class="icon iconfont icon-linux"></span>运维笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/4/" class="nav-link" aria-label="后端开发笔记"><span class="icon iconfont icon-note"></span>后端开发笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/5/" class="nav-link" aria-label="前端开发笔记"><span class="icon iconfont icon-like"></span>前端开发笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/6/" class="nav-link" aria-label="中间件服务笔记"><span class="icon iconfont icon-api"></span>中间件服务笔记<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Devops"><span class="title"><span class="icon iconfont icon-select"></span>Devops</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/cicd/git/" class="nav-link" aria-label="Git开发手册"><span class="icon iconfont icon-git"></span>Git开发手册<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/ci/" class="nav-link" aria-label="CICD"><span class="icon iconfont icon-ci"></span>CICD<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/istio/" class="nav-link" aria-label="Istio"><span class="icon iconfont icon-material"></span>Istio<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/operator/" class="nav-link" aria-label="Operator"><span class="icon iconfont icon-proxy"></span>Operator<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://wallhaven.cc/" rel="noopener noreferrer" target="_blank" aria-label="Wallhaven" class="nav-link"><span class="icon iconfont icon-autumn"></span>Wallhaven<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zh/isKcount/" class="nav-link sidebar-link sidebar-page" aria-label="指南"><span class="icon iconfont icon-creative"></span>指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">学习路线规划</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-relation"></span><span class="title">考证</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux"></span><span class="title">运维笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">后端开发笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-like"></span><span class="title">前端开发笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-api"></span><span class="title">中间件服务笔记</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Kubernetes安全</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://iskcount.github.io" target="_blank" rel="noopener noreferrer">isKcount</a></span><span property="author" content="isKcount"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年1月22日</span><meta property="datePublished" content="2022-01-22T12:12:08.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#kubernetes安全框架" class="router-link-active router-link-exact-active toc-link level2">Kubernetes安全框架</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#认证、授权、准入控制" class="router-link-active router-link-exact-active toc-link level2">认证、授权、准入控制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#基于角色的权限访问控制-rbac" class="router-link-active router-link-exact-active toc-link level2">基于角色的权限访问控制：RBAC</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#角色" class="router-link-active router-link-exact-active toc-link level3">角色</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#角色绑定" class="router-link-active router-link-exact-active toc-link level3">角色绑定</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#主体-subject" class="router-link-active router-link-exact-active toc-link level3">主体（subject）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#rolebinding和clusterrolebinding" class="router-link-active router-link-exact-active toc-link level3">RoleBinding和ClusterRoleBinding</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#role和rolebinding使用" class="router-link-active router-link-exact-active toc-link level3">Role和RoleBinding使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#第1步-创建用户凭证" class="router-link-active router-link-exact-active toc-link level3">第1步：创建⽤户凭证</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#第2步-创建⻆色" class="router-link-active router-link-exact-active toc-link level3">第2步：创建⻆⾊</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#第3步-创建⻆色权限绑定" class="router-link-active router-link-exact-active toc-link level3">第3步：创建⻆⾊权限绑定</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#第4步-测试" class="router-link-active router-link-exact-active toc-link level3">第4步：测试</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#网络策略概述" class="router-link-active router-link-exact-active toc-link level2">网络策略概述</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#一些应用场景" class="router-link-active router-link-exact-active toc-link level3">一些应用场景：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#pod网络入口方向隔离" class="router-link-active router-link-exact-active toc-link level3">Pod网络入口方向隔离：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#pod网络出口方向隔离" class="router-link-active router-link-exact-active toc-link level3">Pod网络出口方向隔离:</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#networkpolicy的选项" class="router-link-active router-link-exact-active toc-link level3">NetworkPolicy的选项</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#对项目pod出入流量控制-隔离" class="router-link-active router-link-exact-active toc-link level2">对项目Pod出入流量控制：隔离</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/10.Kubernetes%E5%AE%89%E5%85%A8.html#对项目pod出入流量控制-单向访问" class="router-link-active router-link-exact-active toc-link level2">对项目Pod出入流量控制：单向访问</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="kubernetes安全" tabindex="-1"><a class="header-anchor" href="#kubernetes安全" aria-hidden="true">#</a> KUbernetes安全</h1><h2 id="kubernetes安全框架" tabindex="-1"><a class="header-anchor" href="#kubernetes安全框架" aria-hidden="true">#</a> Kubernetes安全框架</h2><p>K8S安全控制框架主要由下面3个阶段进行控制，每一个阶段都支持插件方式，通过API Server配置来启用插件。</p><ol><li><strong><code>Authentication（鉴权）</code></strong></li><li><strong><code>Authorization（授权）</code></strong></li><li><strong><code>Admission Control（准入控制）</code></strong></li></ol><p>客户端想要访问k8s集群API Server，一般需要证书，Token或者用户名+密码；如果Pod访问，需要ServiceAccount</p><h2 id="认证、授权、准入控制" tabindex="-1"><a class="header-anchor" href="#认证、授权、准入控制" aria-hidden="true">#</a> 认证、授权、准入控制</h2><blockquote><p><strong>鉴权Authentication</strong></p></blockquote><ul><li>K8s Apiserver提供三种客户端认证： <ul><li><code>HTTPS证书认证</code>： 基于CA证书签名的数字证书认证</li><li><code>HTTP Token认证</code>：通过一个Token来识别用户</li><li><code>HTTP Base认证</code>： 用户名+密码的方式认证 <code>（基本不采用）</code></li></ul></li></ul><blockquote><p><strong>授权Authorization</strong></p></blockquote><p><code>RBAC （Role-Based Access Control,基于角色的访问控制）：负责完成授权（Authorization工作）。</code></p><p>RBAC根据API请求属性，决定允许还是拒绝。</p><ul><li><p><strong>比较常见的授权维度：</strong></p><ul><li><code>user</code>： 用户名</li><li><code>group</code>： 用户分组</li><li>资源,例如Pod ConfigMaps Deployments Nodes Secrets Namespaces</li><li><code>资源操作方法</code>： get,list,create,update,patch,watch,delete</li><li>命名空间</li><li>API组</li></ul></li></ul><blockquote><p><strong>准入控制Admission Control</strong></p></blockquote><p>Admission Control实际上是一个准入控制器插件列表，发到API Server的请求都需要经过这个列表中的每个准入控制器插件来检查，检查不通过，则拒绝请求。</p><h2 id="基于角色的权限访问控制-rbac" tabindex="-1"><a class="header-anchor" href="#基于角色的权限访问控制-rbac" aria-hidden="true">#</a> 基于角色的权限访问控制：RBAC</h2><p>RBAC 使⽤ <a href="http://rbac.authorization.k8s.io" target="_blank" rel="noopener noreferrer">rbac.authorization.k8s.io<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> API Group 来实现授权决策，允许管理员通过 Kubernetes API 动态配置策略，要启⽤ RBAC ，需要在 apiserver 中添加参数 --authorization-mode=RBAC ，如果 使⽤的 kubeadm 安装的集群，1.6 版本以上的都默认开启了 RBAC ，可以通过查看 Master 节点上 apiserver 的静态 Pod 定义⽂件：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> /etc/kubernetes/manifests/kube-apiserver.yaml
<span class="token punctuation">..</span>.
- --authorization-mode<span class="token operator">=</span>Node,RBAC
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>RBAC（Role-Based Access Control，基于角色的访问控制），允许Kubernetes API动态配置策略。</strong></p><ul><li><h3 id="角色" tabindex="-1"><a class="header-anchor" href="#角色" aria-hidden="true">#</a> 角色</h3><ul><li><strong><code>Role</code></strong>： 授权特定命名空间的访问权限</li><li><strong><code>ClusterRole</code></strong>： 授权所有命名空间的访问权限</li></ul></li><li><h3 id="角色绑定" tabindex="-1"><a class="header-anchor" href="#角色绑定" aria-hidden="true">#</a> 角色绑定</h3><ul><li><strong><code>RoleBinding</code></strong>： 将角色绑定到主体（即subject）</li><li><strong><code>ClusterRoleBinding</code></strong>： 将集群角色绑定到主体</li></ul></li><li><h3 id="主体-subject" tabindex="-1"><a class="header-anchor" href="#主体-subject" aria-hidden="true">#</a> 主体（subject）</h3><ul><li><strong><code>User</code></strong>： 用户</li><li><strong><code>Group</code></strong>： 用户组</li><li><strong><code>cluster-admin</code></strong>：K8s中默认管理员角色</li><li><strong><code>ServiceAccount</code></strong>： 服务账号</li></ul></li><li><h3 id="rolebinding和clusterrolebinding" tabindex="-1"><a class="header-anchor" href="#rolebinding和clusterrolebinding" aria-hidden="true">#</a> RoleBinding和ClusterRoleBinding</h3><ul><li>RoleBinding 和 ClusterRoleBinding：⻆⾊绑定和集群⻆⾊绑定，简单来说就是把声明的 Subject 和我们的 Role 进⾏绑定的过程(给某个⽤户绑定上操作的权限)，⼆者的区别也是作⽤范围的区 别：RoleBinding 只会影响到当前 namespace 下⾯的资源操作权限，⽽ ClusterRoleBinding 会影 响到所有的 namespace。</li></ul></li></ul><blockquote><h3 id="role和rolebinding使用" tabindex="-1"><a class="header-anchor" href="#role和rolebinding使用" aria-hidden="true">#</a> Role和RoleBinding使用</h3></blockquote><ul><li>创建⼀个只能访问某个 namespace 的⽤户</li><li>我们来创建⼀个 User Account，只能访问 kube-system 这个命名空间： <ul><li>username: haima</li><li>group: haimamax</li></ul></li></ul><h3 id="第1步-创建用户凭证" tabindex="-1"><a class="header-anchor" href="#第1步-创建用户凭证" aria-hidden="true">#</a> 第1步：创建⽤户凭证</h3><ul><li>这⾥我们来使⽤ OpenSSL 证书来创建⼀个 User，给⽤户 haima 创建⼀个私钥，命名成：haima.key：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out haima.key 2048</span>
Generating RSA private key, <span class="token number">2048</span> bit long modulus
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++
e is <span class="token number">65537</span> <span class="token punctuation">(</span>0x10001<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使⽤我们刚刚创建的私钥创建⼀个证书签名请求⽂件：haima.csr，要注意需要确保在 -subj 参 数中指定⽤户名和组(CN表示⽤户名，O表示组)：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req -new -key haima.key -out haima.csr -subj &quot;/CN=haima/O=haimamax&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>然后找到我们的 Kubernetes 集群的 CA ，我们使⽤的是 kubeadm 安装的集群， CA 相关证书位 于 /etc/kubernetes/pki/ ⽬录下⾯，利⽤该⽬录下⾯的 ca.crt 和 ca.key 两个⽂件来批准上⾯ 的证书请求。</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509 -req -in haima.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out haima.crt -days 500</span>
Signature ok
<span class="token assign-left variable">subject</span><span class="token operator">=</span>/CN<span class="token operator">=</span>haima/O<span class="token operator">=</span>haimamax
Getting CA Private Key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>现在查看我们当前⽂件夹下⾯是否⽣成了⼀个证书⽂件：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ll</span>
-rw-r--r-- <span class="token number">1</span> root root        <span class="token number">997</span> Nov  <span class="token number">7</span> <span class="token number">21</span>:27 haima.crt
-rw-r--r-- <span class="token number">1</span> root root        <span class="token number">911</span> Nov  <span class="token number">7</span> <span class="token number">21</span>:25 haima.csr
-rw-r--r-- <span class="token number">1</span> root root       <span class="token number">1675</span> Nov  <span class="token number">7</span> <span class="token number">21</span>:23 haima.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>现在我们可以使⽤刚刚创建的证书⽂件和私钥⽂件在集群中创建新的凭证和上下⽂(Context):</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl config set-credentials haima --client-certificate=haima.crt --client-key=haima.key </span>
User <span class="token string">&quot;haima&quot;</span> set.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>我们可以看到⼀个⽤户 haima 创建了，然后为这个⽤户设置新的 Context:</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl config set-context haima-context --cluster=kubernetes --namespace=kube-system --user=haima</span>
Context <span class="token string">&quot;haima-context&quot;</span> created.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>到这⾥，我们的⽤户 haima 就已经创建成功了，现在我们使⽤当前的这个配置⽂件来操 作 kubectl 命令的时候，应该会出现错误，因为我们还没有为该⽤户定义任何操作的权限呢：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --context=haima-context </span>
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: pods is forbidden: User <span class="token string">&quot;haima&quot;</span> cannot list resource <span class="token string">&quot;pods&quot;</span> <span class="token keyword">in</span> API group <span class="token string">&quot;&quot;</span> <span class="token keyword">in</span> the namespace <span class="token string">&quot;kube-system&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第2步-创建⻆色" tabindex="-1"><a class="header-anchor" href="#第2步-创建⻆色" aria-hidden="true">#</a> <strong>第2步：创建⻆⾊</strong></h3><ul><li>⽤户创建完成后，接下来就需要给该⽤户添加操作权限，我们来定义⼀个 YAML ⽂件，创建⼀个允许 ⽤户操作 Deployment、Pod、ReplicaSets 的⻆⾊，如下定义：</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create role haima --namespace=kube-system --resource=pods,deployments,replicasets --verb=* --dry-run -o yaml &gt; haima-role.yaml </span>
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat haima-role.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&#39;*&#39;</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> deployments
  <span class="token punctuation">-</span> replicasets
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&#39;*&#39;</span>
  
注：
其中 Pod 属于 core 这个 API Group，在 YAML 中⽤空字符就可以，⽽ Deployment 属于 apps 这个API Group， ReplicaSets 属于 extensions 这个 API Group所以rules 下⾯的 apiGroups 就综合了这⼏个资源的 API Group：<span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;extensions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apps&quot;</span><span class="token punctuation">]</span>，其中 verbs 就是我们上⾯提到的可以对这些资源对象执⾏的操作，我们这⾥需要所有的操作⽅法，所以我们也可以使⽤<span class="token punctuation">[</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">]</span>来代替。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后创建这个 Role ：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f haima-role.yaml  </span>
role.rbac.authorization.k8s.io/haima created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get role -n kube-system | grep haima </span>
haima                                            <span class="token number">2021</span>-11-07T22:05:29Z

注：注意这⾥我们没有使⽤上⾯的 haimaxy-context 这个上下⽂了，因为⽊有权限
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第3步-创建⻆色权限绑定" tabindex="-1"><a class="header-anchor" href="#第3步-创建⻆色权限绑定" aria-hidden="true">#</a> <strong>第3步：创建⻆⾊权限绑定</strong></h3><ul><li>Role 创建完成了，但是很明显现在我们这个 Role 和我们的⽤户 haima 还没有任何关系，对吧？这 ⾥我就需要创建⼀个 RoleBinding 对象，在 kube-system 这个命名空间下⾯将上⾯的 haimaxy-role ⻆ ⾊和⽤户 haima 进⾏绑定</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create rolebinding haima-rolebinding --namespace=kube-system --role haima-role --user=haima --dry-run -o yaml &gt; haima-rolebinding.yaml </span>
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat  haima-rolebinding.yaml    </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>rolebinding
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>role
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> User
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>上⾯的 YAML ⽂件中我们看到了 subjects 关键字，这⾥就是我们上⾯提到的⽤来尝试操作集群的对 象，这⾥对应上⾯的 User 帐号 haimaxy，使⽤ kubectl 创建上⾯的资源对象：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f haima-rolebinding.yaml  </span>
rolebinding.rbac.authorization.k8s.io/haima-rolebinding created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get rolebindings -n kube-system  | grep haima </span>
haima-rolebinding                                   Role/haima-role                                       21s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第4步-测试" tabindex="-1"><a class="header-anchor" href="#第4步-测试" aria-hidden="true">#</a> <strong>第4步：测试</strong></h3><ul><li>现在我们应该可以上⾯的 haimaxy-context 上下⽂来操作集群了：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --context=haima-context </span>
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: pods is forbidden: User <span class="token string">&quot;haima&quot;</span> cannot list resource <span class="token string">&quot;pods&quot;</span> <span class="token keyword">in</span> API group <span class="token string">&quot;&quot;</span> <span class="token keyword">in</span> the namespace <span class="token string">&quot;kube-system&quot;</span><span class="token builtin class-name">:</span> RBAC: role.rbac.authorization.k8s.io <span class="token string">&quot;haima-role&quot;</span> not found
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>我们可以看到我们使⽤ kubectl 的使⽤并没有指定 namespace 了，这是因为我们已经为该⽤户分配 了权限了，如果我们在后⾯加上⼀个 -n default</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --context=haima-context -n default                                        </span>
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: pods is forbidden: User <span class="token string">&quot;haima&quot;</span> cannot list resource <span class="token string">&quot;pods&quot;</span> <span class="token keyword">in</span> API group <span class="token string">&quot;&quot;</span> <span class="token keyword">in</span> the namespace <span class="token string">&quot;default&quot;</span>

注：
是符合我们预期的吧？因为该⽤户并没有 default 这个命名空间的操作权限
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>创建⼀个只能访问某个 namespace 的ServiceAccount</code></li><li>上⾯我们创建了⼀个只能访问某个命名空间下⾯的普通⽤户，我们前⾯也提到过 subjects 下⾯还有⼀ 直类型的主题资源：ServiceAccount，现在我们来创建⼀个集群内部的⽤户只能操作 kube-system 这 个命名空间下⾯的 pods 和 deployments，⾸先来创建⼀个 ServiceAccount 对象：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create sa haima-sa -n kube-system  </span>
serviceaccount/haima-sa created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后新建⼀个 Role 对象：</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create role haima-sa-role --namespace=kube-system --resource=pod,deployments --verb=get,watch,list,create,update,patch,delete  --dry-run -o yaml &gt; haima-sa-role.yaml</span>

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># vi haima-sa-role.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa<span class="token punctuation">-</span>role
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> list
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> deployments
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> delete
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>可以看到我们这⾥定义的⻆⾊没有创建、删除、更新 Pod 的权限，待会我们可以重点测试⼀下，创建 该 Role 对象：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f haima-sa-role.yaml </span>
role.rbac.authorization.k8s.io/haima-sa-role created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get role -n kube-system | grep sa</span>
haimaxy-sa-role                                  <span class="token number">2021</span>-11-07T20:56:00Z
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后创建⼀个 RoleBinding 对象，将上⾯的 haimaxy-sa 和⻆⾊ haimaxy-sa-role 进⾏绑定：</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create rolebinding haima-sa-rolebinding --namespace=kube-system --role=haima-sa-role --serviceaccount kube-system:haima-sa --dry-run -o yaml &gt; haima-sa-rolebinding.yaml </span>

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat  haima-sa-rolebinding.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa<span class="token punctuation">-</span>rolebinding
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa<span class="token punctuation">-</span>role
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>添加这个资源对象：</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f  haima-rolebinding.yaml  </span>
rolebinding.rbac.authorization.k8s.io/haima-sa-rolebinding created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get rolebinding -n kube-system | grep sa</span>
haima-sa-rolebinding                                Role/haima-sa-role                                    26s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后我们怎么去验证这个 ServiceAccount 呢？我们前⾯的课程中是不是提到过⼀个 ServiceAccount 会⽣成⼀个 Secret 对象和它进⾏映射，这个 Secret ⾥⾯包含⼀个 token，我们可以利⽤这个 token 去 登录 Dashboard，然后我们就可以在 Dashboard 中来验证我们的功能是否符合预期了：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets -n kube-system | grep haima-sa</span>
haima-sa-token-k26k7                             kubernetes.io/service-account-token   <span class="token number">3</span>      20m

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment">#  kubectl get secret haima-sa-token-k26k7 -o jsonpath={.data.token} -n kube-system |base64 -d </span>
eyJhbGciOiJSUzI1NiIsImtpZCI6IjNzT0lqNW1qTjBCcjBQcTRseTdPc0ZoWDd1T3hXazRtWHk1TGI1alp0QU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJoYWltYS1zYS10b2tlbi1rMjZrNyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJoYWltYS1zYSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6Ijc1ZDc4Mzc3LTY4MGItNDhiNS04YTM1LWEzY2UxODhlZTJhNyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpoYWltYS1zYSJ9.ubKdejm1cCRcEcNLUCUrXCkD6BahSnyEhxszyfBSol6FDhBqRiz2G7IuIgF4EGlvfmnFTmBsKD8iyDfCAwfGMqg_crwFc8DFPyACLjjPVAI-zLdQhlsfnQrulFVCftbVA3HjQ3qF04Uu59jPm7Hm4ap-1SRHSzxnqGWLHQpwJpSdh8lk1C4uRWyJLXQz0_2prQH5roFySmvKRvVujcEqsv_Meu9h9HoSNQNN1oyhfx9kZLCviMALeLxWB8WkhfZzKDVN0bag2g8i7Q-i_76I19C0dd-F-wueQOjA86R9x7RcuakqET_5pkl31bxfA6xUOY8p25s3koP5RjshIskclA<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>使⽤这⾥的 token 去 Dashboard ⻚⾯进⾏登录：</p><p><img src="https://pic.imgdb.cn/item/61ebf3e22ab3f51d911abf79.png" alt="" loading="lazy"></p></li></ul><p><img src="https://pic.imgdb.cn/item/61ebf3e22ab3f51d911abf7d.png" alt="" loading="lazy"></p><ul><li><p><code>我们可以看到可以访问pod列表了，但是也会有⼀些其他额外的提示：events is forbidden: User “system:serviceaccount:kube-system:haimaxy-sa” cannot list events in the namespace “kube-system”，这是因为当前登录⽤只被授权了访问 pod 和 deployment 的权限.</code></p></li><li><p>创建⼀个可以访问所有 namespace 的ServiceAccount</p></li><li><p>如果我们现在创建⼀ 个新的 ServiceAccount，需要他操作的权限作⽤于所有的 namespace，这个时候我们就需要使⽤到 ClusterRole 和 ClusterRoleBinding 这两种资源对象了。同样，⾸先新建⼀个 ServiceAcount 对象：</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat haima-sa2.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f haima-sa2.yaml  </span>
serviceaccount/haimaxy<span class="token punctuation">-</span>sa2 created 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后创建⼀个 ClusterRoleBinding 对象:</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat clusterrolebinding.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa2<span class="token punctuation">-</span>clusterrolebinding
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> haima<span class="token punctuation">-</span>sa2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>从上⾯我们可以看到我们没有为这个资源对象声明 namespace，因为这是⼀个 ClusterRoleBinding 资 源对象，是作⽤于整个集群的，我们也没有单独新建⼀个 ClusterRole 对象，⽽是使⽤的 cluster-admin 这个对象，这是 Kubernetes 集群内置的 ClusterRole 对象，我们可以使⽤ kubectl get clusterrole 和 kubectl get clusterrolebinding 查看系统内置的⼀些集群⻆⾊和集群⻆⾊绑定，这 ⾥我们使⽤的 cluster-admin 这个集群⻆⾊是拥有最⾼权限的集群⻆⾊，所以⼀般需要谨慎使⽤该集群 ⻆⾊。</code></p></blockquote><ul><li>创建上⾯集群⻆⾊绑定资源对象，创建完成后同样使⽤ ServiceAccount 对应的 token 去登录 Dashboard 验证下：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f clusterrolebinding.yaml            </span>
clusterrolebinding.rbac.authorization.k8s.io/haima-sa2-clusterrolebinding created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets -n kube-system | grep haima</span>
haima-sa-token-khljg                             kubernetes.io/service-account-token   <span class="token number">3</span>      14m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="网络策略概述" tabindex="-1"><a class="header-anchor" href="#网络策略概述" aria-hidden="true">#</a> 网络策略概述</h2><p>网络策略（Network Policy），用于限制Pod出入流量，提供Pod级别和Nameaspace级别的网络访问控制。flannel不支持，calico是支持的。</p><ul><li>Pod 可以通信的 Pod 是通过如下三个标识符的组合来辩识的： <ul><li><strong><code>其他被允许的 Pods（例外：Pod 无法阻塞对自身的访问）</code></strong></li><li><strong><code>被允许的名字空间</code></strong></li><li><strong><code>IP 组块（例外：与 Pod 运行所在的节点的通信总是被允许的， 无论 Pod 或节点的 IP 地址）</code></strong></li></ul></li></ul><h3 id="一些应用场景" tabindex="-1"><a class="header-anchor" href="#一些应用场景" aria-hidden="true">#</a> 一些应用场景：</h3><ul><li>应用程序的访问控制。例如微服务A允许访问微服务B，微服务C不能访问微服务A</li><li>开发环境命名空间不能访问测试环境命名空间Pod</li><li>当Pod暴露到外部时，需要做Pod白名单</li><li>多租户网络环境隔离</li></ul><h3 id="pod网络入口方向隔离" tabindex="-1"><a class="header-anchor" href="#pod网络入口方向隔离" aria-hidden="true">#</a> Pod网络入口方向隔离：</h3><ul><li>基于Pod级网络隔离： 只允许特定对象访问Pod（使用标签定义），允许白名单上的IP地址或者IP段访问Pod。</li><li>基于Namespace级网络隔离： 多个命名空间，A和B命名空间Pod完全隔离</li></ul><h3 id="pod网络出口方向隔离" tabindex="-1"><a class="header-anchor" href="#pod网络出口方向隔离" aria-hidden="true">#</a> <strong>Pod网络出口方向隔离:</strong></h3><ul><li>拒绝某一个Namespace上所有的Pod访问外部</li><li>基于目的IP的网络隔离： 只允许Pod访问白名单上的IP地址或者IP段</li><li>基于目标端的网络隔离： 只允许Pod访问白名单上的端口</li></ul><h3 id="networkpolicy的选项" tabindex="-1"><a class="header-anchor" href="#networkpolicy的选项" aria-hidden="true">#</a> NetworkPolicy的选项</h3><ul><li><p><code>podSelector：</code>目标Pod，根据标签选择，每个 NetworkPolicy 都包括一个 <code>podSelector</code>，它对该策略所 适用的一组 Pod 进行选择。</p></li><li><p><code>policyTypes：</code>策略类型，每个 NetworkPolicy 都包含一个 <code>policyTypes</code> 列表，其中包含 <code>Ingress</code> 或 <code>Egress</code> 或两者兼具。指定策略用于入站，出站流量。 如果 NetworkPolicy 未指定 policyTypes 则默认情况下始终设置 <code>Ingress</code>； 如果 NetworkPolicy 有任何出口规则的话则设置 <code>Egress</code></p></li><li><p><code>Ingress：</code>每个 NetworkPolicy 可包含一个 <code>ingress</code> 规则的白名单列表。 每个规则都允许同时匹配 <code>from</code> 和 <code>ports</code> 部分的流量。</p></li><li><p><code>Egress:</code> 每个 NetworkPolicy 可包含一个 <code>egress</code> 规则的白名单列表。 每个规则都允许匹配 <code>to</code> 和 <code>port</code> 部分的流量。该示例策略包含一条规则， 该规则将指定端口上的流量匹配到 10.0.0.0/24 中的任何目的地。</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># vim networkpolicy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>network<span class="token punctuation">-</span>policy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>					<span class="token comment">#标签选择器</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>			
      <span class="token key atrule">role</span><span class="token punctuation">:</span> db					<span class="token comment">#匹配role等于db的</span>
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>					<span class="token comment">#策略的类型</span>
  <span class="token punctuation">-</span> Ingress						<span class="token comment">#Ingress类型  指定入口的流量</span>
  <span class="token punctuation">-</span> Egress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>						<span class="token comment">#指定入口流量</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>						<span class="token comment">#入口流量来自哪里</span>
    <span class="token punctuation">-</span> <span class="token key atrule">ipBlock</span><span class="token punctuation">:</span>				
        <span class="token key atrule">cidr</span><span class="token punctuation">:</span> 172.17.0.0/16		<span class="token comment">#指定该ip的段16掩码是可以访问我</span>
        <span class="token key atrule">except</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 172.17.1.0/24			<span class="token comment">#除了该网段24掩码的不能访问</span>
    <span class="token punctuation">-</span> <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>		<span class="token comment">#命名空间标签选择器</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">project</span><span class="token punctuation">:</span> myproject	<span class="token comment">#myproject的标签</span>
    <span class="token punctuation">-</span> <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>				<span class="token comment">#Pod标签选择 </span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">role</span><span class="token punctuation">:</span> frontend		<span class="token comment">#role的标签的Pod可以访问</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>						<span class="token comment">#port的协议以及端口</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP	
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token key atrule">egress</span><span class="token punctuation">:</span>						<span class="token comment">#限制出口流量</span>
  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span>							
    <span class="token punctuation">-</span> <span class="token key atrule">ipBlock</span><span class="token punctuation">:</span>	
        <span class="token key atrule">cidr</span><span class="token punctuation">:</span> 10.0.0.0/24		<span class="token comment">#可以访问该网段</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP				<span class="token comment">#可以访问该网段的端口</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5978</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="对项目pod出入流量控制-隔离" tabindex="-1"><a class="header-anchor" href="#对项目pod出入流量控制-隔离" aria-hidden="true">#</a> 对项目Pod出入流量控制：隔离</h2><ul><li><p><strong><code>将default命名空间携带app=web标签的Pod隔离，只允许default命名空间携带run=client1标签的Pod访问80端口</code></strong></p></li><li><p>准备测试环境（做好ingress）</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web --image=nginx </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run client1 --image=busybox --sleep 36000</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run client2 --image=busybox --sleep 36000</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                  READY   STATUS    RESTARTS   AGE
client1               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          53m
client2               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          53m
web-96d5df5c8-w2vvf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          53m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>先不做网络策略尝试</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide </span>
NAME                  READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
client1               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m   <span class="token number">10.244</span>.167.130   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
client2               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m   <span class="token number">10.244</span>.167.131   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-96d5df5c8-w2vvf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m   <span class="token number">10.244</span>.167.129   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>可以发现没有网络策略是可以ping可以拉取</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it  client1  -- sh </span>
/ <span class="token comment"># ping 10.244.167.129</span>
PING <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">10.244</span>.167.129: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.088</span> ms
<span class="token number">64</span> bytes from <span class="token number">10.244</span>.167.129: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.073</span> ms
^C
--- <span class="token number">10.244</span>.167.129 <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">2</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.073</span>/0.080/0.088 ms


/ <span class="token comment"># wget 10.244.167.129</span>
Connecting to <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129:80<span class="token punctuation">)</span>
saving to <span class="token string">&#39;index.html&#39;</span>
index.html           <span class="token number">100</span>% <span class="token operator">|</span>**********************************************************************************************************<span class="token operator">|</span>   <span class="token number">615</span>  <span class="token number">0</span>:00:00 ETA
<span class="token string">&#39;index.html&#39;</span> saved
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建一个将app=web的pod隔离，run=client1的可以访问</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat networkpolicy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>network<span class="token punctuation">-</span>policy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>			<span class="token comment">#隔离app=web的pods</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> web 
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Ingress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>			<span class="token comment">#只允许run=client1的访问tcp的80端口</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span> 
          <span class="token key atrule">run</span><span class="token punctuation">:</span> client1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>测试网络策略是否生效</p></li><li><p>此时会发现networkpolicy的入口流量被阻断，无法ping通，但是可以访问80端口</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f networkpolicy.yaml </span>
networkpolicy.networking.k8s.io/test-network-policy created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it  client1  -- sh </span>
/ <span class="token comment"># ping 10.244.167.129</span>
PING <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
^C
--- <span class="token number">10.244</span>.167.129 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">0</span> packets received, <span class="token number">100</span>% packet loss

/ <span class="token comment"># wget 10.244.167.129</span>
Connecting to <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129:80<span class="token punctuation">)</span>
saving to <span class="token string">&#39;index.html&#39;</span>
index.html           <span class="token number">100</span>% <span class="token operator">|</span>**********************************************************************************************************<span class="token operator">|</span>   <span class="token number">615</span>  <span class="token number">0</span>:00:00 ETA
<span class="token string">&#39;index.html&#39;</span> saved
/ <span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>用client2去测试，发现都被阻断了</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it  client2  -- sh </span>
/ <span class="token comment"># ping 10.244.167.129</span>
PING <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
^C
--- <span class="token number">10.244</span>.167.129 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">0</span> packets received, <span class="token number">100</span>% packet loss
/ <span class="token comment"># wget 10.244.167.129</span>
Connecting to <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129:80<span class="token punctuation">)</span>
^C
/ <span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="对项目pod出入流量控制-单向访问" tabindex="-1"><a class="header-anchor" href="#对项目pod出入流量控制-单向访问" aria-hidden="true">#</a> 对项目Pod出入流量控制：单向访问</h2><ul><li><p>default命名空间的所有Pod可以互相访问，也可以访问其他命名空间的Pod，但是其他命名空间的Pod不能访问default的Pod。</p></li><li><p><code>podSelector：{}</code> ：如果未配置，默认所有Pod</p></li><li><p><code>from.podSelector：{}</code> ：如果未配置，默认不允许</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat networkpolicy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> np2 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">#针对当前命名空间所有</span>
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Ingress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">podSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">#所有默认不允许</span>
    
    
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f networkpolicy.yaml </span>
networkpolicy.networking.k8s.io/np2 created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用之前的三个默认命名空间的Pod</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                  READY   STATUS    RESTARTS   AGE
client1               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          82m
client2               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          82m
web-96d5df5c8-w2vvf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          82m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>再创建一个kube-system的client3做实验</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run client3 --image=busybox --namespace=kube-system -- sleep 36000</span>
pod/client3 created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system | grep client3 </span>
client3                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          92s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看当前default的Pods和kube-system的Pods</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system  -o wide </span>
NAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE     NOMINATED NODE   READINESS GATES
···
coredns-7f89b7bc75-qf8dg                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          154m    <span class="token number">10.244</span>.219.65    master   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods   -o wide </span>
NAME                  READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
client1               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          83m   <span class="token number">10.244</span>.167.130   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
client2               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          83m   <span class="token number">10.244</span>.167.131   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-96d5df5c8-w2vvf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          84m   <span class="token number">10.244</span>.167.129   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用clinet1去测试，去ping两个命名空间的pods，发现成功ping通</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it client1 -- sh </span>
/ <span class="token comment"># ping 10.244.219.65</span>
PING <span class="token number">10.244</span>.219.65 <span class="token punctuation">(</span><span class="token number">10.244</span>.219.65<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">10.244</span>.219.65: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">62</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.525</span> ms
^C
--- <span class="token number">10.244</span>.219.65 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">1</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.525</span>/0.525/0.525 ms
/ <span class="token comment"># ping 10.244.167.129</span>
PING <span class="token number">10.244</span>.167.129 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.129<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">10.244</span>.167.129: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.100</span> ms
^C
--- <span class="token number">10.244</span>.167.129 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">1</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.100</span>/0.100/0.100 ms
/ <span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用kube-system命名空间的client3测试</li><li>可以看出直接被拒绝访问</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it client3 -n kube-system -- sh </span>
/ <span class="token comment"># ping 10.244.167.130</span>
PING <span class="token number">10.244</span>.167.130 <span class="token punctuation">(</span><span class="token number">10.244</span>.167.130<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
^C
--- <span class="token number">10.244</span>.167.130 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">0</span> packets received, <span class="token number">100</span>% packet loss
/ <span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/theme-docs/src/zh/isKcount/2/CKA/10.Kubernetes安全.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: admin@example.com">Administrator</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2022 isKcount</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.85823306.js" defer></script>
  </body>
</html>
