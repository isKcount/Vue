<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html"><meta property="og:site_name" content="æ–‡æ¡£æ¼”ç¤º"><meta property="og:title" content="Kuberneteså­˜å‚¨"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-11T05:08:11.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-01-22T12:12:07.000Z"><meta property="article:modified_time" content="2022-10-11T05:08:11.000Z"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Kuberneteså­˜å‚¨ | æ–‡æ¡£æ¼”ç¤º</title><meta name="description" content="vuepress-theme-hope çš„æ–‡æ¡£æ¼”ç¤º">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7cb9ac72.css">
    <link rel="modulepreload" href="/assets/app.85823306.js"><link rel="modulepreload" href="/assets/09.Kuberneteså­˜å‚¨.html.40d84c27.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/09.Kuberneteså­˜å‚¨.html.d3232f40.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/zh" class="brand"><img class="logo" src="/logo.svg" alt="æ–‡æ¡£æ¼”ç¤º"><!----><span class="site-name hide-in-pad">æ–‡æ¡£æ¼”ç¤º</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/zh" class="nav-link" aria-label="isKcount"><span class="icon iconfont icon-home"></span>isKcount<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†ç±»"><span class="title"><span class="icon iconfont icon-interact"></span>åˆ†ç±»</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/isKcount/1/" class="nav-link" aria-label="å­¦ä¹ è·¯çº¿è§„åˆ’"><span class="icon iconfont icon-ability"></span>å­¦ä¹ è·¯çº¿è§„åˆ’<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/2/" class="nav-link active" aria-label="è€ƒè¯"><span class="icon iconfont icon-relation"></span>è€ƒè¯<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/3/" class="nav-link" aria-label="è¿ç»´ç¬”è®°"><span class="icon iconfont icon-linux"></span>è¿ç»´ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/4/" class="nav-link" aria-label="åç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-note"></span>åç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/5/" class="nav-link" aria-label="å‰ç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-like"></span>å‰ç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/6/" class="nav-link" aria-label="ä¸­é—´ä»¶æœåŠ¡ç¬”è®°"><span class="icon iconfont icon-api"></span>ä¸­é—´ä»¶æœåŠ¡ç¬”è®°<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Devops"><span class="title"><span class="icon iconfont icon-select"></span>Devops</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/cicd/git/" class="nav-link" aria-label="Gitå¼€å‘æ‰‹å†Œ"><span class="icon iconfont icon-git"></span>Gitå¼€å‘æ‰‹å†Œ<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/ci/" class="nav-link" aria-label="CICD"><span class="icon iconfont icon-ci"></span>CICD<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/istio/" class="nav-link" aria-label="Istio"><span class="icon iconfont icon-material"></span>Istio<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/operator/" class="nav-link" aria-label="Operator"><span class="icon iconfont icon-proxy"></span>Operator<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://wallhaven.cc/" rel="noopener noreferrer" target="_blank" aria-label="Wallhaven" class="nav-link"><span class="icon iconfont icon-autumn"></span>Wallhaven<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zh/isKcount/" class="nav-link sidebar-link sidebar-page" aria-label="æŒ‡å—"><span class="icon iconfont icon-creative"></span>æŒ‡å—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">å­¦ä¹ è·¯çº¿è§„åˆ’</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-relation"></span><span class="title">è€ƒè¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux"></span><span class="title">è¿ç»´ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">åç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-like"></span><span class="title">å‰ç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-api"></span><span class="title">ä¸­é—´ä»¶æœåŠ¡ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Kuberneteså­˜å‚¨</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://iskcount.github.io" target="_blank" rel="noopener noreferrer">isKcount</a></span><span property="author" content="isKcount"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´1æœˆ22æ—¥</span><meta property="datePublished" content="2022-01-22T12:12:07.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 29 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT29M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨å·" class="router-link-active router-link-exact-active toc-link level2">ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨å·ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#æ•°æ®å·æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">æ•°æ®å·æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#ä¸´æ—¶å­˜å‚¨å·-emptydir" class="router-link-active router-link-exact-active toc-link level2">ä¸´æ—¶å­˜å‚¨å·ï¼šemptyDir</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#èŠ‚ç‚¹å­˜å‚¨å·-hostpath" class="router-link-active router-link-exact-active toc-link level2">èŠ‚ç‚¹å­˜å‚¨å·ï¼šhostPath</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#ç½‘ç»œå­˜å‚¨å·-nfs" class="router-link-active router-link-exact-active toc-link level2">ç½‘ç»œå­˜å‚¨å·: NFS</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#æŒä¹…å·-pvä¸pvc" class="router-link-active router-link-exact-active toc-link level2">æŒä¹…å·ï¼šPVä¸PVC</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#pvç”Ÿå‘½å‘¨æœŸ" class="router-link-active router-link-exact-active toc-link level2">PVç”Ÿå‘½å‘¨æœŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#pvä¸pvcä½¿ç”¨æµç¨‹" class="router-link-active router-link-exact-active toc-link level2">PVä¸PVCä½¿ç”¨æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#pvä¸pvcå¸¸è§é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">PVä¸PVCå¸¸è§é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#pv-åŠ¨æ€ä¾›ç»™-storageclass" class="router-link-active router-link-exact-active toc-link level2">PV åŠ¨æ€ä¾›ç»™ï¼ˆStorageClassï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²-statefulsetæ§åˆ¶å™¨" class="router-link-active router-link-exact-active toc-link level2">æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²ï¼šStatefulSetæ§åˆ¶å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#statefulset" class="router-link-active router-link-exact-active toc-link level2">StatefulSetï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶å­˜å‚¨-configmap" class="router-link-active router-link-exact-active toc-link level2">åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶å­˜å‚¨ï¼šConfigMap</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#configmapçš„ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">configMapçš„ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#æ•æ„Ÿæ•°æ®å­˜å‚¨-secret" class="router-link-active router-link-exact-active toc-link level2">æ•æ„Ÿæ•°æ®å­˜å‚¨ï¼šSecret</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#secretçš„docker-registryä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">Secretçš„docker-registryä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKA/09.Kubernetes%E5%AD%98%E5%82%A8.html#secret-ä¸-configmap-å¯¹æ¯”" class="router-link-active router-link-exact-active toc-link level2">Secret ä¸ ConfigMap å¯¹â½</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="kuberneteså­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#kuberneteså­˜å‚¨" aria-hidden="true">#</a> Kuberneteså­˜å‚¨</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨å·" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨å·" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨å·ï¼Ÿ</h2><ul><li><p><strong>å®¹å™¨éƒ¨ç½²è¿‡ç¨‹ä¸­ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§æ•°æ®ï¼š</strong></p></li><li><p><strong>å¯åŠ¨æ—¶éœ€è¦çš„åˆå§‹æ•°æ®ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶</strong></p></li><li><p><strong>å¯åŠ¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶æ•°æ®ï¼Œè¯¥ä¸´æ—¶æ•°æ®éœ€è¦å¤šä¸ªå®¹å™¨é—´å…±äº«</strong></p></li><li><p><strong>å¯åŠ¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æŒä¹…åŒ–æ•°æ®ï¼Œä¾‹å¦‚MySQLçš„dataç›®å½•</strong></p><img src="https://pic.imgdb.cn/item/61ebef7f2ab3f51d9116771f.png" style="zoom:67%;"></li></ul><h2 id="æ•°æ®å·æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å·æ¦‚è¿°" aria-hidden="true">#</a> æ•°æ®å·æ¦‚è¿°</h2><ul><li><p><code>Kubernetesä¸­çš„Volumeæä¾›äº†åœ¨å®¹å™¨ä¸­æŒ‚è½½å¤–éƒ¨å­˜å‚¨çš„èƒ½åŠ›</code></p></li><li><p>Podéœ€è¦è®¾ç½®å·æ¥æºï¼ˆspec.volumeï¼‰å’ŒæŒ‚è½½ç‚¹ï¼ˆspec.containers.volumeMountsï¼‰ä¸¤ä¸ªä¿¡æ¯åæ‰å¯ä»¥ä½¿ç”¨ç›¸åº”çš„Volume</p></li><li><p>ä½¿ç”¨æ•°æ®å·çš„æµç¨‹ï¼šé•œåƒé‡Œç¨‹åºå†™çš„ç›®å½• &gt; mountPath &gt; å¼•ç”¨çš„volumeså¯¹åº”çš„name &gt; ç›¸å…³å·çš„é…ç½®</p></li><li><p><strong>å¸¸ç”¨çš„æ•°æ®å·ï¼š</strong></p><ul><li><p>æœ¬åœ°ï¼ˆhostPathï¼ŒemptyDirï¼‰</p></li><li><p>ç½‘ç»œï¼ˆNFSï¼ŒCephï¼ŒGlusterFSï¼‰</p></li><li><p>å…¬æœ‰äº‘ï¼ˆAWS EBSï¼‰</p></li><li><p>K8Sèµ„æºï¼ˆconfigmapï¼Œsecretï¼‰</p></li></ul></li></ul><h2 id="ä¸´æ—¶å­˜å‚¨å·-emptydir" tabindex="-1"><a class="header-anchor" href="#ä¸´æ—¶å­˜å‚¨å·-emptydir" aria-hidden="true">#</a> ä¸´æ—¶å­˜å‚¨å·ï¼šemptyDir</h2><ul><li><p><strong>emptyDirå·ï¼š</strong></p><ul><li><strong>æ˜¯ä¸€ä¸ªä¸´æ—¶å­˜å‚¨å·ï¼Œä¸Podç”Ÿå‘½å‘¨æœŸç»‘å®šä¸€èµ·ï¼Œå¦‚æœ Podåˆ é™¤äº†å·ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</strong></li><li><strong>å…±äº«ç›®å½•æ˜¯åœ¨Podçš„æ‰€åœ¨èŠ‚ç‚¹åˆ›å»ºçš„ã€‚</strong></li></ul></li><li><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><code>Podä¸­å®¹å™¨ä¹‹é—´æ•°æ®å…±äº«</code></li><li><code>sideacerï¼ˆè¾¹è½¦ï¼‰</code></li><li><code>initcontainerï¼ˆåˆå§‹å®¹å™¨ï¼‰</code></li></ul></li></ul><blockquote><p><strong>emptyDirçš„ç”¨æ³•</strong></p></blockquote><ul><li><p><strong>ä½¿ç”¨emptyDirçš„ä¸´æ—¶å­˜å‚¨å·æµ‹è¯•Podä¹‹é—´</strong></p></li><li><p><strong>ä¸€ä¸ªPodæ˜¯å†™å…¥1åˆ°100åˆ°helloæ–‡ä»¶ï¼Œå¦å¤–ä¸€ä¸ªPodæ˜¯è¯»å–ï¼Œä»–ä»¬ä¹‹é—´ä½¿ç”¨ä¸´æ—¶å·å…±äº«</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> write					<span class="token comment">#å®¹å™¨ä¸€æ˜¯å†™å…¥														</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;for i in {1..100};do echo $i &gt;&gt; /data/hello;sleep 1;done&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>				<span class="token comment">#æ•°æ®å·çš„æŒ‚è½½</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data				<span class="token comment">#æ•°æ®å·ç»‘å®šçš„åç§°</span>
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data		<span class="token comment">#ä½¿ç”¨è·¯å¾„æŒ‚è½½åœ¨å®¹å™¨å†…éƒ¨</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> read					<span class="token comment">#å®¹å™¨äºŒæ˜¯è¯»å–</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tail -f /data/hello&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data

  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>						<span class="token comment">#æ•°æ®å·å®šä¹‰</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data					<span class="token comment">#æ•°æ®å·æŒ‡å®šä¸€ä¸ªåç§°</span>
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>				<span class="token comment">#æ•°æ®å·çš„ç±»å‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>æŸ¥çœ‹Podè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šé¢</strong></p></li><li><p><strong>è¿™é‡Œæ˜¾ç¤ºæ˜¯åœ¨Node1èŠ‚ç‚¹ä¸Šé¢ï¼Œå¯ä»¥å»Node1ä¸ŠæŸ¥çœ‹</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide</span>
NAME     READY   STATUS    RESTARTS   AGE     IP               NODE    NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">2</span>/2     Running   <span class="token number">1</span>          2m42s   <span class="token number">10.244</span>.166.131   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åœ¨node1èŠ‚ç‚¹æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„è¿›ç¨‹</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep my-pod </span>
4d0d67966468   centos                                               <span class="token string">&quot;bash -c &#39;tail -f /dâ€¦&quot;</span>   About a minute ago   Up About a minute             k8s_read_my-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0 <span class="token comment">#è¿™é‡Œçš„åé¢çš„idå°±æ˜¯æ•°æ®å·å­˜å‚¨çš„ç›®å½•</span>
60cdb7fa3d29   centos                                               <span class="token string">&quot;bash -c &#39;for i in {â€¦&quot;</span>   About a minute ago   Up About a minute             k8s_writemy-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0
1c898733272d   registry.aliyuncs.com/google_containers/pause:3.2    <span class="token string">&quot;/pause&quot;</span>                 About a minute ago   Up About a minute             k8s_POD_my-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŸ¥æ‰¾æ•°æ®å·æ˜ å°„çš„ç›®å½•</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/kubelet/pods/</span>
<span class="token punctuation">[</span>root@node1 pods<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">5</span> 00:24 4a359535-0bea-4231-9ac7-e7b0d91afb74   <span class="token comment">#ç¬¬ä¸€ä¸ªå°±æ˜¯è¿™ä¸ªPod</span>
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">23</span>:31 b08e29c6-ba4b-4416-89e2-48df0a101535
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">23</span>:32 b98cfa42-b9c9-47db-a0d7-2aeb468a24d1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 pods<span class="token punctuation">]</span><span class="token comment"># cd 4a359535-0bea-4231-9ac7-e7b0d91afb74/volumes/kubernetes.io~empty-dir/</span>
<span class="token punctuation">[</span>root@node1 kubernetes.io~empty-dir<span class="token punctuation">]</span><span class="token comment"># ls </span>
data															<span class="token comment">#è¿™ä¸ªdataå°±æ˜¯è¯¥Podè¿›è¡Œçš„æ•°æ®å·å…±äº«çš„ç›®å½•</span>
<span class="token punctuation">[</span>root@node1 kubernetes.io~empty-dir<span class="token punctuation">]</span><span class="token comment"># cd data/</span>
<span class="token punctuation">[</span>root@node1 data<span class="token punctuation">]</span><span class="token comment"># ls</span>
hello               
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="èŠ‚ç‚¹å­˜å‚¨å·-hostpath" tabindex="-1"><a class="header-anchor" href="#èŠ‚ç‚¹å­˜å‚¨å·-hostpath" aria-hidden="true">#</a> <strong>èŠ‚ç‚¹å­˜å‚¨å·ï¼šhostPath</strong></h2><ul><li><p><strong>hostPathå·ï¼š</strong></p><ul><li><strong>æŒ‚è½½Nodeæ–‡ä»¶ç³»ç»Ÿï¼ˆPodæ‰€åœ¨èŠ‚ç‚¹ï¼‰ä¸Šæ–‡ä»¶æˆ–è€…ç›® å½•åˆ°Podä¸­çš„å®¹å™¨ã€‚</strong></li></ul></li><li><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>Podä¸­å®¹å™¨éœ€è¦è®¿é—®å®¿ä¸»æœºæ–‡ä»¶</strong></li><li><strong>æˆ‘çš„åº”ç”¨ç¨‹åºæƒ³è¯»å–ç³»ç»Ÿçš„æŸä¸ªæ–‡ä»¶</strong></li></ul></li></ul><blockquote><p><strong>hostPathçš„ç”¨æ³•</strong></p></blockquote><ul><li><p><strong>ä½¿ç”¨æŒ‚è½½å®¿ä¸»æœºçš„/tmpçš„ç›®å½•</strong></p></li><li><p><strong>å®¹å™¨æŒ‚è½½åœ¨/dataç›®å½•ä¸‹</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat hostpath.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> sleep 36000
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>			<span class="token comment">#æŒ‚è½½åœ¨å®¹å™¨çš„æ•°æ®å·</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data			<span class="token comment">#æŒ‡å®šå®šä¹‰åç§°</span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data		<span class="token comment">#æŒ‚è½½åœ¨å®¹å™¨çš„/dataä½ç½®</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>					<span class="token comment">#æŒ‡å®šæ•°æ®å·çš„æ¥æº</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data				<span class="token comment">#æŒ‡å®šå®šä¹‰åç§°</span>
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /tmp			<span class="token comment">#æŒ‡å®šæ•°æ®å·æºç›®å½•</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Directory		<span class="token comment">#æŒ‡å®šæ•°æ®å·ç±»å‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>è¿›å…¥å®¹å™¨æŸ¥çœ‹/dataä¸‹é¢æ˜¯å¦æœ‰æ•°æ®</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master tmp<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it my-pod  -- sh</span>
/ <span class="token comment"># cd /data/</span>
/data <span class="token comment"># ls</span>
hsperfdata_root
systemd-private-55c453af06944c75a71a7703af924fc9-chronyd.service-re7Kjy
wrapper-619-1-in
wrapper-619-1-out
/data <span class="token comment"># touch  a.tzxt   #åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>æŸ¥çœ‹è¯¥Podæ˜¯è¿è¡Œåœ¨å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢</strong></p></li><li><p><strong>æŸ¥çœ‹è¯¥èŠ‚ç‚¹çš„/tmpä¸‹é¢æ˜¯å¦æœ‰æˆ‘åˆ›å»ºçš„æ–‡ä»¶</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master tmp<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME     READY   STATUS    RESTARTS   AGE   IP               NODE    NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          14m   <span class="token number">10.244</span>.166.132   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># cd /tmp/</span>
<span class="token punctuation">[</span>root@node1 tmp<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">8</span>
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:53 a.tzxt
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">21</span>:39 hsperfdata_root
drwx------ <span class="token number">3</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">21</span>:38 systemd-private-55c453af06944c75a71a7703af924fc9-chronyd.service-re7Kjy
prw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:56 wrapper-619-1-in
prw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:56 wrapper-619-1-out
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç½‘ç»œå­˜å‚¨å·-nfs" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œå­˜å‚¨å·-nfs" aria-hidden="true">#</a> ç½‘ç»œå­˜å‚¨å·: NFS</h2><ul><li><p><code>Kubernetesçš„NFSå­˜å‚¨ç”¨äºå°†æŸäº‹å…ˆå­˜åœ¨çš„NFSæœåŠ¡å™¨å¯¼å‡ºexportçš„å­˜å‚¨ç©ºé—´æŒ‚è½½åˆ°Podä¸­æ¥ä¾›Podå®¹å™¨ä½¿ç”¨ã€‚</code></p></li><li><p>ä¸emptyDirä¸åŒçš„æ˜¯ï¼ŒNFSå­˜å‚¨åœ¨Podå¯¹è±¡ç»ˆæ­¢åä»…æ˜¯è¢«å¸è½½è€Œéåˆ é™¤ã€‚å¦å¤–ï¼ŒNFSæ˜¯æ–‡ä»¶ç³»ç»ŸåŠå…±äº«æœåŠ¡ï¼Œå®ƒæ”¯æŒåŒæ—¶å­˜åœ¨å¤šè·¯æŒ‚è½½è¯·æ±‚ã€‚</p></li><li><p><strong>ä½¿ç”¨nfsæ•°æ®å·ç›®æ ‡ï¼š</strong></p><ul><li>podå¯åŠ¨ä¹‹åäº§ç”Ÿçš„æ•°æ®æŒä¹…åŒ–åˆ°è¿œç¨‹å­˜å‚¨</li><li>podå¤šå‰¯æœ¬å…±äº«æ•°æ®</li></ul></li><li><p><strong>å®šä¹‰NFSå­˜å‚¨æ—¶ï¼Œå¸¸ç”¨åˆ°ä»¥ä¸‹å­—æ®µã€‚</strong></p><ul><li><code>server</code> ï¼šNFSæœåŠ¡å™¨çš„IPåœ°å€æˆ–è€…ä¸»æœºåï¼Œå¿…é€‰å­—æ®µã€‚</li><li><code>path</code> ï¼šNFSæœåŠ¡å™¨å¯¼å‡º(å…±äº«)çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œå¿…é€‰å­—æ®µã€‚</li><li><code>readOnly</code> ï¼šæ˜¯å¦ä»¥åªè¯»æŒ‚è½½ï¼Œé»˜è®¤ä¸ºfalseã€‚</li></ul></li></ul><blockquote><p><strong>NFSæŒä¹…åŒ–çš„ç”¨æ³•</strong></p></blockquote><ul><li><strong>åœ¨node1ä¸Šå®‰è£…NFSæœåŠ¡ç«¯</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># yum install -y nfs-utils </span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;/nfs/kubernetes *(rw,no_root_squash)&quot; &gt; /etc/exports</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /nfs/kubernetes</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart rpcbind &amp;&amp; systemctl restart nfs </span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;666&quot; &gt; index.html /nfs/kubernetes</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># showmount -e 192.168.1.88</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®è¯´æ˜ï¼š</strong></p><p><code>/data/k8sï¼š</code> æ˜¯å…±äº«çš„æ•°æ®â½¬å½•** <code>* ï¼š</code> è¡¨ç¤ºä»»ä½•â¼ˆéƒ½æœ‰æƒé™è¿æ¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯â¼€ä¸ªâ½¹æ®µï¼Œâ¼€ä¸ª IPï¼Œä¹Ÿå¯ä»¥æ˜¯åŸŸå** <code>rwï¼š</code> è¯»å†™çš„æƒé™** <code>syncï¼š</code> è¡¨ç¤ºâ½‚ä»¶åŒæ—¶å†™â¼Šç¡¬ç›˜å’Œå†…å­˜** <code>no_root_squashï¼š</code> å½“ç™»å½• NFS ä¸»æœºä½¿â½¤å…±äº«â½¬å½•çš„ä½¿â½¤è€…æ˜¯ root æ—¶ï¼Œå…¶æƒé™å°†è¢«è½¬æ¢æˆä¸ºåŒ¿åä½¿â½¤è€…ï¼Œé€šå¸¸å®ƒçš„ UID ä¸ GIDï¼Œéƒ½ä¼šå˜æˆ nobody èº«ä»½</p><ul><li>åœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…NFSæœåŠ¡ç«¯</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y nfs-utils </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart rpcbind &amp;&amp; systemctl restart nfs </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mount -t nfs 192.168.1.88:/nfs/kubernetes /mnt/ </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åˆ›å»ºä¸€ä¸ªpodæ§åˆ¶å™¨ä½¿ç”¨ç½‘ç»œå…±äº«NFSå­˜å‚¨æŒ‚è½½</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image=nginx --port=80 --dry-run -o yaml &gt; deployment.yaml </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml  </span>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: <span class="token number">1</span>
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx
        name: nginx
        ports:
        - containerPort: <span class="token number">80</span>
        volumeMounts: 
        - name: wwwroot 
          mountPath: /usr/share/nginx/html 
      volumes: 
      - name: wwwroot 
        nfs: 
          server: <span class="token number">192.168</span>.1.95
          path: /nfs/kubernetes
          
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f  deployment.yaml  </span>
deployment.apps/nginx created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ£€æŸ¥nfså­˜å‚¨æ˜¯å¦ç”Ÿæ•ˆ</li><li>å‘ç°å®¹å™¨å†…æŒ‚è½½åœ¨/usr/share/nginx/htmlä¸‹é¢çš„index.htmlæ­£æ˜¯æ‰€å†™å…¥å¾—åˆ°å†…å®¹</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it nginx-cfb45c844-8zcqh bash</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> -- <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> instead.
root@nginx-cfb45c844-8zcqh:/<span class="token comment"># cd /usr/share/nginx/html/</span>
root@nginx-cfb45c844-8zcqh:/usr/share/nginx/html<span class="token comment"># ls</span>
index.html
root@nginx-cfb45c844-8zcqh:/usr/share/nginx/html<span class="token comment"># cat index.html </span>
<span class="token number">6666</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æš´éœ²è¯¥ç«¯å£ä½¿ç”¨Nodeportè®¿é—®</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose deployment nginx --port=80 --target-port=80 --type=NodePort</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get service </span>
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        115m
nginx        NodePort    <span class="token number">10.110</span>.18.210   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30354/TCP   35m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æŒä¹…å·-pvä¸pvc" tabindex="-1"><a class="header-anchor" href="#æŒä¹…å·-pvä¸pvc" aria-hidden="true">#</a> æŒä¹…å·ï¼šPVä¸PVC</h2><p><strong>æŒä¹…å·çš„æ¦‚è¿°ï¼š</strong></p><ul><li><p><code>PersistentVolumeï¼ˆPVï¼‰</code>ï¼šå¯¹å­˜å‚¨èµ„æºåˆ›å»ºå’Œä½¿ç”¨çš„æŠ½è±¡ï¼Œä½¿å¾—å­˜å‚¨ä½œä¸ºé›†ç¾¤ä¸­çš„èµ„æºç®¡ç†</p></li><li><p><code>PersistentVolumeClaimï¼ˆPVCï¼‰</code>ï¼šè®©ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„Volumeå®ç°ç»†èŠ‚</p></li></ul><p>â€‹æŒä¹…å·ï¼ˆPersistentVolumeï¼ŒPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥ç”±ç®¡ç†å‘˜äº‹å…ˆä¾›åº”ï¼Œæˆ–è€… ä½¿ç”¨<a href="https://kubernetes.io/zh/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener noreferrer">å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ¥åŠ¨æ€ä¾›åº”ã€‚ æŒä¹…å·æ˜¯é›†ç¾¤èµ„æºï¼Œå°±åƒèŠ‚ç‚¹ä¹Ÿæ˜¯é›†ç¾¤èµ„æºä¸€æ ·ã€‚PV æŒä¹…å·å’Œæ™®é€šçš„ Volume ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ å·æ’ä»¶æ¥å®ç°çš„ï¼Œåªæ˜¯å®ƒä»¬æ‹¥æœ‰ç‹¬ç«‹äºä»»ä½•ä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>â€‹æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼ŒPVCï¼‰è¡¨è¾¾çš„æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„è¯·æ±‚ã€‚æ¦‚å¿µä¸Šä¸ Pod ç±»ä¼¼ã€‚ Pod ä¼šè€—ç”¨èŠ‚ç‚¹èµ„æºï¼Œè€Œ PVC ç”³é¢†ä¼šè€—ç”¨ PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šæ•°é‡çš„èµ„æºï¼ˆCPU å’Œå†…å­˜ï¼‰ï¼›åŒæ · PVC ç”³é¢†ä¹Ÿå¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥è¦æ±‚ PV å·èƒ½å¤Ÿä»¥ ReadWriteOnceã€ReadOnlyMany æˆ– ReadWriteMany æ¨¡å¼ä¹‹ä¸€æ¥æŒ‚è½½</p><h2 id="pvç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#pvç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> PVç”Ÿå‘½å‘¨æœŸ</h2><img src="https://pic.imgdb.cn/item/61ebf35f2ab3f51d911a4384.png" style="zoom:67%;"><blockquote><p><strong>Capacityï¼ˆå­˜å‚¨èƒ½â¼’ï¼‰</strong></p></blockquote><p>â¼€èˆ¬æ¥è¯´ï¼Œâ¼€ä¸ª PV å¯¹è±¡éƒ½è¦æŒ‡å®šâ¼€ä¸ªå­˜å‚¨èƒ½â¼’ï¼Œé€šè¿‡ PV çš„ capacityå±æ€§æ¥è®¾ç½®çš„ï¼Œâ½¬å‰åªâ½€æŒå­˜å‚¨ ç©ºé—´çš„è®¾ç½®ï¼Œå°±æ˜¯æˆ‘ä»¬è¿™â¾¥çš„ storage=1Giï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ â¼Š IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®ã€‚</p><blockquote><p><strong>AccessModesï¼ˆè®¿é—®æ¨¡å¼ï¼‰</strong></p></blockquote><p>AccessModes æ˜¯â½¤æ¥å¯¹ PV è¿›â¾è®¿é—®æ¨¡å¼çš„è®¾ç½®ï¼Œâ½¤äºæè¿°â½¤æˆ·åº”â½¤å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒ é™åŒ…æ‹¬ä¸‹â¾¯â¼ç§â½…å¼ï¼š*</p><ul><li><code>ReadWriteOnceï¼ˆRWOï¼‰</code>ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</li><li><code>ReadOnlyManyï¼ˆROXï¼‰</code>ï¼šåªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</li><li><code>ReadWriteManyï¼ˆRWXï¼‰</code>ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</li><li><code>æ³¨æ„</code>ï¼šâ¼€äº› PV å¯èƒ½â½€æŒå¤šç§è®¿é—®æ¨¡å¼ï¼Œä½†æ˜¯åœ¨æŒ‚è½½çš„æ—¶å€™åªèƒ½ä½¿â½¤â¼€ç§è®¿é—®æ¨¡å¼ï¼Œå¤šç§è®¿é—®æ¨¡ å¼æ˜¯ä¸ä¼šâ½£æ•ˆçš„ã€‚</li></ul><blockquote><p><strong>persistentVolumeReclaimPolicyï¼ˆå›æ”¶ç­–ç•¥ï¼‰</strong></p></blockquote><p><strong>æˆ‘è¿™â¾¥æŒ‡å®šçš„ PV çš„å›æ”¶ç­–ç•¥ä¸º Recycleï¼Œâ½¬å‰ PV â½€æŒçš„ç­–ç•¥æœ‰ä¸‰ç§ï¼š</strong></p><ul><li><code>Retainï¼ˆä¿ç•™ï¼‰</code> ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜â¼¿â¼¯æ¸…ç†æ•°æ®</li><li><code>Recycleï¼ˆå›æ”¶ï¼‰</code> æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§â¾ <code>rm -rf /thevoluem/* </code></li><li><code>Deleteï¼ˆåˆ é™¤ï¼‰</code> ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸â»…äºäº‘æœåŠ¡å•†çš„å­˜å‚¨ æœåŠ¡ï¼Œâ½å¦‚ ASW EBSã€‚</li><li>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ½¬å‰åªæœ‰ NFS å’Œ HostPath ä¸¤ç§ç±»å‹â½€æŒå›æ”¶ç­–ç•¥ã€‚å½“ç„¶â¼€èˆ¬æ¥è¯´è¿˜æ˜¯è®¾ç½®ä¸º Retain è¿™ç§ç­–ç•¥ä¿é™©â¼€ç‚¹ã€‚</li></ul><blockquote><p><strong>PVçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</strong></p></blockquote><p>â¼€ä¸ª PV çš„â½£å‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š</p><ul><li><code>Availableï¼ˆå¯â½¤ï¼‰ï¼š</code> è¡¨ç¤ºå¯â½¤çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š</li><li><code>Boundï¼ˆå·²ç»‘å®šï¼‰ï¼š</code> è¡¨ç¤º PVC å·²ç»è¢« PVC ç»‘å®š</li><li><code>Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š</code> PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜</li><li><code>Failedï¼ˆå¤±è´¥ï¼‰ï¼š</code> è¡¨ç¤ºè¯¥ PV çš„â¾ƒåŠ¨å›æ”¶å¤±è´¥</li></ul><h2 id="pvä¸pvcä½¿ç”¨æµç¨‹" tabindex="-1"><a class="header-anchor" href="#pvä¸pvcä½¿ç”¨æµç¨‹" aria-hidden="true">#</a> PVä¸PVCä½¿ç”¨æµç¨‹</h2><blockquote><p><strong>Pvçš„ä½¿ç”¨</strong></p></blockquote><ul><li><p><strong><code>æœ‰äº†ä¸Šâ¾¯çš„ NFS å…±äº«å­˜å‚¨ï¼Œä¸‹â¾¯æˆ‘ä»¬å°±å¯ä»¥æ¥ä½¿â½¤ PV å’Œ PVC äº†ã€‚</code></strong></p></li><li><p>PV ä½œä¸ºå­˜å‚¨èµ„æºï¼Œä¸»è¦åŒ…æ‹¬å­˜å‚¨ èƒ½â¼’ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»å‹ã€å›æ”¶ç­–ç•¥ç­‰å…³é”®ä¿¡æ¯ï¼Œä¸‹â¾¯æˆ‘ä»¬æ¥æ–°å»ºâ¼€ä¸ªPVå¯¹è±¡ï¼Œä½¿â½¤nfsç±»å‹çš„å ç«¯å­˜å‚¨ï¼Œ5G çš„å­˜å‚¨ç©ºé—´ï¼Œè®¿é—®æ¨¡å¼ä¸º ReadWriteOnceï¼Œå›æ”¶ç­–ç•¥ä¸º Recyle</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pv.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>						<span class="token comment">#å­˜å‚¨ç©ºé—´</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>					<span class="token comment">#è®¿é—®æ¨¡å¼</span>
    <span class="token punctuation">-</span> ReadWriteOnce				<span class="token comment">#å•ä¸ªèŠ‚ç‚¹æŒ‚è½½çš„è¯»å†™æƒé™</span>
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Recycle
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/kubernetes
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.1.88
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pv.yaml </span>
persistentvolume/my-pvc created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv </span>
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
my-pvc   5Gi        RWO            Recycle          Available                                   4s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>PVCçš„ä½¿ç”¨</strong></p><p>ä½†æ˜¯åœ¨æˆ‘ä»¬çœŸæ­£ä½¿â½¤çš„æ—¶å€™æ˜¯ä½¿â½¤çš„ PVCï¼Œå°±ç±»ä¼¼äºæˆ‘ä»¬çš„æœåŠ¡æ˜¯é€š è¿‡ Pod æ¥è¿â¾çš„ï¼Œâ½½ä¸æ˜¯ Nodeï¼Œåªæ˜¯ Pod è·‘åœ¨ Node ä¸Šâ½½å·²ï¼Œæ‰€ä»¥è¿™èŠ‚è¯¾æˆ‘ä»¬å°±æ¥ç»™â¼¤å®¶è®²è§£ä¸‹ PVC çš„ä½¿â½¤â½…æ³•ã€‚</p></blockquote><ul><li><strong>æˆ‘ä»¬æ¥æ–°å»ºâ¼€ä¸ªæ•°æ®å·å£°æ˜ï¼Œæˆ‘ä»¬æ¥è¯·æ±‚ 5Gi çš„å­˜å‚¨å®¹é‡ï¼Œè®¿é—®æ¨¡å¼ä¹Ÿæ˜¯ ReadWriteOnce</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pvc.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc    
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>			<span class="token comment">#è®¾ç½®èµ„æº</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>			<span class="token comment">#è¯·æ±‚çš„èµ„æºä¸º5Gi</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>æ­¤æ—¶çš„pvå’Œpvcéƒ½å°†å˜æˆbound</code></strong></p></li><li><p><strong>å› ä¸ºpvçš„å­˜å‚¨ç©ºé—´è¢«pvcç»‘å®šæ‰€æœ‰æ˜¾ç¤ºboundè¢«ä½¿ç”¨</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc.yaml  </span>
persistentvolumeclaim/my-pvc created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc </span>
NAME     STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
my-pvc   Bound    my-pvc   5Gi        RWO                           6s

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM            STORAGECLASS   REASON   AGE
my-pvc   5Gi        RWO            Recycle          Bound    default/my-pvc                           42m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>åˆ›å»ºä¸€ä¸ªPodä½¿ç”¨PVCæŒä¹…åŒ–</code></strong></p></li><li><p><strong>æŒ‡å®šå®¹å™¨æŒ‚è½½ç›®å½•æ˜¯/usr/share/nginx/html</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html 
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span> 
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml  </span>
pod/my-pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME     READY   STATUS    RESTARTS   AGE
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          63s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>éªŒè¯pvcæ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨</strong></p></li><li><p><strong>è¿›å…¥my-podçš„å®¹å™¨ï¼Œåˆ›å»ºindex.htmlçš„æ–‡ä»¶</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it my-pod -- bash</span>
root@my-pod:/<span class="token comment"># cd /usr/share/nginx/html/</span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># ls</span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># echo 3333 &gt;&gt; index.html </span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># exit </span>
<span class="token builtin class-name">exit</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide </span>
NAME     READY   STATUS    RESTARTS   AGE    IP               NODE   NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m7s   <span class="token number">10.244</span>.167.140   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.140</span>
<span class="token number">3333</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>åœ¨nfsçš„æœåŠ¡ç«¯ä¸ŠæŸ¥çœ‹</strong></p></li><li><p><strong>éªŒè¯æˆåŠŸï¼Œ pvcçš„æŒä¹…åŒ–èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># cd /nfs/kubernetes/</span>
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># ls </span>
index.html
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># cat index.html </span>
<span class="token number">3333</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pvä¸pvcå¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#pvä¸pvcå¸¸è§é—®é¢˜" aria-hidden="true">#</a> PVä¸PVCå¸¸è§é—®é¢˜</h2><p><strong>pvä¸pvcå…³ç³»ï¼Ÿ</strong></p><ul><li><strong>ä¸€å¯¹ä¸€çš„å…³ç³»äº’è”</strong></li></ul><p><strong>pvä¸pvcæ€ä¹ˆåŒ¹é…çš„ï¼Ÿ</strong></p><ul><li><strong><code>å­˜å‚¨ç©ºé—´</code></strong></li><li><strong><code>è®¿é—®æ¨¡å¼</code></strong></li></ul><p><strong>å®¹å™¨åŒ¹é…ç­–ç•¥æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</strong></p><ul><li>åŒ¹é…æœ€æ¥è¿‘çš„pvå®¹é‡</li><li>å¦‚æœæ»¡è¶³ä¸äº†ï¼Œpodå¤„äºpending</li></ul><p><strong>å­˜å‚¨ç©ºé—´çš„å­—æ®µæ˜¯é™åˆ¶ä½¿ç”¨å®¹é‡ï¼Ÿ</strong></p><ul><li><strong><code>è¿™ä¸ªå­—æ®µä¸»è¦ç”¨äºåšåŒ¹é…çš„ï¼Œå®é™…ä½¿ç”¨é™åˆ¶å–å†³äºåç«¯å­˜å‚¨</code></strong></li></ul><blockquote><p><strong>ç®€è€Œè¨€ä¹‹ï¼Œæ— çŠ¶æ€å¯ä»¥ç†è§£ä¸ºï¼šä¸ç”¨è€ƒè™‘å¤šå‰¯æœ¬æ—¶ä¹‹é—´çš„å…³ç³»ã€æ˜¯å¦æœ‰ç‹¬ç«‹å­˜å‚¨ç­‰</strong></p></blockquote><h2 id="pv-åŠ¨æ€ä¾›ç»™-storageclass" tabindex="-1"><a class="header-anchor" href="#pv-åŠ¨æ€ä¾›ç»™-storageclass" aria-hidden="true">#</a> PV åŠ¨æ€ä¾›ç»™ï¼ˆStorageClassï¼‰</h2><img src="https://pic.imgdb.cn/item/61ebf37e2ab3f51d911a5fcb.png" style="zoom:67%;"><img src="https://pic.imgdb.cn/item/61ebf3ac2ab3f51d911a8b9d.png" style="zoom:80%;"><p>K8sé»˜è®¤ä¸æ”¯æŒNFSåŠ¨æ€ä¾›ç»™ï¼Œéœ€è¦å•ç‹¬éƒ¨ç½²ç¤¾åŒºå¼€å‘çš„æ’ä»¶ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master nfs-external-provisioner<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">255</span> Mar <span class="token number">27</span>  <span class="token number">2021</span> class.yaml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1054</span> Nov  <span class="token number">5</span> <span class="token number">23</span>:16 deployment.yaml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1819</span> Mar <span class="token number">27</span>  <span class="token number">2021</span> rbac.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>éƒ¨ç½²NFSåŠ¨æ€ä¾›åº”</strong></p></blockquote><ul><li><strong>åˆ›å»ºæˆæƒè®¿é—®apiserver</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat rbac.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumes&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumeclaims&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storage.k8s.io&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storageclasses&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> run<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token comment"># replace with namespace where provisioner is deployed</span>
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;endpoints&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token comment"># replace with namespace where provisioner is deployed</span>
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f rbac.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>éƒ¨ç½²æ’ä»¶ï¼Œéœ€ä¿®æ”¹é‡Œé¢NFSæœåŠ¡å™¨åœ°å€ä¸å…±äº«ç›®å½•</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Recreate
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
          <span class="token key atrule">image</span><span class="token punctuation">:</span> lizhenliang/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">:</span>v4.0.1
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /persistentvolumes
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PROVISIONER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>sigs.io/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_SERVER
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 192.168.1.88					<span class="token comment">#ä¿®æ”¹NFSçš„æœåŠ¡ç«¯çš„åœ°å€</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_PATH			
              <span class="token key atrule">value</span><span class="token punctuation">:</span> /nfs/kubernetes				<span class="token comment">#NFSæœåŠ¡ç«¯çš„å­˜å‚¨è·¯å¾„</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
          <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
            <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.1.88					<span class="token comment">#NFSæœåŠ¡ç«¯åœ°å€</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/kubernetes 					<span class="token comment">#NFSæœåŠ¡ç«¯çš„å­˜å‚¨è·¯å¾„</span>
            
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f deployment.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åˆ›å»ºå­˜å‚¨ç±»</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat class.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>sigs.io/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner <span class="token comment"># or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;</span>
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">archiveOnDelete</span><span class="token punctuation">:</span> <span class="token string">&quot;false&quot;</span>
  
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f class.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æŸ¥çœ‹å­˜å‚¨ç±»</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get sc </span>
NAME                  PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
managed-nfs-storage   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="token boolean">false</span>                  18m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>ä½¿ç”¨åŠ¨æ€ä¾›åº”</strong></p></blockquote><ul><li><strong>â¾¸å…ˆåˆ›å»ºâ¼€ ä¸ªPVCå¯¹è±¡</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat test-pvc.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>æˆ‘ä»¬è¿™â¾¥å£°æ˜äº†â¼€ä¸ª PVC å¯¹è±¡ï¼Œé‡‡â½¤ ReadWriteMany çš„è®¿é—®æ¨¡å¼ï¼Œè¯·æ±‚ 1Mi çš„ç©ºé—´</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ çœ‹åˆ°ä¸Šâ¾¯çš„ PVC â½‚ä»¶æˆ‘ä»¬æ²¡æœ‰æ ‡è¯†å‡ºä»»ä½•å’Œ StorageClass ç›¸å…³è”çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç°åœ¨ç›´æ¥åˆ› å»ºè¿™ä¸ª PVC å¯¹è±¡èƒ½å¤Ÿâ¾ƒåŠ¨ç»‘å®šä¸Šåˆé€‚çš„ PV å¯¹è±¡å—ï¼Ÿæ˜¾ç„¶æ˜¯ä¸èƒ½çš„(å‰ææ˜¯æ²¡æœ‰åˆé€‚çš„ PV)ï¼Œæˆ‘ä»¬è¿™â¾¥ æœ‰ä¸¤ç§â½…æ³•å¯ä»¥æ¥åˆ©â½¤ä¸Šâ¾¯æˆ‘ä»¬åˆ›å»ºçš„ StorageClass å¯¹è±¡æ¥â¾ƒåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºâ¼€ä¸ªåˆé€‚çš„ PV:</p><ul><li><strong>ç¬¬â¼€ç§â½…æ³•ï¼š</strong></li></ul><p><strong><code>åœ¨è¿™ä¸ª PVC å¯¹è±¡ä¸­æ·»åŠ â¼€ä¸ªå£°æ˜storageNameå¯¹è±¡çš„æ ‡è¯†ï¼Œè¿™â¾¥æˆ‘ä»¬å¯ä»¥åˆ©â½¤â¼€ ä¸ªstorageClassNameå±æ€§æ¥æ ‡è¯†ï¼Œå¦‚ä¸‹ï¼š</code></strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat test-pvc.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">&quot;managed-nfs-storage&quot;</span>			
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi 
  
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f test-pvc.yaml</span>
persistentvolumeclaim/test<span class="token punctuation">-</span>pvc created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
my<span class="token punctuation">-</span>pvc     Bound    my<span class="token punctuation">-</span>pvc                                     5Gi        RWO                                  82m
test<span class="token punctuation">-</span>pvc   Bound    pvc<span class="token punctuation">-</span>24df2e95<span class="token punctuation">-</span>4eb9<span class="token punctuation">-</span>4872<span class="token punctuation">-</span>9aab<span class="token punctuation">-</span>e78a098054cd   1Mi        RWX            managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage   4s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç¬¬â¼†ç§â½…æ³•ï¼š</strong></li></ul><p><code>æˆ‘ä»¬å¯ä»¥è®¾ç½®è¿™ä¸ª course-nfs-storage çš„ StorageClass ä¸º Kubernetes çš„é»˜è®¤å­˜å‚¨åç«¯ï¼Œæˆ‘ä»¬å¯ä»¥â½¤ kubectl patch å‘½ä»¤æ¥æ›´æ–°ï¼š</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl patch storageclass managed-nfs-storage -p &#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get sc </span>
NAME                            PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
managed-nfs-storage <span class="token punctuation">(</span>default<span class="token punctuation">)</span>   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="token boolean">false</span>                  58m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS          REASON   AGE
my-pvc                                     5Gi        RWO            Recycle          Bound    default/my-pvc                                    112m
pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            Delete           Bound    default/test-pvc   managed-nfs-storage            30m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æµ‹è¯•åŠ¨æ€ä¾›åº”</p></blockquote><ul><li><p><strong>è¿˜æ˜¯ç»§ç»­ç”¨nginxæµ‹è¯•pvcåŠ¨æ€ä¾›åº”</strong></p></li><li><p><strong>æœ«å°¾æŒ‡å®šclaimNameçš„pvcæ˜¯test-pvc</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html 
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span> 
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
        
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml  </span>
pod/my<span class="token punctuation">-</span>pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
my<span class="token punctuation">-</span>pod                                    1/1     Running   0          52s   10.244.167.142   node   &lt;none<span class="token punctuation">&gt;</span>           &lt;none<span class="token punctuation">&gt;</span>
nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>75549d8b58<span class="token punctuation">-</span>vldpm   1/1     Running   0          63m   10.244.167.141   node   &lt;none<span class="token punctuation">&gt;</span>           &lt;none<span class="token punctuation">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>åœ¨nfsçš„æœåŠ¡ç«¯éªŒè¯åŠ¨æ€ä¾›åº”æ˜¯å¦ç”Ÿæ•ˆ</strong></p></li><li><p><strong>åˆ›å»ºä¸€ä¸ªindex.htmlæµ‹è¯•</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># cd /nfs/kubernetes/</span>
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># ls </span>
default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># cd default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd/</span>
<span class="token punctuation">[</span>root@node default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd<span class="token punctuation">]</span><span class="token comment"># echo 6666 &gt; index.html </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å›åˆ°masterèŠ‚ç‚¹å†æ¬¡curlæŸ¥çœ‹podæ˜¯å¦æˆåŠŸè®¿é—®index.html</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96s   <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          64m   <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.142</span>
<span class="token number">6666</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²-statefulsetæ§åˆ¶å™¨" tabindex="-1"><a class="header-anchor" href="#æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²-statefulsetæ§åˆ¶å™¨" aria-hidden="true">#</a> æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²ï¼šStatefulSetæ§åˆ¶å™¨</h2><ul><li><strong>æ— çŠ¶æ€ä¸æœ‰çŠ¶æ€ï¼š</strong><ul><li><code>Deploymentæ§åˆ¶å™¨è®¾è®¡åŸåˆ™ï¼šç®¡ç†çš„æ‰€æœ‰Podä¸€æ¨¡ä¸€æ ·ï¼Œæä¾›åŒä¸€ä¸ªæœåŠ¡ï¼Œä¹Ÿä¸è€ƒè™‘åœ¨å“ªå°Nodeè¿ è¡Œï¼Œå¯éšæ„æ‰©å®¹å’Œç¼©å®¹ã€‚è¿™ç§åº”ç”¨ç§°ä¸ºâ€œæ— çŠ¶æ€â€ï¼Œä¾‹å¦‚WebæœåŠ¡</code></li><li><code>åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œè¿™å¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰åº”ç”¨ï¼Œå°¤å…¶æ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œè¿™äº›å®ä¾‹ä¹‹é—´å¾€å¾€æœ‰ ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ä¸»ä»å…³ç³»ã€ä¸»å¤‡å…³ç³»ï¼Œè¿™ç§åº”ç”¨ç§°ä¸ºâ€œæœ‰çŠ¶æ€â€ï¼Œä¾‹å¦‚MySQLä¸»ä»ã€Etcdé›†ç¾¤</code></li></ul></li></ul><h2 id="statefulset" tabindex="-1"><a class="header-anchor" href="#statefulset" aria-hidden="true">#</a> StatefulSetï¼š</h2><blockquote><ul><li><code>StatefulSet</code> æ˜¯ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„å·¥ä½œè´Ÿè½½ API å¯¹è±¡ã€‚</li><li><code>StatefulSet</code> ç”¨æ¥ç®¡ç† Deployment å’Œæ‰©å±•ä¸€ç»„ Podï¼Œå¹¶ä¸”èƒ½ä¸ºè¿™äº› Pod æä¾›<strong>åºå·å’Œå”¯ä¸€æ€§ä¿è¯</strong>ã€‚</li><li>å’Œ Deployment ç›¸åŒçš„æ˜¯ï¼ŒStatefulSet ç®¡ç†äº†åŸºäºç›¸åŒå®¹å™¨å®šä¹‰çš„ä¸€ç»„ Podã€‚ä½†å’Œ Deployment ä¸åŒçš„æ˜¯ï¼ŒStatefulSet ä¸ºå®ƒä»¬çš„æ¯ä¸ª Pod ç»´æŠ¤äº†ä¸€ä¸ªå›ºå®šçš„ IDã€‚è¿™äº› Pod æ˜¯åŸºäºç›¸åŒçš„å£°æ˜æ¥åˆ›å»ºçš„ï¼Œä½†æ˜¯ä¸èƒ½ç›¸äº’æ›¿æ¢ï¼šæ— è®ºæ€ä¹ˆè°ƒåº¦ï¼Œæ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªæ°¸ä¹…ä¸å˜çš„ IDã€‚</li></ul></blockquote><p><strong>éƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨</strong></p><ul><li><p>è§£å†³Podç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œä¿æŒPodå¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§</p><ul><li>ç¨³å®šï¼Œå”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦ï¼ŒæŒä¹…å­˜å‚¨</li><li>æœ‰åºï¼Œä¼˜é›…çš„éƒ¨ç½²å’Œæ‰©å±•ã€åˆ é™¤å’Œç»ˆæ­¢</li><li>æœ‰åºï¼Œè‡ªåŠ¨çš„æ»šåŠ¨æ›´æ–°</li><li>åº”ç”¨åœºæ™¯ï¼šåˆ†å¸ƒå¼åº”ç”¨ã€æ•°æ®åº“é›†ç¾¤</li><li>åˆ é™¤æˆ–è€…æ”¶ç¼© StatefulSet å¹¶ä¸ä¼šåˆ é™¤å®ƒå…³è”çš„å­˜å‚¨å·ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œå®ƒé€šå¸¸æ¯”è‡ªåŠ¨æ¸…é™¤ StatefulSet æ‰€æœ‰ç›¸å…³çš„èµ„æºæ›´æœ‰ä»·å€¼ã€‚</li><li>StatefulSet å½“å‰éœ€è¦ headless æœåŠ¡ æ¥è´Ÿè´£ Pod çš„ç½‘ç»œæ ‡è¯†ã€‚æ‚¨éœ€è¦è´Ÿè´£åˆ›å»ºæ­¤æœåŠ¡ã€‚</li></ul></li><li><p><strong>StatefulSetå°†åº”ç”¨çŠ¶æ€æŠ½è±¡æˆäº†ä¸¤ç§æƒ…å†µï¼š</strong></p><ul><li><code>æ‹“æ‰‘çŠ¶æ€</code>ï¼šåº”ç”¨å®ä¾‹å¿…é¡»æŒ‰ç…§æŸç§é¡ºåºå¯åŠ¨ã€‚æ–°åˆ›å»ºçš„Podå¿…é¡»å’ŒåŸæ¥Podçš„ç½‘ç»œæ ‡è¯†ä¸€æ ·</li><li><code>å­˜å‚¨çŠ¶æ€</code>ï¼šåº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒå­˜å‚¨æ•°æ®ã€‚</li></ul></li></ul><blockquote><p><strong>StatefulSetçš„ä½¿ç”¨</strong></p></blockquote><ul><li><p><code>StatefulSeté€šè¿‡Headless Serviceç»´æŒPodçš„æ‹“æ‰‘çŠ¶æ€</code></p></li><li><p>é¦–å…ˆåˆ›å»ºæ— å¤´æœåŠ¡Headless service</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat service.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f service.yaml </span>
service/nginx created  
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER<span class="token punctuation">-</span>IP   EXTERNAL<span class="token punctuation">-</span>IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none<span class="token punctuation">&gt;</span>        443/TCP   11h
nginx        ClusterIP   None         &lt;none<span class="token punctuation">&gt;</span>        80/TCP    73s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åˆ›å»ºä½¿ç”¨StatefulSetæ§åˆ¶å™¨çš„pod</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web --image=nginx --port=80 --dry-run -o yaml &gt; statefulset.yaml </span>
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat statefulset.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet    <span class="token comment">#ä¿®æ”¹ä¸ªç±»å‹</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
          
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f statefulset.yaml </span>
statefulset.apps/web created

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS    RESTARTS   AGE
nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>75549d8b58<span class="token punctuation">-</span>vldpm   1/1     Running   0          109m
web<span class="token punctuation">-</span>0                                     1/1     Running   0          72s			<span class="token comment">#æœ‰åº</span>
web<span class="token punctuation">-</span>1                                     1/1     Running   0          55s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å¯ä»¥çœ‹å‡ºåˆ›å»ºäº†ä¸¤ä¸ªåä¸º<code>web-0</code>å’Œ<code>web-1</code>çš„podï¼Œserviceä¹Ÿä¼šç”±ä¸¤ä¸ªendpointï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl describe service nginx </span>
Name:              nginx
Namespace:         default
Labels:            <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Annotations:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Selector:          <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Type:              ClusterIP
IP Families:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
IP:                None
IPs:               None
Port:              web  <span class="token number">80</span>/TCP
TargetPort:        <span class="token number">80</span>/TCP
Endpoints:         <span class="token number">10.244</span>.167.145:80,10.244.167.146:80
Session Affinity:  None
Events:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>åˆ›å»ºæ—¶æ˜¯å…ˆåˆ›å»ºweb-0å†åˆ›å»ºweb-1ï¼Œè€Œåˆ é™¤çš„æ—¶å€™æ˜¯å…ˆåˆ é™¤web-1ï¼Œå†åˆ é™¤web-0.</strong></p></li><li><p><strong>ç°åœ¨å¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          49m     <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          112m    <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4m15s   <span class="token number">10.244</span>.167.145   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m58s   <span class="token number">10.244</span>.167.146   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.145</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{</span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{</span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>PVå’ŒPVCçš„è®¾è®¡ï¼Œä½¿å¾—StatefulSetå¯¹å­˜å‚¨çŠ¶æ€çš„ç®¡ç†æˆä¸ºäº†å¯èƒ½ï¼Œç°åœ¨ä¸ºä»¥ä¸Šè¿™äº›podæ·»åŠ å­˜å‚¨</code></strong></p></li><li><p><strong>StatefulSetçš„å­˜å‚¨å·ä½¿ç”¨VolumeClaimTemplateåˆ›å»ºï¼Œç§°ä¸ºå·ç”³è¯·æ¨¡æ¿ï¼Œå½“StatefulSetä½¿ç”¨ VolumeClaimTemplateåˆ›å»ºä¸€ä¸ªPersistentVolumeæ—¶ï¼ŒåŒæ ·ä¹Ÿä¼šä¸ºæ¯ä¸ªPodåˆ†é…å¹¶åˆ›å»ºä¸€ä¸ªç¼–å·çš„PVCã€‚</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat statefulset.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
            <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html

  <span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span> 										<span class="token comment">#ä¸“é—¨çš„ç”³è¯·æ¨¡æ¿ åªå¯¹äºStatefulset</span>
    <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 												<span class="token comment">#ä¸ºPodç”³è¯·ä¸€ä¸ªç‹¬ç«‹çš„PV</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">spec</span><span class="token punctuation">:</span> 
        <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage
        <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> ReadWriteOnce 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> 
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">storage</span><span class="token punctuation">:</span> 100Mi 
            
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl  apply -f statefulset.yaml </span>
statefulset.apps/web created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>æŸ¥çœ‹podsçš„çŠ¶æ€å’Œpvä»¥åŠpvcçš„çŠ¶æ€</code></strong></p></li><li><p><strong><code>StatefulSetè¿˜ä¼šä¸ºæ¯ä¸€ä¸ªPodåˆ†é…å¹¶åˆ›å»ºä¸€ä¸ªåŒæ ·ç¼–å·çš„PVCã€‚</code></strong></p></li><li><p><strong>è¿™æ ·ï¼Œkuberneteså°±å¯ä»¥é€šè¿‡Persistent Volumeæœºåˆ¶ä¸ºè¿™ä¸ªPVCç»‘å®šå¯¹åº”çš„PVï¼Œä»è€Œä¿è¯æ¯ä¸€ä¸ªPodéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„Volumeï¼š</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS    RESTARTS   AGE
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62m
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          125m
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          42s
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23s

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
my-pvc      Bound    my-pvc                                     5Gi        RWO                                  3h3m
test-pvc    Bound    pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            managed-nfs-storage   101m
www-web-0   Bound    pvc-66727b03-b4f4-47b1-a681-9a9c406ee732   100Mi      RWO            managed-nfs-storage   55s
www-web-1   Bound    pvc-d9df0901-79be-47d2-b8a1-4552213e09d3   100Mi      RWO            managed-nfs-storage   36s

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment">#  kubectl get pv </span>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS          REASON   AGE
my-pvc                                     5Gi        RWO            Recycle          Bound    default/my-pvc                                     3h5m
pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            Delete           Bound    default/test-pvc    managed-nfs-storage            103m
pvc-66727b03-b4f4-47b1-a681-9a9c406ee732   100Mi      RWO            Delete           Bound    default/www-web-0   managed-nfs-storage            2m46s
pvc-d9df0901-79be-47d2-b8a1-4552213e09d3   100Mi      RWO            Delete           Bound    default/www-web-1   managed-nfs-storage            2m27s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>åœ¨nfsçš„æœåŠ¡ç«¯å†™å…¥index.htmlè¿›è¡Œè®¿é—®æµ‹è¯•</strong></p></li><li><p><strong>æˆ‘å·²ç»å°†nfsçš„æœåŠ¡ç«¯æŒ‚è½½åœ¨masterèŠ‚ç‚¹ä¸Š</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd /mnt/default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732/ </span>
<span class="token punctuation">[</span>root@master default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732<span class="token punctuation">]</span><span class="token comment"># echo web1 &gt; index.html </span>
<span class="token punctuation">[</span>root@master default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@master default-www-web-1-pvc-d9df0901-79be-47d2-b8a1-4552213e09d3<span class="token punctuation">]</span><span class="token comment"># echo web2 &gt; index.html </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl  get pods -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          68m     <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m    <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m31s   <span class="token number">10.244</span>.167.147   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m12s   <span class="token number">10.244</span>.167.148   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl  10.244.167.147</span>
web1
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl  10.244.167.148</span>
web2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶å­˜å‚¨-configmap" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶å­˜å‚¨-configmap" aria-hidden="true">#</a> åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶å­˜å‚¨ï¼šConfigMap</h2><ul><li><p>èµ„æºå¯¹è±¡ï¼š ConfigMap</p><ul><li>æˆ‘ä»¬çŸ¥é“è®¸å¤šåº”â½¤ç»å¸¸ä¼šæœ‰ä»é…ç½®â½‚ä»¶ã€å‘½ä»¤â¾å‚æ•°æˆ–è€…ç¯å¢ƒå˜é‡ä¸­è¯»å– â¼€äº›é…ç½®ä¿¡æ¯ï¼Œè¿™äº›é…ç½®ä¿¡æ¯æˆ‘ä»¬è‚¯å®šä¸ä¼šç›´æ¥å†™æ­»åˆ°åº”â½¤ç¨‹åºä¸­å»çš„ï¼Œâ½å¦‚ä½ â¼€ä¸ªåº”â½¤è¿æ¥â¼€ ä¸ª redis æœåŠ¡ï¼Œä¸‹â¼€æ¬¡æƒ³æ›´æ¢â¼€ä¸ªäº†çš„ï¼Œè¿˜å¾—é‡æ–°å»ä¿®æ”¹ä»£ç ï¼Œé‡æ–°åˆ¶ä½œâ¼€ä¸ªé•œåƒï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯å– çš„ï¼Œ<code>â½½ ConfigMap å°±ç»™æˆ‘ä»¬æä¾›äº†å‘å®¹å™¨ä¸­æ³¨â¼Šé…ç½®ä¿¡æ¯çš„èƒ½â¼’ï¼Œä¸ä»…å¯ä»¥â½¤æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ ä»¥â½¤æ¥ä¿å­˜æ•´ä¸ªé…ç½®â½‚ä»¶ï¼Œâ½å¦‚æˆ‘ä»¬å¯ä»¥â½¤æ¥é…ç½®â¼€ä¸ª redis æœåŠ¡çš„è®¿é—®åœ°å€ï¼Œä¹Ÿå¯ä»¥â½¤æ¥ä¿å­˜æ•´ ä¸ª redis çš„é…ç½®â½‚ä»¶ã€‚</code></li><li>ConfigMap èµ„æºå¯¹è±¡ä½¿â½¤ key-value å½¢å¼çš„é”®å€¼å¯¹æ¥é…ç½®æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨ Pod â¾¥â¾¯ä½¿ â½¤ï¼Œ ConfigMap å’Œæˆ‘ä»¬åâ¾¯è¦è®²åˆ°çš„ Secrets â½è¾ƒç±»ä¼¼ï¼Œâ¼€ä¸ªâ½è¾ƒâ¼¤çš„åŒºåˆ«æ˜¯ ConfigMap å¯ä»¥â½è¾ƒâ½… ä¾¿çš„å¤„ç†â¼€äº›â¾®æ•æ„Ÿçš„æ•°æ®ï¼Œ<code>â½å¦‚å¯†ç ä¹‹ç±»çš„è¿˜æ˜¯éœ€è¦ä½¿â½¤ Secrets æ¥è¿›â¾ç®¡ç†ã€‚</code></li></ul></li><li><p>å¯ä»¥ä½¿â½¤ kubectl create configmap -h æ¥æŸ¥çœ‹å…³äºåˆ›å»º ConfigMap çš„å¸®åŠ©ä¿¡æ¯</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Examples:
	<span class="token comment"># Create a new configmap named my-config based on folder bar</span>
	kubectl create configmap my-config --from-file<span class="token operator">=</span>path/to/bar

	<span class="token comment"># Create a new configmap named my-config with specified keys instead of file basenames on disk</span>
	kubectl create configmap my-config --from-file<span class="token operator">=</span>key1<span class="token operator">=</span>/path/to/bar/file1.txt --from-file<span class="token operator">=</span>key2<span class="token operator">=</span>/path/to/bar/file2.txt

	<span class="token comment"># Create a new configmap named my-config with key1=config1 and key2=config2ConfigMap</span>
	kubectl create configmap my-config --from-literal<span class="token operator">=</span>key1<span class="token operator">=</span>config1 --from-literal<span class="token operator">=</span>key2<span class="token operator">=</span>config2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>åˆ›å»ºå«æœ‰å˜é‡çš„æ–‡ä»¶</code></strong></p></li><li><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯ä»¥ä»â¼€ä¸ªç»™å®šçš„â½¬å½•æ¥åˆ›å»ºâ¼€ä¸ª ConfigMap å¯¹è±¡ï¼Œâ½å¦‚æˆ‘ä»¬æœ‰â¼€ä¸ª testcm çš„â½¬å½•ï¼Œ è¯¥â½¬å½•ä¸‹â¾¯åŒ…å«â¼€äº›é…ç½®â½‚ä»¶ï¼Œ redis å’Œ mysql çš„è¿æ¥ä¿¡æ¯</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># ls testcm/</span>
mysql.conf  redis.conf

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat testcm/mysql.conf </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat testcm/redis.conf </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>ä½¿â½¤ from-file å…³é”®å­—æ¥åˆ›å»ºåŒ…å«è¿™ä¸ªâ½¬å½•ä¸‹â¾¯æ‰€ä»¥é…ç½®â½‚ä»¶çš„ ConfigMap</code></strong></p></li><li><p>å…¶ä¸­ from-file å‚æ•°æŒ‡å®šåœ¨è¯¥â½¬å½•ä¸‹â¾¯çš„æ‰€æœ‰â½‚ä»¶éƒ½ä¼šè¢«â½¤åœ¨ ConfigMap â¾¥â¾¯åˆ›å»ºâ¼€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„ åå­—å°±æ˜¯â½‚ä»¶åï¼Œå€¼å°±æ˜¯â½‚ä»¶çš„å†…å®¹</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo1 --from-file=testcm</span>
configmap/cm-demo1 created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps </span>
NAME               DATA   AGE
cm-demo1           <span class="token number">2</span>      6s
kube-root-ca.crt   <span class="token number">1</span>      27s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿â½¤ describe å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl describe configmaps cm-demo1 </span>
Name:         cm-demo1
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Data
<span class="token operator">==</span><span class="token operator">==</span>
mysql.conf:
----
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

redis.conf:
----
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>

Events:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿ç”¨yamlçš„æ–¹å¼æŸ¥çœ‹æ›´è¯¦ç»†çš„é”®å€¼</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo1 -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=3306</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=6379</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:52:14Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:mysql.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:52:14Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo1
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10516&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 9a07b954<span class="token punctuation">-</span>c61a<span class="token punctuation">-</span>4b4d<span class="token punctuation">-</span>a0ec<span class="token punctuation">-</span>5214c3c317ee
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>é™¤äº†é€šè¿‡â½‚ä»¶â½¬å½•è¿›â¾åˆ›å»ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿â½¤æŒ‡å®šçš„â½‚ä»¶è¿›â¾åˆ›å»º ConfigMap</p></li><li><p>æˆ‘ä»¬åˆ›å»ºâ¼€ä¸ª redis çš„é…ç½®çš„â¼€ä¸ªå•ç‹¬ ConfigMap å¯¹è±¡:</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo2 --from-file=testcm/redis.conf </span>
configmap/cm<span class="token punctuation">-</span>demo2 created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo2  -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=6379</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:55:37Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:55:37Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10782&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 71c2a77a<span class="token punctuation">-</span>fb21<span class="token punctuation">-</span>44c3<span class="token punctuation">-</span>a293<span class="token punctuation">-</span>064e3d1a2826
  

æ³¨ï¼š
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°â¼€ä¸ªå…³è” redis.conf â½‚ä»¶é…ç½®ä¿¡æ¯çš„ ConfigMap å¯¹è±¡åˆ›å»ºæˆåŠŸäº†ï¼Œå¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ <span class="token punctuation">-</span><span class="token punctuation">-</span>from<span class="token punctuation">-</span>file è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿â½¤å¤šæ¬¡ï¼Œâ½å¦‚æˆ‘ä»¬è¿™â¾¥ä½¿â½¤ä¸¤æ¬¡åˆ†åˆ«æŒ‡å®š redis.conf å’Œ mysql.conf â½‚ä»¶ï¼Œå°±å’Œç›´æ¥æŒ‡å®šæ•´ä¸ªâ½¬å½•æ˜¯â¼€æ ·çš„æ•ˆæœäº†ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä½¿â½¤å­—ç¬¦ä¸²è¿›â¾åˆ›å»ºï¼Œé€šè¿‡ --from-literal å‚æ•°ä¼ é€’é…ç½®ä¿¡æ¯</p></li><li><p>åŒæ ·çš„ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä½¿â½¤å¤šæ¬¡</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo3 --from-literal=db.host=localhost  --from-literal=db.port=3306</span>
configmap/cm<span class="token punctuation">-</span>demo3 created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo3 -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">db.host</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">db.port</span><span class="token punctuation">:</span> <span class="token string">&quot;3306&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:58:06Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:db.host</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:db.port</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:58:06Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10979&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 36bf5bbb<span class="token punctuation">-</span>b43a<span class="token punctuation">-</span>402d<span class="token punctuation">-</span>92c2<span class="token punctuation">-</span>af5f48ae0172
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="configmapçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#configmapçš„ä½¿ç”¨" aria-hidden="true">#</a> configMapçš„ä½¿ç”¨</h2></blockquote><ul><li><p>ConfigMap è¿™äº›é…ç½®æ•°æ®å¯ä»¥ é€šè¿‡å¾ˆå¤šç§â½…å¼åœ¨ Pod â¾¥ä½¿â½¤ï¼Œä¸»è¦æœ‰ä»¥ä¸‹â¼ç§â½…å¼ï¼š</p><ul><li><code>è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼</code></li><li><code>åœ¨å®¹å™¨â¾¥è®¾ç½®å‘½ä»¤â¾å‚æ•°</code></li><li><code>åœ¨æ•°æ®å·â¾¥â¾¯åˆ›å»ºconfigâ½‚ä»¶</code></li></ul></li><li><p>ä½¿â½¤ ConfigMap æ¥å¡«å……æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡ï¼š</p></li><li><p>ä½¿ç”¨busyboxé•œåƒæ‰“å°æˆ‘ä»¬æ‰€æ³¨å…¥çš„å˜é‡</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm1 
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span> 
    <span class="token key atrule">env</span><span class="token punctuation">:</span> 								<span class="token comment">#ç¬¬ä¸€ç§æ³¨å…¥å˜é‡çš„æ–¹å¼</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST					
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 						<span class="token comment">#å˜é‡çš„æ¥æº</span>
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 				<span class="token comment">#ä»configMapæ¥</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3  			<span class="token comment">#ä»configMapçš„cm-demo3æ¥</span>
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.host 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT 
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3 
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.port
    <span class="token key atrule">envFrom</span><span class="token punctuation">:</span> 							<span class="token comment">#ç¬¬äºŒç§æ³¨å…¥å˜é‡çš„æ–¹å¼</span>
      <span class="token punctuation">-</span> <span class="token key atrule">configMapRef</span><span class="token punctuation">:</span>					<span class="token comment">#æ¥æºäºconfigMap</span>
         <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo1 				<span class="token comment">#configMapçš„cm-demo1</span>
        
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm1<span class="token punctuation">-</span>pod created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
testcm1<span class="token punctuation">-</span>pod   0/1     Completed   0          3m21s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹æ—¥å¿—çœ‹busyboxæ˜¯å¦æ‰“å°å‡ºæ¥å˜é‡</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl logs testcm1-pod </span>
<span class="token assign-left variable">KUBERNETES_SERVICE_PORT</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT</span><span class="token operator">=</span>tcp://10.96.0.1:443
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>testcm1-pod
<span class="token assign-left variable">DB_PORT</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable"><span class="token environment constant">SHLVL</span></span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root
<span class="token assign-left variable">mysql.conf</span><span class="token operator">=</span>host<span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

<span class="token assign-left variable">redis.conf</span><span class="token operator">=</span>host<span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>

<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_ADDR</span><span class="token operator">=</span><span class="token number">10.96</span>.0.1
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_PORT</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_PROTO</span><span class="token operator">=</span>tcp
<span class="token assign-left variable">KUBERNETES_SERVICE_PORT_HTTPS</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP</span><span class="token operator">=</span>tcp://10.96.0.1:443
<span class="token assign-left variable">KUBERNETES_SERVICE_HOST</span><span class="token operator">=</span><span class="token number">10.96</span>.0.1
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/
<span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>localhost

æ³¨ï¼š
å¯ä»¥çœ‹åˆ° DB_HOST å’Œ DB_PORT éƒ½å·²ç»æ­£å¸¸è¾“å‡ºäº†ï¼Œå¦å¤–çš„ç¯å¢ƒå˜é‡æ˜¯å› ä¸ºæˆ‘ä»¬è¿™â¾¥ç›´æ¥æŠŠ cm-demo1 ç»™æ³¨â¼Šè¿›æ¥äº†ï¼Œæ‰€ä»¥æŠŠä»–ä»¬çš„æ•´ä¸ªé”®å€¼ç»™è¾“å‡ºå‡ºæ¥äº†ï¼Œè¿™ä¹Ÿæ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿â½¤ ConfigMap æ¥è®¾ç½®å‘½ä»¤â¾å‚æ•°ï¼Œ ConfigMap ä¹Ÿå¯ä»¥è¢«â½¤æ¥è®¾ç½®å®¹å™¨ä¸­çš„å‘½ä»¤æˆ–è€…å‚æ•°å€¼</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm2<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm2
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo $(DB_HOST) $(DB_PORT)&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3  
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.host 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT 
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3 
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.port
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm2<span class="token punctuation">-</span>pod created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl logs testcm2-pod </span>
localhost <span class="token number">3306</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦å¤–â¼€ç§æ˜¯â¾®å¸¸å¸¸â»…çš„ä½¿â½¤ ConfigMap çš„â½…å¼ï¼š <ul><li>é€šè¿‡æ•°æ®å·ä½¿â½¤ï¼Œåœ¨æ•°æ®å·â¾¥â¾¯ä½¿â½¤ ConfigMap</li><li>å°±æ˜¯å°†â½‚ä»¶å¡«â¼Šæ•°æ®å·ï¼Œåœ¨è¿™ä¸ªâ½‚ä»¶ä¸­ï¼Œé”®å°±æ˜¯â½‚ä»¶åï¼Œé”®å€¼å°±æ˜¯â½‚ä»¶å†…å®¹ï¼š</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm3<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm3
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cat /etc/config/redis.conf&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume 
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config 

  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume 
      <span class="token key atrule">configMap</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo2
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm3<span class="token punctuation">-</span>pod created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
testcm3<span class="token punctuation">-</span>pod   0/1     Completed   0          5s

æ³¨ï¼š
å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ ConfigMap ä»¥æ•°æ®å·çš„å½¢å¼æŒ‚è½½è¿› Pod çš„æ—¶ï¼Œè¿™æ—¶æ›´æ–° ConfigMap ï¼ˆæˆ–åˆ æ‰é‡å»º ConfigMap ï¼‰ï¼Œ Pod å†…æŒ‚è½½çš„é…ç½®ä¿¡æ¯ä¼šçƒ­æ›´æ–°ã€‚è¿™æ—¶å¯ä»¥å¢åŠ â¼€äº›ç›‘æµ‹é…ç½®â½‚ä»¶å˜æ›´çš„è„šæœ¬ï¼Œç„¶
å reload å¯¹åº”æœåŠ¡ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl  logs testcm3-pod </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ•æ„Ÿæ•°æ®å­˜å‚¨-secret" tabindex="-1"><a class="header-anchor" href="#æ•æ„Ÿæ•°æ®å­˜å‚¨-secret" aria-hidden="true">#</a> æ•æ„Ÿæ•°æ®å­˜å‚¨ï¼šSecret</h2><ul><li><p>èµ„æºå¯¹è±¡ï¼š Secret</p><ul><li>å¦‚æœæ¶‰åŠåˆ°â¼€äº›å®‰å…¨ç›¸å…³çš„ æ•°æ®çš„è¯â½¤ ConfigMap å°±â¾®å¸¸ä¸å¦¥äº†ï¼Œå› ä¸º ConfigMap æ˜¯åä¸ºå­˜å‚¨çš„ï¼Œæˆ‘ä»¬è¯´è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦â½¤ åˆ°å¦å¤–â¼€ä¸ªèµ„æºå¯¹è±¡äº†ï¼š <code>Secret ï¼Œ Secret â½¤æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh keyç­‰ ç­‰ï¼Œå°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ Secret ä¸­â½æ”¾åœ¨ Pod çš„å®šä¹‰ä¸­æˆ–è€… docker é•œåƒä¸­æ¥è¯´æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚</code></li></ul></li><li><p><strong>Secret æœ‰ä¸‰ç§ç±»å‹ï¼š</strong></p></li><li><p>kubectl create secret æ”¯æŒä¸‰ç§æ•°æ®ç±»å‹ï¼š</p><ul><li>genericï¼šä»æ–‡ä»¶ã€ç›®å½•æˆ–è€…å­—ç¬¦ä¸²åˆ›å»ºï¼Œä¾‹å¦‚å­˜å‚¨ç”¨æˆ·åå¯†ç *</li><li>docker-registryï¼šå­˜å‚¨é•œåƒä»“åº“è®¤è¯ä¿¡æ¯*</li><li>tlsï¼šå­˜å‚¨è¯ä¹¦ï¼Œä¾‹å¦‚HTTPSè¯ä¹¦ <ul><li><code>Opaque</code>ï¼š base64 ç¼–ç æ ¼å¼çš„ Secretï¼Œâ½¤æ¥å­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰ï¼›ä½†æ•°æ®ä¹Ÿå¯ä»¥é€šè¿‡base64 â€“ decodeè§£ç å¾—åˆ°åŸå§‹æ•°æ®ï¼Œæ‰€æœ‰åŠ å¯†æ€§å¾ˆå¼±ã€‚</li><li><code>kubernetes.io/dockerconfigjson</code>ï¼š â½¤æ¥å­˜å‚¨ç§æœ‰docker registryçš„è®¤è¯ä¿¡æ¯ã€‚</li><li><code>kubernetes.io/service-account-token</code>ï¼š â½¤äºè¢« serviceaccount å¼•â½¤ï¼Œserviceaccout åˆ›å»ºæ—¶ Kubernetesä¼šé»˜è®¤åˆ›å»ºå¯¹åº”çš„secretã€‚Podå¦‚æœä½¿â½¤äº†serviceaccountï¼Œå¯¹åº”çš„secretä¼šâ¾ƒåŠ¨æŒ‚è½½åˆ°Podâ½¬å½• /run/secrets/kubernetes.io/serviceaccount ä¸­ã€‚</li></ul></li></ul></li></ul><blockquote><p><strong>Opaque Secret</strong> Opaque ç±»å‹çš„æ•°æ®æ˜¯â¼€ä¸ª map ç±»å‹ï¼Œè¦æ±‚valueæ˜¯ base64 ç¼–ç æ ¼å¼ï¼Œâ½å¦‚æˆ‘ä»¬æ¥åˆ›å»ºâ¼€ä¸ªâ½¤æˆ·åä¸º adminï¼Œå¯†ç ä¸º admin321 çš„ Secret å¯¹è±¡ï¼Œâ¾¸å…ˆæˆ‘ä»¬å…ˆæŠŠè¿™â½¤æˆ·åå’Œå¯†ç åš base64 ç¼–ç </p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo  -n &quot;admin&quot; | base64</span>
<span class="token assign-left variable">YWRtaW4</span><span class="token operator">=</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo  -n &quot;admin123&quot; | base64</span>
<span class="token assign-left variable">YWRtaW4xMjM</span><span class="token operator">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Secretçš„genericä½¿ç”¨</strong></p></blockquote><ul><li>ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²yamlåˆ›å»ºä¸€ä¸ªsecret</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create secret generic mysecret --type Opaque --from-literal=username=YWRtaW4=  --from-literal=password=YWRtaW4xMjM= --dry-run -o yaml &gt; secret.yaml </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> YWRtaW4xMjM=
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4=
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åˆ©â½¤ get secret å‘½ä»¤æŸ¥çœ‹ï¼š</li><li>å…¶ä¸­ default-token-cty7pdefault-token-n9w2d ä¸ºåˆ›å»ºé›†ç¾¤æ—¶é»˜è®¤åˆ›å»ºçš„ secretï¼Œè¢« serviceacount/default å¼•â½¤ã€‚</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret.yaml </span>
secret/mysecret created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets </span>
NAME                  TYPE                                  DATA   AGE
default-token-rmwg8   kubernetes.io/service-account-token   <span class="token number">3</span>      170m
mysecret              Opaque                                <span class="token number">2</span>      11s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿â½¤ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹è¯¦æƒ…ï¼š</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl describe secrets mysecret  </span>
Name:         mysecret
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Type:  Opaque

Data
<span class="token operator">==</span><span class="token operator">==</span>
password:  <span class="token number">12</span> bytes
username:  <span class="token number">8</span> bytes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>åˆ›å»ºå¥½ Secret å¯¹è±¡åï¼Œæœ‰ä¸¤ç§â½…å¼æ¥ä½¿â½¤å®ƒï¼š</p><ul><li><strong><code>ä»¥ç¯å¢ƒå˜é‡çš„å½¢å¼</code></strong></li><li><strong><code>ä»¥Volumeçš„å½¢å¼æŒ‚è½½</code></strong></li></ul></li><li><p><strong><code>ç¯å¢ƒå˜é‡</code></strong></p></li><li><p>â¾¸å…ˆæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ç¯å¢ƒå˜é‡çš„â½…å¼ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬æ¥ä½¿â½¤â¼€ä¸ªç®€å•çš„ busybox é•œåƒæ¥æµ‹è¯•ä¸‹:(secret1- pod.yaml)</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret1.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span> 					<span class="token comment">#æ³¨å…¥å˜é‡</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USERNAME 		
      <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 			<span class="token comment">#å˜é‡çš„æ¥æº</span>
        <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span> 		<span class="token comment">#æ¥æºäºsecretçš„mysecret</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret 	<span class="token comment">#åç§°æ˜¯mysecret</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> username		<span class="token comment">#å˜é‡æ˜¯username=admin  è¾“å‡ºadmin</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PASSWORD  
      <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
        <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span> 
          <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret 
          <span class="token key atrule">key</span><span class="token punctuation">:</span> password 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret1.yaml  </span>
pod/secret1-pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
secret1-pod   <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          18s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹æ—¥å¿—çŠ¶æ€</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl logs secret1-pod </span>
<span class="token assign-left variable">USERNAME</span><span class="token operator">=</span>admin
Â·Â·Â·
<span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span>admin123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>Volume æŒ‚è½½</code></strong></p></li><li><p>åŒæ ·çš„æˆ‘ä»¬â½¤â¼€ä¸ª Pod æ¥éªŒè¯ä¸‹ Volume æŒ‚è½½ï¼Œåˆ›å»ºâ¼€ä¸ª Pod â½‚ä»¶ï¼š(secret2-pod.yaml)</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret2.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ls /etc/secrets&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> secrets
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/secrets
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> secrets 
      <span class="token key atrule">secret</span><span class="token punctuation">:</span> 
        <span class="token key atrule">secretName</span><span class="token punctuation">:</span> mysecret
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret2.yaml  </span>
pod/secret1<span class="token punctuation">-</span>pod created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹æ—¥å¿—</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@master ~]# kubectl logs secret1-pod 
password
username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="secretçš„docker-registryä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#secretçš„docker-registryä½¿ç”¨" aria-hidden="true">#</a> Secretçš„docker-registryä½¿ç”¨</h2></blockquote><ul><li><p><code>kubernetes.io/dockerconfigjson</code></p></li><li><p>é™¤äº†ä¸Šâ¾¯çš„ Opaque è¿™ç§ç±»å‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¥åˆ›å»ºâ½¤æˆ· docker registry è®¤è¯çš„ Secret ï¼Œç›´æ¥ä½¿ â½¤ kubectl create å‘½ä»¤åˆ›å»ºå³å¯</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create secret docker-registry myregistry  --docker-server=DOCKER_SERVER --docker-username=DOCKER_USER --docker-password=DOCKER_PASSWORD --docker-email=DOCKER_EMAIL</span>
secret/myregistry created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secret </span>
NAME                  TYPE                                  DATA   AGE
default-token-4wt8g   kubernetes.io/service-account-token   <span class="token number">3</span>      12h
myregistry            kubernetes.io/dockerconfigjson        <span class="token number">1</span>      7s


æ³¨ï¼š
æ³¨æ„çœ‹ä¸Šâ¾¯çš„ TYPE ç±»å‹ï¼Œ myregistry æ˜¯ä¸æ˜¯å¯¹åº”çš„ kubernetes.io/dockerconfigjson 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹yamlçš„è¯¦ç»†</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets myregistry -o yaml </span>
apiVersion: v1
data:
  .dockerconfigjson: <span class="token assign-left variable">eyJhdXRocyI6eyJET0NLRVJfU0VSVkVSIjp7InVzZXJuYW1lIjoiRE9DS0VSX1VTRVIiLCJwYXNzd29yZCI6IkRPQ0tFUl9QQVNTV09SRCIsImVtYWlsIjoiRE9DS0VSX0VNQUlMIiwiYXV0aCI6IlJFOURTMFZTWDFWVFJWSTZSRTlEUzBWU1gxQkJVMU5YVDFKRSJ9fX0</span><span class="token operator">=</span>
kind: Secret
metadata:
  creationTimestamp: <span class="token string">&quot;2021-11-07T10:24:34Z&quot;</span>
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: <span class="token punctuation">{</span><span class="token punctuation">}</span>
        f:.dockerconfigjson: <span class="token punctuation">{</span><span class="token punctuation">}</span>
      f:type: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    manager: kubectl
    operation: Update
    time: <span class="token string">&quot;2021-11-07T10:24:34Z&quot;</span>
  name: myregistry
  namespace: default
  resourceVersion: <span class="token string">&quot;104658&quot;</span>
  selfLink: /api/v1/namespaces/default/secrets/myregistry
  uid: f57dffb2-4c1a-41e7-9d9f-a5316b343771
type: kubernetes.io/dockerconfigjson
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯ä»¥æŠŠä¸Šâ¾¯çš„ data.dockerconfigjson ä¸‹â¾¯çš„æ•°æ®åšâ¼€ä¸ª base64 è§£ç ï¼Œçœ‹çœ‹â¾¥â¾¯çš„æ•°æ®æ˜¯æ€æ ·çš„</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo eyJhdXRocyI6eyJET0NLRVJfU0VSVkVSIjp7InVzZXJuYW1lIjoiRE9DS0VSX1VTRVIiLCJwYXNzd29yZCI6IkRPQ0tFUl9QQVNTV09SRCIsImVtYWlsIjoiRE9DS0VSX0VNQUlMIiwiYXV0aCI6IlJFOURTMFZTWDFWVFJWSTZSRTlEUzBWU1gxQkJVMU5YVDFKRSJ9fX0= | base64 -d</span>
<span class="token punctuation">{</span><span class="token string">&quot;auths&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;DOCKER_SERVER&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_USER&quot;</span>,<span class="token string">&quot;password&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_PASSWORD&quot;</span>,<span class="token string">&quot;email&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_EMAIL&quot;</span>,<span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;RE9DS0VSX1VTRVI6RE9DS0VSX1BBU1NXT1JE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœæˆ‘ä»¬éœ€è¦æ‹‰å–ç§æœ‰ä»“åº“ä¸­çš„ docker é•œåƒçš„è¯å°±éœ€è¦ä½¿â½¤åˆ°ä¸Šâ¾¯çš„ myregistry è¿™ä¸ª Secret</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> 172.25.253.19/library/nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myregistrykey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="secret-ä¸-configmap-å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#secret-ä¸-configmap-å¯¹æ¯”" aria-hidden="true">#</a> Secret ä¸ ConfigMap å¯¹â½</h2><blockquote><p>æœ€åæˆ‘ä»¬æ¥å¯¹â½ä¸‹ Secret å’Œ ConfigMap è¿™ä¸¤ç§èµ„æºå¯¹è±¡çš„å¼‚åŒç‚¹ï¼š</p></blockquote><ul><li><p>ç›¸åŒç‚¹ï¼š</p><ul><li>key/valueçš„å½¢å¼</li><li>å±äºæŸä¸ªç‰¹å®šçš„namespace</li><li>å¯ä»¥å¯¼å‡ºåˆ°ç¯å¢ƒå˜é‡</li><li>å¯ä»¥é€šè¿‡â½¬å½•/â½‚ä»¶å½¢å¼æŒ‚è½½</li><li>é€šè¿‡ volume æŒ‚è½½çš„é…ç½®ä¿¡æ¯å‡å¯çƒ­æ›´æ–°</li></ul></li><li><p>ä¸åŒç‚¹ï¼š</p><ul><li>Secret å¯ä»¥è¢« ServerAccount å…³è”</li><li>Secret å¯ä»¥å­˜å‚¨ docker register çš„é‰´æƒä¿¡æ¯ï¼Œâ½¤åœ¨ ImagePullSecret å‚æ•°ä¸­ï¼Œâ½¤äºæ‹‰å–ç§æœ‰ä»“åº“çš„é•œåƒ</li><li>Secret â½€æŒ Base64 åŠ å¯†</li><li>Secret åˆ†ä¸º <a href="http://kubernetes.io/service-account-token%E3%80%81kubernetes.io/dockerconfigjson%E3%80%81Opaque" target="_blank" rel="noopener noreferrer">kubernetes.io/service-account-tokenã€kubernetes.io/dockerconfigjsonã€Opaque<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸‰ç§ç±»å‹ï¼Œâ½½ Configmap ä¸åŒºåˆ†ç±»å‹</li></ul></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/theme-docs/src/zh/isKcount/2/CKA/09.Kuberneteså­˜å‚¨.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: admin@example.com">Administrator</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2022 isKcount</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.85823306.js" defer></script>
  </body>
</html>
