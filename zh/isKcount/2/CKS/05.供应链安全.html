<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html"><meta property="og:site_name" content="文档演示"><meta property="og:title" content="供应链安全"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-11T05:08:11.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-04-15T16:13:20.000Z"><meta property="article:modified_time" content="2022-10-11T05:08:11.000Z"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>供应链安全 | 文档演示</title><meta name="description" content="vuepress-theme-hope 的文档演示">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7cb9ac72.css">
    <link rel="modulepreload" href="/assets/app.85823306.js"><link rel="modulepreload" href="/assets/05.供应链安全.html.410885bf.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/05.供应链安全.html.f1406dbd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/zh" class="brand"><img class="logo" src="/logo.svg" alt="文档演示"><!----><span class="site-name hide-in-pad">文档演示</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/zh" class="nav-link" aria-label="isKcount"><span class="icon iconfont icon-home"></span>isKcount<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="分类"><span class="title"><span class="icon iconfont icon-interact"></span>分类</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/isKcount/1/" class="nav-link" aria-label="学习路线规划"><span class="icon iconfont icon-ability"></span>学习路线规划<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/2/" class="nav-link active" aria-label="考证"><span class="icon iconfont icon-relation"></span>考证<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/3/" class="nav-link" aria-label="运维笔记"><span class="icon iconfont icon-linux"></span>运维笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/4/" class="nav-link" aria-label="后端开发笔记"><span class="icon iconfont icon-note"></span>后端开发笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/5/" class="nav-link" aria-label="前端开发笔记"><span class="icon iconfont icon-like"></span>前端开发笔记<!----></a></li><li class="dropdown-item"><a href="/zh/isKcount/6/" class="nav-link" aria-label="中间件服务笔记"><span class="icon iconfont icon-api"></span>中间件服务笔记<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Devops"><span class="title"><span class="icon iconfont icon-select"></span>Devops</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/cicd/git/" class="nav-link" aria-label="Git开发手册"><span class="icon iconfont icon-git"></span>Git开发手册<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/ci/" class="nav-link" aria-label="CICD"><span class="icon iconfont icon-ci"></span>CICD<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/istio/" class="nav-link" aria-label="Istio"><span class="icon iconfont icon-material"></span>Istio<!----></a></li><li class="dropdown-item"><a href="/zh/cicd/operator/" class="nav-link" aria-label="Operator"><span class="icon iconfont icon-proxy"></span>Operator<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://wallhaven.cc/" rel="noopener noreferrer" target="_blank" aria-label="Wallhaven" class="nav-link"><span class="icon iconfont icon-autumn"></span>Wallhaven<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zh/isKcount/" class="nav-link sidebar-link sidebar-page" aria-label="指南"><span class="icon iconfont icon-creative"></span>指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">学习路线规划</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-relation"></span><span class="title">考证</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux"></span><span class="title">运维笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">后端开发笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-like"></span><span class="title">前端开发笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-api"></span><span class="title">中间件服务笔记</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->供应链安全</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://iskcount.github.io" target="_blank" rel="noopener noreferrer">isKcount</a></span><span property="author" content="isKcount"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年4月16日</span><meta property="datePublished" content="2022-04-15T16:13:20.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 12 分钟</span><meta property="timeRequired" content="PT12M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#主要内容" class="router-link-active router-link-exact-active toc-link level3">主要内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#可信任软件供应链概述" class="router-link-active router-link-exact-active toc-link level3">可信任软件供应链概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#构建镜像dockerfile文件优化" class="router-link-active router-link-exact-active toc-link level3">构建镜像Dockerfile文件优化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#镜像漏洞扫描工具-trivy" class="router-link-active router-link-exact-active toc-link level3">镜像漏洞扫描工具：Trivy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#检查yaml文件安全配置-kubesec" class="router-link-active router-link-exact-active toc-link level3">检查YAML文件安全配置：kubesec</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#admission-webhook" class="router-link-active router-link-exact-active toc-link level3">Admission Webhook</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/isKcount/2/CKS/05.%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8.html#imagepolicywebhook" class="router-link-active router-link-exact-active toc-link level3">ImagePolicyWebhook</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="供应链安全" tabindex="-1"><a class="header-anchor" href="#供应链安全" aria-hidden="true">#</a> 供应链安全</h1><h3 id="主要内容" tabindex="-1"><a class="header-anchor" href="#主要内容" aria-hidden="true">#</a> 主要内容</h3><p>❖ 可信任软件供应链概述</p><p>❖ 构建镜像Dockerfile文件优化</p><p>❖ 镜像漏洞扫描工具：Trivy</p><p>❖ 检查YAML文件安全配置：kubesec</p><p>❖ 准入控制器： Admission Webhook</p><p>❖ 准入控制器： ImagePolicyWebhook</p><h3 id="可信任软件供应链概述" tabindex="-1"><a class="header-anchor" href="#可信任软件供应链概述" aria-hidden="true">#</a> 可信任软件供应链概述</h3><p>可信任软件供应链：指在建设基础架构过程中，涉及的软件都是可信任的。</p><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204151356279.png" alt="image-20220414122733589" loading="lazy"></p><h3 id="构建镜像dockerfile文件优化" tabindex="-1"><a class="header-anchor" href="#构建镜像dockerfile文件优化" aria-hidden="true">#</a> 构建镜像Dockerfile文件优化</h3><ul><li>**减少镜像层：**一次RUN指令形成新的一层，尽量Shell命令都写在一行，减少镜像层。</li><li>**清理无用文件：**清理对应的残留数据，例如yum缓存。</li><li>**清理无用的软件包：**基础镜像默认会带一些debug工具，可以删除掉，仅保留应用程序所需软件，防止黑客利用。</li><li>**选择最小的基础镜像：**例如alpine</li><li>**使用非root用户运行：**USER指令指定普通用户</li></ul><p>示例：构建python web镜像</p><p>参数化构建如下：</p><ol><li>使用了非root用户运行镜像</li><li>使用了一个镜像层，并非多层</li></ol><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> python</span>
<span class="token instruction"><span class="token keyword">RUN</span> useradd python</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /data/www -p</span>
<span class="token instruction"><span class="token keyword">COPY</span> . /data/www</span>
<span class="token instruction"><span class="token keyword">RUN</span> chown -R python /data</span>
<span class="token instruction"><span class="token keyword">RUN</span> pip install flask -i https://mirrors.aliyun.com/pypi/simple/ &amp;&amp; yum makecache </span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /data/www</span>
<span class="token instruction"><span class="token keyword">USER</span> python</span>
<span class="token instruction"><span class="token keyword">CMD</span> python main.py </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="镜像漏洞扫描工具-trivy" tabindex="-1"><a class="header-anchor" href="#镜像漏洞扫描工具-trivy" aria-hidden="true">#</a> 镜像漏洞扫描工具：Trivy</h3><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204141243326.png" alt="image-20220414124314141" loading="lazy"></p><p>Trivy：是一种用于容器镜像、文件系统、Git仓库的漏洞扫描工具。发现目标软件存在的漏洞。 Trivy易于使用，只需安装二进制文件即可进行扫描，方便集成CI系统。</p><p>项目地址：<a href="https://github.com/aquasecurity/trivy" target="_blank" rel="noopener noreferrer">https://github.com/aquasecurity/trivy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="安装trivy" tabindex="-1"><a class="header-anchor" href="#安装trivy" aria-hidden="true">#</a> 安装Trivy</h4><p>在官网下载二进制的文件，移到<code>/usr/local/bin/</code>下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># mv trivy /usr/local/bin </span>
<span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># trivy --version </span>
Version: <span class="token number">0.18</span>.3
Vulnerability DB:
  Type: Light
  Version: <span class="token number">1</span>
  UpdatedAt: <span class="token number">2022</span>-04-14 00:51:13.721973471 +0000 UTC
  NextUpdate: <span class="token number">2022</span>-04-14 06:51:13.721972971 +0000 UTC
  DownloadedAt: 0001-01-01 00:00:00 +0000 UTC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="下载数据库超时解决" tabindex="-1"><a class="header-anchor" href="#下载数据库超时解决" aria-hidden="true">#</a> 下载数据库超时解决</h4><p>安全扫描通常都需要下载安全漏洞的下载数据库比较完整的版本。数据库速度很慢而且从github下载。所以需要离线。</p><p>GitHub项目地址： <a href="https://github.com/aquasecurity/trivy-db/releases" target="_blank" rel="noopener noreferrer">https://github.com/aquasecurity/trivy-db/releases<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>下载 trivy-offline.db.tgz 放在trivy cache目录。默认的cache目录的位置上</p><p>目录： <code>/home/.cache/trivy/db</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># cp  trivy-offline.db.tgz .cache/trivy/db/ </span>
<span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># cd .cache/trivy/db/ </span>
<span class="token punctuation">[</span>root@master01:~/.cache/trivy/db<span class="token punctuation">]</span> <span class="token comment"># tar zxvf trivy-offline.db.tgz &amp;&amp; rm -rf trivy-offline.db.tgz</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="trivy使用" tabindex="-1"><a class="header-anchor" href="#trivy使用" aria-hidden="true">#</a> Trivy使用</h4><p><strong>1.容器镜像扫描</strong></p><p>也可以指定tar使用<code>trivy image -i nginx.tar</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># trivy image nginx</span>

+---------------------+------------------+----------+--------------------+-------------------------+-----------------------------------------+
<span class="token operator">|</span> zlib1g              <span class="token operator">|</span> CVE-2018-25032   <span class="token operator">|</span> HIGH     <span class="token operator">|</span> <span class="token number">1</span>:1.2.11.dfsg-2    <span class="token operator">|</span> <span class="token number">1</span>:1.2.11.dfsg-2+deb11u1 <span class="token operator">|</span> zlib: A flaw found <span class="token keyword">in</span>                   <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> zlib v1.2.2.2 through zlib              <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> v1.2.11 when compressing<span class="token punctuation">..</span>.             <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> --<span class="token operator">&gt;</span>avd.aquasec.com/nvd/cve-2018-25032   <span class="token operator">|</span>
+---------------------+------------------+----------+--------------------+-------------------------+-----------------------------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 打印指定（高危、严重）漏洞信息</strong></p><p>可以通过-s 参数指定是高危漏洞还是严重漏洞</p><p><code>HIGH</code> 是高危漏洞</p><p><code>CRITICAL</code> 是严重漏洞</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span> <span class="token comment"># trivy image -s HIGH,CRITICAL nginx </span>
<span class="token number">2022</span>-04-14T13:38:38.566+0800    INFO    Detected OS: debian
<span class="token number">2022</span>-04-14T13:38:38.567+0800    INFO    Detecting Debian vulnerabilities<span class="token punctuation">..</span>.
<span class="token number">2022</span>-04-14T13:38:38.579+0800    INFO    Number of PL dependency files: <span class="token number">1</span>
<span class="token number">2022</span>-04-14T13:38:38.579+0800    INFO    Detecting jar vulnerabilities<span class="token punctuation">..</span>.

nginx <span class="token punctuation">(</span>debian <span class="token number">11.2</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Total: <span class="token number">76</span> <span class="token punctuation">(</span>HIGH: <span class="token number">57</span>, CRITICAL: <span class="token number">19</span><span class="token punctuation">)</span>

+---------------------+------------------+----------+--------------------+-------------------------+-----------------------------------------+
<span class="token operator">|</span>       LIBRARY       <span class="token operator">|</span> VULNERABILITY ID <span class="token operator">|</span> SEVERITY <span class="token operator">|</span> INSTALLED VERSION  <span class="token operator">|</span>      FIXED VERSION      <span class="token operator">|</span>                  TITLE                  <span class="token operator">|</span>
+---------------------+------------------+----------+--------------------+-------------------------+-----------------------------------------+
<span class="token operator">|</span> <span class="token function">curl</span>                <span class="token operator">|</span> CVE-2021-22945   <span class="token operator">|</span> CRITICAL <span class="token operator">|</span> <span class="token number">7.74</span>.0-1.3+deb11u1 <span class="token operator">|</span>                         <span class="token operator">|</span> curl: use-after-free and                <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> double-free <span class="token keyword">in</span> MQTT sending             <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> --<span class="token operator">&gt;</span>avd.aquasec.com/nvd/cve-2021-22945   <span class="token operator">|</span>
+                     +------------------+----------+                    +-------------------------+-----------------------------------------+
<span class="token operator">|</span>                     <span class="token operator">|</span> CVE-2021-22946   <span class="token operator">|</span> HIGH     <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> curl: Requirement to use                <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> TLS not properly enforced               <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> <span class="token keyword">for</span> IMAP, POP3, and<span class="token punctuation">..</span>.                  <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> --<span class="token operator">&gt;</span>avd.aquasec.com/nvd/cve-2021-22946   <span class="token operator">|</span>
+---------------------+------------------+          +--------------------+-------------------------+-----------------------------------------+
<span class="token operator">|</span> e2fsprogs           <span class="token operator">|</span> CVE-2022-1304    <span class="token operator">|</span>          <span class="token operator">|</span> <span class="token number">1.46</span>.2-2           <span class="token operator">|</span>                         <span class="token operator">|</span> e2fsprogs: out-of-bounds                <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> read/write via crafted filesystem       <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> --<span class="token operator">&gt;</span>avd.aquasec.com/nvd/cve-2022-1304    <span class="token operator">|</span>
+---------------------+------------------+          +--------------------+-------------------------+-----------------------------------------+
<span class="token operator">|</span> <span class="token function">gzip</span>                <span class="token operator">|</span> CVE-2022-1271    <span class="token operator">|</span>          <span class="token operator">|</span> <span class="token number">1.10</span>-4             <span class="token operator">|</span>                         <span class="token operator">|</span> gzip: arbitrary-file-write              <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> vulnerability                           <span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token operator">|</span>                  <span class="token operator">|</span>          <span class="token operator">|</span>                    <span class="token operator">|</span>                         <span class="token operator">|</span> --<span class="token operator">&gt;</span>avd.aquasec.com/nvd/cve-2022-1271    <span class="token operator">|</span>
+---------------------+------------------+----------+--------------------+-------------------------+-----------------------------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="检查yaml文件安全配置-kubesec" tabindex="-1"><a class="header-anchor" href="#检查yaml文件安全配置-kubesec" aria-hidden="true">#</a> 检查YAML文件安全配置：kubesec</h3><h4 id="kubesec简介" tabindex="-1"><a class="header-anchor" href="#kubesec简介" aria-hidden="true">#</a> kubesec简介</h4><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204141343065.png" alt="image-20220414134332943" loading="lazy"></p><p>kubesec：是一个针对K8s资源清单文件进行安全配置评估的工具，根据安全配置 最佳实践来验证并给出建议。</p><p>官网：<a href="https://kubesec.io" target="_blank" rel="noopener noreferrer">https://kubesec.io<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>项目地址：<a href="https://github.com/controlplaneio/kubesec" target="_blank" rel="noopener noreferrer">https://github.com/controlplaneio/kubesec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="kubesec安装" tabindex="-1"><a class="header-anchor" href="#kubesec安装" aria-hidden="true">#</a> kubesec安装</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># tar zxvf kubesec_linux_amd64.tar.gz </span>
CHANGELOG.md
LICENSE
README.md
kubesec
<span class="token punctuation">[</span>root@master01:~<span class="token punctuation">]</span><span class="token comment"># mv kubesec /usr/local/bin/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="kubesec使用" tabindex="-1"><a class="header-anchor" href="#kubesec使用" aria-hidden="true">#</a> kubesec使用</h4><p>示例：</p><ol><li>会有提示告诉你是否使用资源限制</li><li>可以根据建议添加要求去加固Pod的安全范围</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubesec scan deployment.yaml 
···
        <span class="token punctuation">{</span>
          <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;RequestsMemory&quot;</span>,
          <span class="token string">&quot;selector&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;containers[] .resources .limits .memory&quot;</span>,
          <span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Enforcing memory limits prevents DOS via resource exhaustion&quot;</span>,
          <span class="token string">&quot;points&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;RequestsCPU&quot;</span>,
          <span class="token string">&quot;selector&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;containers[] .resources .requests .cpu&quot;</span>,
          <span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Enforcing CPU requests aids a fair balancing of resources across the cluster&quot;</span>,
          <span class="token string">&quot;points&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>,
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者使用容器环境执行检查</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-i</span> kubesec/kubesec scan /dev/stdin <span class="token operator">&lt;</span> deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>kubesec内置一个HTTP服务器，可以直接启用，远程调用。</p><p>二进制</p><p><strong>kubesec http 8080 &amp;</strong></p><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204141356188.png" alt="image-20220414135608347" loading="lazy"></p><p>Docker容器</p><p><strong>docker run -d -p 8080:8080 kubesec/kubesec http 8080</strong></p><blockquote><p>示例：</p><p>curl -sSX POST --data-binary @deployment.yaml <a href="http://192.168.31.71:8080/scan" target="_blank" rel="noopener noreferrer">http://192.168.31.71:8080/scan<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="admission-webhook" tabindex="-1"><a class="header-anchor" href="#admission-webhook" aria-hidden="true">#</a> Admission Webhook</h3><p><strong>Admission Webhook：准入控制器Webhook是准入控制插件的一种</strong>，用于拦截所有向APISERVER发送的 请求，并且可以修改请求或拒绝请求。</p><p>Admission webhook为开发者提供了非常灵活的插件模式，在kubernetes资源持久化之前，管理员通过程序 可以对指定资源做校验、修改等操作。例如为资源自动打标签、pod设置默认SA，自动注入sidecar容器等。</p><p>相关Webhook准入控制器：</p><ul><li><code>MutatingAdmissionWebhook：</code>修改资源，理论上可以监听并修改任何经过ApiServer处理的请求</li><li><code>ValidatingAdmissionWebhook：</code>验证资源</li><li><code>ImagePolicyWebhook：</code>镜像策略，主要验证镜像字段是否满足条件</li></ul><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204141359941.png" alt="image-20220414135937964" loading="lazy"></p><h3 id="imagepolicywebhook" tabindex="-1"><a class="header-anchor" href="#imagepolicywebhook" aria-hidden="true">#</a> ImagePolicyWebhook</h3><h4 id="镜像策略的工作流程" tabindex="-1"><a class="header-anchor" href="#镜像策略的工作流程" aria-hidden="true">#</a> 镜像策略的工作流程</h4><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204141400570.png" alt="image-20220414140015972" loading="lazy"></p><h4 id="启用准入控制器插件" tabindex="-1"><a class="header-anchor" href="#启用准入控制器插件" aria-hidden="true">#</a> 启用准入控制器插件</h4><ol><li>提供HTTPS证书</li><li>添加配置文件</li><li>需要启用准入控制器开启ImagePolicyWebhook插件</li></ol><h5 id="_1-生成https证书" tabindex="-1"><a class="header-anchor" href="#_1-生成https证书" aria-hidden="true">#</a> 1.生成HTTPS证书</h5><ul><li>需要使用<code>cfssl</code>工具、生成<code>https</code>证书</li><li>需要<code>admission_configuration</code>和<code>connect_webhook</code>的配置文件</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">18820</span>
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">508</span> <span class="token number">10</span>月 <span class="token number">21</span> <span class="token number">18</span>:53 admission_configuration.yaml
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">10376657</span> <span class="token number">11</span>月 <span class="token number">24</span> <span class="token number">2019</span> cfssl
-rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">6595195</span> <span class="token number">11</span>月 <span class="token number">24</span> <span class="token number">2019</span> cfssl-certinfo
-rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">2277873</span> <span class="token number">11</span>月 <span class="token number">24</span> <span class="token number">2019</span> cfssljson
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">632</span> <span class="token number">10</span>月 <span class="token number">21</span> <span class="token number">18</span>:46 connect_webhook.yaml
-rw-r--r-- <span class="token number">1</span> root root     <span class="token number">1367</span> <span class="token number">7</span>月   <span class="token number">5</span> <span class="token number">2021</span> image-policy-certs.sh
drwxr-xr-x <span class="token number">2</span> root root       <span class="token number">39</span> <span class="token number">7</span>月   <span class="token number">9</span> <span class="token number">2021</span> image-policy-webhook


<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># vim image-policy-certs.sh</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> webhook-csr.json <span class="token operator">&lt;&lt;</span>EOF
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;webhook&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
   <span class="token string">&quot;10.11.121.111&quot;</span>   <span class="token comment"># 修改一下IP，我这里是master</span>
   <span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过cfssl工具生成https认证</p><ul><li>生成的key和pem文件需要复制到imagepolicywebhook需要的目录</li><li>还需要将两个连接webhook配置文件复制到指定目录</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># mv cfssl* /usr/local/bin/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># chmod +x image-policy-certs.sh </span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># ./image-policy-certs.sh </span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">64</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">508</span> <span class="token number">10</span>月 <span class="token number">21</span> <span class="token number">18</span>:53 admission_configuration.yaml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">956</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 apiserver-client.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">182</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 apiserver-client-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1675</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 apiserver-client-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1306</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 apiserver-client.pem
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">294</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 ca-config.json
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">960</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 ca.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">212</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 ca-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1675</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 ca-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1273</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 ca.pem
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">632</span> <span class="token number">10</span>月 <span class="token number">21</span> <span class="token number">18</span>:46 connect_webhook.yaml
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">1367</span> <span class="token number">7</span>月   <span class="token number">5</span> <span class="token number">2021</span> image-policy-certs.sh
drwxr-xr-x <span class="token number">2</span> root root   <span class="token number">39</span> <span class="token number">7</span>月   <span class="token number">9</span> <span class="token number">2021</span> image-policy-webhook
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1001</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">204</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1679</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1330</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-添加配置文件" tabindex="-1"><a class="header-anchor" href="#_2-添加配置文件" aria-hidden="true">#</a> 2.添加配置文件</h5><ul><li>查看<code>admission_configuration.yaml</code></li><li>查看<code>connect_webhook.yaml</code></li><li><code>/etc/kubernetes/image-policy/</code>该目录是不存在的，所以需要创建，用作数据卷持久化</li><li>需要修改的是connect_webhook的server地址，该地址是镜像策略服务地址，这里我使用master01</li><li><code>admission_configuration.yaml</code>和 <code>connect_webhook.yaml</code>需要存放到<code>/etc/kubernetes/image-policy/</code>目录</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master01<span class="token punctuation">:</span>~/image<span class="token punctuation">-</span>webhook<span class="token punctuation">]</span> <span class="token comment"># cat admission_configuration.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiserver.config.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AdmissionConfiguration
<span class="token key atrule">plugins</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ImagePolicyWebhook
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">imagePolicy</span><span class="token punctuation">:</span>
      <span class="token key atrule">kubeConfigFile</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy/connect_webhook.yaml  <span class="token comment"># 连接镜像策略服务器配置文件</span>
      <span class="token key atrule">allowTTL</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># 控制批准请求的缓存时间，单位秒</span>
      <span class="token key atrule">denyTTL</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># 控制批准请求的缓存时间，单位秒</span>
      <span class="token key atrule">retryBackoff</span><span class="token punctuation">:</span> <span class="token number">500</span> <span class="token comment"># 控制重试间隔，单位毫秒</span>
      <span class="token key atrule">defaultAllow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 确定webhook后端失效的行为</span>
      
      
<span class="token punctuation">[</span>root@master01<span class="token punctuation">:</span>~/image<span class="token punctuation">-</span>webhook<span class="token punctuation">]</span> <span class="token comment"># cat connect_webhook.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Config
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy/webhook.pem <span class="token comment"># 数字证书，用于验证远程服务</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//10.11.121.111<span class="token punctuation">:</span>8080/image_policy <span class="token comment"># 镜像策略服务器地址，必须是https</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook
<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> webhook
    <span class="token key atrule">user</span><span class="token punctuation">:</span> apiserver
  <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook
<span class="token key atrule">current-context</span><span class="token punctuation">:</span> webhook 
<span class="token key atrule">preferences</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> apiserver
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">client-certificate</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy/apiserver<span class="token punctuation">-</span>client.pem <span class="token comment"># webhook准入控制器使用的证书</span>
    <span class="token key atrule">client-key</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy/apiserver<span class="token punctuation">-</span>client<span class="token punctuation">-</span>key.pem <span class="token comment"># 对应私钥证书 </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新建/etc/kubernetes/image-policy的目录，复制文件到该目录下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># mkdir /etc/kubernetes/image-policy</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># cp admission_configuration.yaml connect_webhook.yaml /etc/kubernetes/image-policy/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># cp apiserver*  /etc/kubernetes/image-policy/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># cp webhook* /etc/kubernetes/image-policy/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># cp ca.pem  /etc/kubernetes/image-policy/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># ll /etc/kubernetes/image-policy/</span>
total <span class="token number">44</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">508</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:38 admission_configuration.yaml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">956</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 apiserver-client.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">182</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 apiserver-client-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1675</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 apiserver-client-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1306</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 apiserver-client.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1273</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 ca.pem
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">632</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:38 connect_webhook.yaml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1001</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 webhook.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">204</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 webhook-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1679</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 webhook-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1330</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:39 webhook.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-开启imagepolicywebhook插件" tabindex="-1"><a class="header-anchor" href="#_3-开启imagepolicywebhook插件" aria-hidden="true">#</a> 3.开启ImagePolicyWebhook插件</h5><p>使用hostpath数据卷将宿主机<code>/etc/kubernetes/image-policy</code>目录挂载到容器中。</p><p>重启kubelet，等待一分钟重建kube-apiserver的Pod。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master01<span class="token punctuation">:</span>~/image<span class="token punctuation">-</span>webhook<span class="token punctuation">]</span><span class="token comment"># vim /etc/kubernetes/kube-apiserver.yaml </span>
 	<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>enable<span class="token punctuation">-</span>admission<span class="token punctuation">-</span>plugins=NodeRestriction<span class="token punctuation">,</span>ImagePolicyWebhook
	<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>admission<span class="token punctuation">-</span>control<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file=/etc/kubernetes/image<span class="token punctuation">-</span>policy/admission_configuration.yaml
···
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy
      <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>policy
···
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/kubernetes/image<span class="token punctuation">-</span>policy
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Directory
      <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>policy
      
<span class="token punctuation">[</span>root@master01<span class="token punctuation">:</span>~/image<span class="token punctuation">-</span>webhook<span class="token punctuation">]</span><span class="token comment"># systemctl  restart  kubelet </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-部署镜像服务器" tabindex="-1"><a class="header-anchor" href="#_4-部署镜像服务器" aria-hidden="true">#</a> 4.部署镜像服务器</h5><p>在本机的master节点部署镜像服务器，来当server，要求如下：</p><ol><li>使用Python编写一个连接<code>ImagePolicyWebhook的api</code>接口</li><li>编写一个<code>Dockerfile</code>运行这个<code>python</code>文件</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook<span class="token punctuation">]</span><span class="token comment"># mv webhook* image-policy-webhook/</span>
<span class="token punctuation">[</span>root@master01:~/image-webhook/image-policy-webhook<span class="token punctuation">]</span> <span class="token comment"># ll</span>
total <span class="token number">24</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">212</span> <span class="token number">7</span>月   <span class="token number">9</span> <span class="token number">2021</span> Dockerfile
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">982</span> <span class="token number">7</span>月   <span class="token number">9</span> <span class="token number">2021</span> main.py
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1001</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook.csr
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">204</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook-csr.json
-rw------- <span class="token number">1</span> root root <span class="token number">1679</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook-key.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1330</span> <span class="token number">4</span>月  <span class="token number">14</span> 09:31 webhook.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看当前的Dockerfile文件</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>[root@master01:~/image-webhook/image-policy-webhook] # cat Dockerfile 
<span class="token instruction"><span class="token keyword">FROM</span> python</span>
<span class="token instruction"><span class="token keyword">RUN</span> useradd python</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /data/www -p</span>
<span class="token instruction"><span class="token keyword">COPY</span> . /data/www</span>
<span class="token instruction"><span class="token keyword">RUN</span> chown -R python /data</span>
<span class="token instruction"><span class="token keyword">RUN</span> pip install flask -i https://mirrors.aliyun.com/pypi/simple/</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /data/www</span>
<span class="token instruction"><span class="token keyword">USER</span> python</span>
<span class="token instruction"><span class="token keyword">CMD</span> python main.py </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看当前的Python脚本</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>root@master01<span class="token punctuation">:</span><span class="token operator">~</span><span class="token operator">/</span>image<span class="token operator">-</span>webhook<span class="token operator">/</span>image<span class="token operator">-</span>policy<span class="token operator">-</span>webhook<span class="token punctuation">]</span> <span class="token comment"># cat main.py </span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request
<span class="token keyword">import</span> json

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/image_policy&#39;</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">image_policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    post_data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#print(&quot;POST数据: %s&quot; %post_data)</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>post_data<span class="token punctuation">)</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">&#39;spec&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;containers&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># 如果镜像里不带冒号或者带:latest说明是镜像使用latest标签</span>
        <span class="token keyword">if</span> <span class="token string">&quot;:&quot;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> c<span class="token punctuation">[</span><span class="token string">&#39;image&#39;</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">&quot;:latest&quot;</span> <span class="token keyword">in</span> c<span class="token punctuation">[</span><span class="token string">&#39;image&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  
            allowed<span class="token punctuation">,</span> reason <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;检查镜像失败！镜像标签不允许使用latest!&quot;</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            allowed<span class="token punctuation">,</span> reason <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&quot;检查镜像通过.&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;检查结果: %s&quot;</span> <span class="token operator">%</span>reason<span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;apiVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;kind&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ImageReview&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;status&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span><span class="token punctuation">:</span> allowed<span class="token punctuation">,</span><span class="token string">&quot;reason&quot;</span><span class="token punctuation">:</span> reason<span class="token punctuation">}</span><span class="token punctuation">}</span>

    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>result<span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> 

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span>ssl_context<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;/data/www/webhook.pem&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;/data/www/webhook-key.pem&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>构建Dockerfile</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook/image-policy-webhook<span class="token punctuation">]</span><span class="token comment"># docker build -t image-policy-webhook .</span>
Digest: sha256:dbbfcbf95f6b596d2be1d8f3b368016619f78f829facf6f2e361bea1151794e5
Status: Downloaded newer image <span class="token keyword">for</span> python:latest
 ---<span class="token operator">&gt;</span> a5d7930b60cc
Step <span class="token number">2</span>/9 <span class="token builtin class-name">:</span> RUN <span class="token function">useradd</span> python
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fcd9fcc7e44f
Removing intermediate container fcd9fcc7e44f
 ---<span class="token operator">&gt;</span> 10b842f26fed
Step <span class="token number">3</span>/9 <span class="token builtin class-name">:</span> RUN <span class="token function">mkdir</span> /data/www <span class="token parameter variable">-p</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> cffd0d6f3bbd
Removing intermediate container cffd0d6f3bbd
 ---<span class="token operator">&gt;</span> 4db5fe4dc849
Step <span class="token number">4</span>/9 <span class="token builtin class-name">:</span> COPY <span class="token builtin class-name">.</span> /data/www
 ---<span class="token operator">&gt;</span> d27fa5502133
Step <span class="token number">5</span>/9 <span class="token builtin class-name">:</span> RUN <span class="token function">chown</span> <span class="token parameter variable">-R</span> python /data
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 7559149b085b
Removing intermediate container 7559149b085b
 ---<span class="token operator">&gt;</span> a35d92963cfd
Step <span class="token number">6</span>/9 <span class="token builtin class-name">:</span> RUN pip <span class="token function">install</span> flask <span class="token parameter variable">-i</span> https://mirrors.aliyun.com/pypi/simple/
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 8aea1cb3d0fe
 Removing intermediate container 8aea1cb3d0fe
 ---<span class="token operator">&gt;</span> b81eed200f98
Step <span class="token number">7</span>/9 <span class="token builtin class-name">:</span> WORKDIR /data/www
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fb82b0cc633e
Removing intermediate container fb82b0cc633e
 ---<span class="token operator">&gt;</span> 2e43f0dff4ad
Step <span class="token number">8</span>/9 <span class="token builtin class-name">:</span> <span class="token environment constant">USER</span> python
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 5faeb5a8566e
Removing intermediate container 5faeb5a8566e
 ---<span class="token operator">&gt;</span> 6797205b1622
Step <span class="token number">9</span>/9 <span class="token builtin class-name">:</span> CMD python main.py
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> da4ae6eabc00
Removing intermediate container da4ae6eabc00
 ---<span class="token operator">&gt;</span> d49ca131fdb9
Successfully built d49ca131fdb9
Successfully tagged image-policy-webhook:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-部署镜像服务" tabindex="-1"><a class="header-anchor" href="#_5-部署镜像服务" aria-hidden="true">#</a> 5.部署镜像服务</h5><p>自己用python开发一个简单的webhook端点服务器，作用是拒绝部署的镜像乜有指定标签（即latest）。</p><ol><li>自签<code>HTTPS</code>证书</li><li><code>Docker</code>容器启动镜像策略服务</li><li>查看当前的Docker日志</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01:~/image-webhook/image-policy-webhook<span class="token punctuation">]</span><span class="token comment"># docker run -d -u root --name=image-policy-webhook \</span>
<span class="token operator">&gt;</span> <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>/webhook.pem:/data/www/webhook.pem <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>/webhook-key.pem:/data/www/webhook-key.pem <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PYTHONUNBUFFERED</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> image-policy-webhook
73a9ae72a7bc8f379fe5414f575b779bf34c969089f6e544e1c7a81a60fc5b9d.


<span class="token punctuation">[</span>root@master01:~/image-webhook/image-policy-webhook<span class="token punctuation">]</span><span class="token comment"># docker logs -f image-policy-webhook </span>
 * Serving Flask app <span class="token string">&#39;main&#39;</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span>
 * Environment: production
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on all addresses <span class="token punctuation">(</span><span class="token number">0.0</span>.0.0<span class="token punctuation">)</span>
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
 * Running on https://127.0.0.1:8080
 * Running on https://172.17.0.2:8080 <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试ImagePolicyWebhook</p><p>创建Deployment使用nginx镜像，使用nginx:1.16的版本，查看日志。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web1 --image=nginx:1.16 </span>
deployment.apps/web1 created

<span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># docker logs  -f image-policy-webhook </span>
 * Serving Flask app <span class="token string">&#39;main&#39;</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span>
 * Environment: production
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on all addresses <span class="token punctuation">(</span><span class="token number">0.0</span>.0.0<span class="token punctuation">)</span>
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
 * Running on https://127.0.0.1:8080
 * Running on https://172.17.0.2:8080 <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span>
POST数据: <span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ImageReview&quot;</span>,<span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;creationTimestamp&quot;</span>:null<span class="token punctuation">}</span>,<span class="token string">&quot;spec&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;containers&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;image&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;nginx:1.16&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;status&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span>

检查结果: 检查镜像通过.
<span class="token number">10.11</span>.121.118 - - <span class="token punctuation">[</span><span class="token number">14</span>/Apr/2022 <span class="token number">14</span>:00:46<span class="token punctuation">]</span> <span class="token string">&quot;POST /image_policy?timeout=30s HTTP/1.1&quot;</span> <span class="token number">200</span> -
POST数据: <span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ImageReview&quot;</span>,<span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;creationTimestamp&quot;</span>:null<span class="token punctuation">}</span>,<span class="token string">&quot;spec&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;containers&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;image&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;nginx:latest&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;status&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建Deployment使用nginx镜像，使用nginx:latest的版本，查看日志。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web2 --image=nginx:latest</span>
deployment.apps/web2 created

<span class="token punctuation">[</span>root@master01 image-policy-webhook<span class="token punctuation">]</span><span class="token comment"># docker logs  -f image-policy-webhook </span>
 * Serving Flask app <span class="token string">&#39;main&#39;</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span>
 * Environment: production
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on all addresses <span class="token punctuation">(</span><span class="token number">0.0</span>.0.0<span class="token punctuation">)</span>
   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.
 * Running on https://127.0.0.1:8080
 * Running on https://172.17.0.2:8080 <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span>
POST数据: <span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ImageReview&quot;</span>,<span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;creationTimestamp&quot;</span>:null<span class="token punctuation">}</span>,<span class="token string">&quot;spec&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;containers&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;image&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;nginx:1.16&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;status&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span>

检查结果: 检查镜像通过.
<span class="token number">10.11</span>.121.118 - - <span class="token punctuation">[</span><span class="token number">14</span>/Apr/2022 <span class="token number">14</span>:00:46<span class="token punctuation">]</span> <span class="token string">&quot;POST /image_policy?timeout=30s HTTP/1.1&quot;</span> <span class="token number">200</span> -
POST数据: <span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ImageReview&quot;</span>,<span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;creationTimestamp&quot;</span>:null<span class="token punctuation">}</span>,<span class="token string">&quot;spec&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;containers&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;image&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;nginx:latest&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;status&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span>

检查结果: 检查镜像失败！镜像标签不允许使用latest<span class="token operator">!</span>
<span class="token number">10.11</span>.121.118 - - <span class="token punctuation">[</span><span class="token number">14</span>/Apr/2022 <span class="token number">14</span>:01:04<span class="token punctuation">]</span> <span class="token string">&quot;POST /image_policy?timeout=30s HTTP/1.1&quot;</span> <span class="token number">200</span> -
POST数据: <span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ImageReview&quot;</span>,<span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;imagepolicy.k8s.io/v1alpha1&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;creationTimestamp&quot;</span>:null<span class="token punctuation">}</span>,<span class="token string">&quot;spec&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;containers&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;image&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;nginx:latest&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;status&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;allowed&quot;</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span>

检查结果: 检查镜像失败！镜像标签不允许使用latest<span class="token operator">!</span>
<span class="token number">10.11</span>.121.118 - - <span class="token punctuation">[</span><span class="token number">14</span>/Apr/2022 <span class="token number">14</span>:02:26<span class="token punctuation">]</span> <span class="token string">&quot;POST /image_policy?timeout=30s HTTP/1.1&quot;</span> <span class="token number">200</span> -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/theme-docs/src/zh/isKcount/2/CKS/05.供应链安全.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: admin@example.com">Administrator</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2022 isKcount</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.85823306.js" defer></script>
  </body>
</html>
